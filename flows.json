[
    {
        "id": "3b6912346d474baf",
        "type": "tab",
        "label": "Recovered Nodes",
        "disabled": false,
        "info": "The nodes on this flow were missing a valid flow id when they were imported. They have been added to this flow so you can either restore or delete them.",
        "env": []
    },
    {
        "id": "de23328697951a0d",
        "type": "tab",
        "label": "Dashboard 2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "493c5b8aa580413b",
        "type": "tab",
        "label": "Kontrollrum",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "scan-dashboard-2",
        "type": "tab",
        "label": "Scan Dashboard 2",
        "disabled": false,
        "info": "RefLink scan page for Dashboard 2.0"
    },
    {
        "id": "overview-dashboard-2",
        "type": "tab",
        "label": "Overview Dashboard 2",
        "disabled": false,
        "info": "Reflink Overview page - Variant 3 layout"
    },
    {
        "id": "settings-flow",
        "type": "tab",
        "label": "Settings",
        "disabled": false,
        "info": "Reflink OS Settings Module - Network, System, Modbus, BACnet, RS485, Logging, Auth"
    },
    {
        "id": "alarms-stats-flow",
        "type": "tab",
        "label": "Larm & Statistik",
        "disabled": false,
        "info": "Reflink OS Larm & Statistik modul - Dashboard 2.0 komponenter"
    },
    {
        "id": "flowData",
        "type": "tab",
        "label": "DATA MASKINER",
        "disabled": false,
        "info": ""
    },
    {
        "id": "flowUI",
        "type": "tab",
        "label": "UI DEMO LINK IN",
        "disabled": false,
        "info": ""
    },
    {
        "id": "08a59fbc9776a2b2",
        "type": "tab",
        "label": "REFBOARD",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "cfgFlow",
        "type": "tab",
        "label": "CONFIG Enheter",
        "disabled": false,
        "info": ""
    },
    {
        "id": "55bd7b226cdae49a",
        "type": "tab",
        "label": "L√§gg till Nod",
        "disabled": false,
        "info": ""
    },
    {
        "id": "tab-reflink-test",
        "type": "tab",
        "label": "RefLink Test",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ui_tab_reflink",
        "type": "ui_tab",
        "name": "Reflink",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "1e11728e8be9592a",
        "type": "ui_base",
        "theme": {
            "angularTheme": {
                "accents": "blue",
                "background": "grey",
                "palette": "light",
                "primary": "indigo",
                "warn": "red"
            },
            "customTheme": {
                "baseColor": "#1bbfff",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#4B7930",
                "name": "Untitled Theme 1",
                "reset": false
            },
            "darkTheme": {
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#097479",
                "edited": false
            },
            "lightTheme": {
                "baseColor": "#1bbfff",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#0094CE",
                "edited": true,
                "reset": false
            },
            "name": "theme-custom",
            "themeState": {
                "base-color": {
                    "default": "#4B7930",
                    "edited": true,
                    "value": "#1bbfff"
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                },
                "group-backgroundColor": {
                    "edited": true,
                    "value": "#018ace"
                },
                "group-borderColor": {
                    "edited": true,
                    "value": "#0d8ec2"
                },
                "group-textColor": {
                    "edited": true,
                    "value": "#ffffff"
                },
                "page-backgroundColor": {
                    "edited": true,
                    "value": "#0d8ec2"
                },
                "page-sidebar-backgroundColor": {
                    "edited": true,
                    "value": "#018ace"
                },
                "page-titlebar-backgroundColor": {
                    "edited": false,
                    "value": "#1bbfff"
                },
                "widget-backgroundColor": {
                    "edited": true,
                    "value": "#000bbb"
                },
                "widget-borderColor": {
                    "edited": true,
                    "value": "#1bbfff"
                },
                "widget-textColor": {
                    "edited": true,
                    "value": "#ffffff"
                }
            }
        },
        "site": {
            "allowSwipe": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "hideToolbar": "false",
            "lockMenu": "false",
            "name": "Node-RED Dashboard",
            "sizes": {
                "cx": 6,
                "cy": 6,
                "gx": 6,
                "gy": 6,
                "px": 0,
                "py": 0,
                "sx": 48,
                "sy": 48
            }
        }
    },
    {
        "id": "grp_header",
        "type": "ui_group",
        "name": "Header",
        "tab": "",
        "order": 1,
        "disp": false,
        "width": "24",
        "collapse": false,
        "className": ""
    },
    {
        "id": "17b6d570bd224ba5",
        "type": "global-config",
        "env": [],
        "modules": {}
    },
    {
        "id": "45086322eb4ebcac",
        "type": "ui-base",
        "name": "My Dashboard",
        "path": "/dashboard",
        "appIcon": "",
        "includeClientData": true,
        "acceptsClientConfig": [
            "ui-notification",
            "ui-control"
        ],
        "showPathInSidebar": false,
        "headerContent": "page",
        "navigationStyle": "default",
        "titleBarStyle": "default",
        "showReconnectNotification": true,
        "notificationDisplayTime": 1,
        "showDisconnectNotification": true,
        "allowInstall": false
    },
    {
        "id": "c41cf9962fc40517",
        "type": "ui-theme",
        "name": "Default Theme",
        "colors": {
            "bgPage": "#018ace",
            "groupBg": "#1bbfff",
            "groupOutline": "#0a8ace",
            "primary": "#01bbff",
            "surface": "#1bbfff"
        },
        "sizes": {
            "density": "default",
            "groupBorderRadius": "4px",
            "groupGap": "12px",
            "pagePadding": "12px",
            "widgetGap": "12px"
        }
    },
    {
        "id": "71605fc57a3c19c1",
        "type": "ui-page",
        "name": "KONTROLLRUM",
        "ui": "45086322eb4ebcac",
        "path": "/page1",
        "icon": "home",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 2,
        "className": "control-page",
        "visible": true,
        "disabled": false
    },
    {
        "id": "cc2e314fca17f2ca",
        "type": "ui-link",
        "name": "Link 1",
        "ui": "45086322eb4ebcac",
        "path": "/",
        "icon": "home",
        "order": 8,
        "visible": true,
        "disabled": false
    },
    {
        "id": "23024e263184d0e6",
        "type": "ui-page",
        "name": "REFBOARD",
        "ui": "45086322eb4ebcac",
        "path": "/2",
        "icon": "home",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 4,
        "className": "ref-page",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "c596de87c9e2efac",
        "type": "ui-group",
        "name": "Maskiner",
        "page": "23024e263184d0e6",
        "width": "3",
        "height": 1,
        "order": 1,
        "showTitle": true,
        "className": "ref-page",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "b8abf29b08652e6d",
        "type": "ui-group",
        "name": "Frysar",
        "page": "23024e263184d0e6",
        "width": "3",
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "ref-page",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "c67eb8c4d02b7ed2",
        "type": "ui_spacer",
        "z": "de23328697951a0d",
        "name": "spacer",
        "group": "grp_header",
        "order": 3,
        "width": 12,
        "height": 1
    },
    {
        "id": "0061c078abc5db2a",
        "type": "ui_spacer",
        "z": "de23328697951a0d",
        "name": "spacer",
        "group": "grp_header",
        "order": 5,
        "width": 12,
        "height": 1
    },
    {
        "id": "d564e1876232e645",
        "type": "ui-group",
        "name": "Mastercontroller",
        "page": "71605fc57a3c19c1",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "reflink-theme",
        "type": "ui-theme",
        "name": "Reflink Light",
        "colors": {
            "bgPage": "#018ace",
            "groupBg": "#018ace",
            "groupOutline": "#018ace",
            "primary": "#1bbfff",
            "surface": "#1bbfff"
        },
        "sizes": {
            "density": "default",
            "groupBorderRadius": "4px",
            "groupGap": "12px",
            "pagePadding": "12px",
            "widgetGap": "12px"
        }
    },
    {
        "id": "reflink-page-scan",
        "type": "ui-page",
        "name": "NODER",
        "ui": "45086322eb4ebcac",
        "path": "/scan",
        "icon": "radar",
        "layout": "grid",
        "theme": "reflink-theme",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 15,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "reflink-group-line1",
        "type": "ui-group",
        "name": "REFBUS Line 1",
        "page": "reflink-page-scan",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "reflink-group-line2",
        "type": "ui-group",
        "name": "REFBUS Line 2",
        "page": "reflink-page-scan",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "reflink-group-scanall",
        "type": "ui-group",
        "name": "Scan All",
        "page": "reflink-page-scan",
        "width": "12",
        "height": "1",
        "order": 3,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "0dfeaa05ef20a8dd",
        "type": "ui-theme",
        "name": "ui-base.label.theme 3",
        "colors": {
            "bgPage": "#eeeeee",
            "groupBg": "#ffffff",
            "groupOutline": "#cccccc",
            "primary": "#1bbfff",
            "surface": "#000000"
        },
        "sizes": {
            "density": "default",
            "groupBorderRadius": "4px",
            "groupGap": "12px",
            "pagePadding": "12px",
            "widgetGap": "12px"
        }
    },
    {
        "id": "reflink-page-overview",
        "type": "ui-page",
        "name": "",
        "ui": "45086322eb4ebcac",
        "path": "/overview",
        "icon": "home",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 1,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "overview-group-temps",
        "type": "ui-group",
        "name": "√ñversikt temperaturer",
        "page": "reflink-page-overview",
        "width": "5",
        "height": "8",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "overview-group-machines",
        "type": "ui-group",
        "name": "√ñversikt maskiner",
        "page": "reflink-page-overview",
        "width": "4",
        "height": "8",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "overview-group-alarms",
        "type": "ui-group",
        "name": "Aktiva larm",
        "page": "reflink-page-overview",
        "width": "3",
        "height": "6",
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "overview-group-events",
        "type": "ui-group",
        "name": "Senaste h√§ndelser",
        "page": "reflink-page-overview",
        "width": "4",
        "height": "4",
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "settings-page-network",
        "type": "ui-page",
        "name": "N√§tverk",
        "ui": "45086322eb4ebcac",
        "path": "/network",
        "icon": "mdi-lan",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 11,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "settings-page-system",
        "type": "ui-page",
        "name": "System",
        "ui": "45086322eb4ebcac",
        "path": "/system",
        "icon": "mdi-cog",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 12,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "settings-page-protocols",
        "type": "ui-page",
        "name": "Protokoll",
        "ui": "45086322eb4ebcac",
        "path": "/protocols",
        "icon": "mdi-protocol",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 13,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "settings-page-security",
        "type": "ui-page",
        "name": "S√§kerhet",
        "ui": "45086322eb4ebcac",
        "path": "/security",
        "icon": "mdi-shield-lock",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 14,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "settings-group-interfaces",
        "type": "ui-group",
        "name": "N√§tverksinterface",
        "page": "settings-page-network",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-active",
        "type": "ui-group",
        "name": "Aktivt Interface",
        "page": "settings-page-network",
        "width": "4",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-pingtest",
        "type": "ui-group",
        "name": "Ping Test",
        "page": "settings-page-network",
        "width": "4",
        "height": "1",
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-failover",
        "type": "ui-group",
        "name": "Failover Prioritet",
        "page": "settings-page-network",
        "width": "4",
        "height": "1",
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-sysinfo",
        "type": "ui-group",
        "name": "Systeminformation",
        "page": "settings-page-system",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-service",
        "type": "ui-group",
        "name": "Service Mode",
        "page": "settings-page-system",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-logging",
        "type": "ui-group",
        "name": "Loggning",
        "page": "settings-page-system",
        "width": "6",
        "height": "1",
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-configmgmt",
        "type": "ui-group",
        "name": "Konfigurationshantering",
        "page": "settings-page-system",
        "width": "6",
        "height": "1",
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-modbus",
        "type": "ui-group",
        "name": "Modbus TCP",
        "page": "settings-page-protocols",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "settings-group-bacnet",
        "type": "ui-group",
        "name": "BACnet/IP",
        "page": "settings-page-protocols",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-rs485",
        "type": "ui-group",
        "name": "RS485 / Modbus RTU",
        "page": "settings-page-protocols",
        "width": "12",
        "height": "1",
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-users",
        "type": "ui-group",
        "name": "Anv√§ndare",
        "page": "settings-page-security",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "settings-group-apikeys",
        "type": "ui-group",
        "name": "API-nycklar",
        "page": "settings-page-security",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "alarms-page",
        "type": "ui-page",
        "name": "LARM",
        "ui": "45086322eb4ebcac",
        "path": "/alarms",
        "icon": "mdi-bell-alert",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 3,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "stats-page",
        "type": "ui-page",
        "name": "STATISTIK",
        "ui": "45086322eb4ebcac",
        "path": "/statistics",
        "icon": "mdi-chart-line",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 10,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "alarms-group-main",
        "type": "ui-group",
        "name": "Larm",
        "page": "alarms-page",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "stats-group-main",
        "type": "ui-group",
        "name": "Statistik",
        "page": "stats-page",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "reflink-page-addresses",
        "type": "ui-page",
        "name": "Adresser",
        "ui": "45086322eb4ebcac",
        "path": "/addresses",
        "icon": "mdi-map-marker",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 5,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "reflink-page-logging",
        "type": "ui-page",
        "name": "Loggning",
        "ui": "45086322eb4ebcac",
        "path": "/logging",
        "icon": "mdi-file-document",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 6,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "reflink-page-config",
        "type": "ui-page",
        "name": "Konfiguration",
        "ui": "45086322eb4ebcac",
        "path": "/config",
        "icon": "mdi-cog",
        "layout": "grid",
        "theme": "c41cf9962fc40517",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 7,
        "className": "config-config",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "f68f985b729761f1",
        "type": "ui-group",
        "name": "Controllers",
        "page": "71605fc57a3c19c1",
        "width": "9",
        "height": "20",
        "order": 3,
        "showTitle": true,
        "className": "akcc-table",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "0f46ecdf93377d8e",
        "type": "ui-group",
        "name": "Frysar",
        "page": "23024e263184d0e6",
        "width": "3",
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "akcc-table",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "6ffbe88688135362",
        "type": "ui-group",
        "name": "Aggregat",
        "page": "71605fc57a3c19c1",
        "width": "3",
        "height": "15",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "tab_kontrollrum",
        "type": "ui_tab",
        "name": "Kontrollrum",
        "icon": "mdi-cog-outline",
        "order": 5
    },
    {
        "id": "group_controllers",
        "type": "ui_group",
        "name": "Controllers",
        "tab": "tab_kontrollrum",
        "order": 1,
        "disp": true,
        "width": "12"
    },
    {
        "id": "group_machines",
        "type": "ui_group",
        "name": "Aggregat",
        "tab": "tab_kontrollrum",
        "order": 2,
        "disp": true,
        "width": "12"
    },
    {
        "id": "config-group-addnode",
        "type": "ui-group",
        "name": "L√§gg till nod",
        "page": "reflink-page-config",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "config-group-nodelist",
        "type": "ui-group",
        "name": "Nodlista",
        "page": "reflink-page-config",
        "width": "12",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "d91545c19e1a2827",
        "type": "ui-spacer",
        "group": "6ffbe88688135362",
        "name": "spacer",
        "tooltip": "",
        "order": 4,
        "width": 1,
        "height": 1,
        "className": ""
    },
    {
        "id": "d03d47c564c21746",
        "type": "ui-spacer",
        "group": "6ffbe88688135362",
        "name": "spacer",
        "tooltip": "",
        "order": 5,
        "width": 1,
        "height": 1,
        "className": ""
    },
    {
        "id": "ui-tab-kontrollrum",
        "type": "ui_tab",
        "name": "Kontrollrum Test",
        "icon": "dashboard",
        "order": 1
    },
    {
        "id": "ui-group-controllers",
        "type": "ui_group",
        "name": "Controllers",
        "tab": "ui-tab-kontrollrum",
        "order": 1,
        "disp": true,
        "width": 12
    },
    {
        "id": "fb0d647584d2fd17",
        "type": "ui-group",
        "name": "Larm",
        "page": "23024e263184d0e6",
        "width": "3",
        "height": 1,
        "order": 4,
        "showTitle": true,
        "className": "ref-page",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "3a4de51ea166250d",
        "type": "ui-group",
        "name": "Group 35",
        "page": "23024e263184d0e6",
        "width": 6,
        "height": 1,
        "order": 5,
        "showTitle": true,
        "className": "akcc-table",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "84e4f1f1d883959f",
        "type": "ui-spacer",
        "group": "d564e1876232e645",
        "name": "spacer",
        "tooltip": "",
        "order": 9,
        "width": 1,
        "height": 1,
        "className": ""
    },
    {
        "id": "ccadbd5376cd5d5a",
        "type": "ui-group",
        "name": "Group 36",
        "page": "reflink-page-overview",
        "width": 6,
        "height": 1,
        "order": 5,
        "showTitle": true,
        "className": "",
        "visible": true,
        "disabled": false,
        "groupType": "default"
    },
    {
        "id": "sidebar-injector-template",
        "type": "ui-template",
        "z": "3b6912346d474baf",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "Sidebar Injector",
        "order": 0,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "",
        "storeOutMessages": false,
        "passthru": true,
        "resendOnRefresh": false,
        "templateScope": "widget:site",
        "className": "",
        "x": 100,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "f18278f8bed53da0",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "Sidebar CSS",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ==== REFLINK COMPLETE STYLES ‚Äì FULL CLEAN VERSION ==== */\n@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');\n\n/* === GRUNDLAYOUT === */\nhtml,\nbody {\nheight: 100%;\noverflow: hidden; /* bara main ska scrolla */\n}\n\n.v-application,\n.v-main,\n.v-main__wrap {\nbackground: transparent !important;\nfont-family: 'Montserrat', sans-serif !important;\n}\n\n/* === BAKGRUNDSBILD (valfri ‚Äì √§ndra filnamn vid behov) === */\n/*\nbody {\nbackground: url('/scan-bg9.png') no-repeat center center fixed !important;\nbackground-size: cover !important;\n}\n*/\n\n/* === G√ñM HAMBURGERMENY === */\n.v-app-bar__nav-icon,\n.v-toolbar__nav-icon,\n.v-btn--icon.mdi-menu,\nbutton.v-btn[aria-label='Menu'],\nbutton.v-btn[aria-label='menu'],\n.v-toolbar button.v-btn--icon:first-child {\ndisplay: none !important;\nvisibility: hidden !important;\nwidth: 0 !important;\nheight: 0 !important;\noverflow: hidden !important;\npointer-events: none !important;\n}\n\n/* === HEADER (APP BAR) ‚Äì LJUS TRANSPARENT REFLINK-BL√Ö === */\n.v-app-bar {\nposition: fixed !important;\ntop: 0 !important;\nleft: 0 !important;\nright: 0 !important;\nz-index: 1100 !important;\n}\n\n.v-app-bar,\n.v-toolbar {\nheight: 64px !important;\nmin-height: 64px !important;\n\n/* #18ACEC med lite mer f√§rg */\nbackground: rgba(24, 172, 236, 0.70) !important;\nbackdrop-filter: blur(12px);\n-webkit-backdrop-filter: blur(12px);\nbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.20) !important;\n}\n\n/* === SIDEBAR (NAVIGATION DRAWER) ‚Äì FIXED UNDER HEADER === */\n.v-navigation-drawer {\nbackground: linear-gradient(\n180deg,\nrgba(27, 191, 255, 0.70) 0%,\nrgba(24, 172, 236, 0.75) 100%\n) !important;\n\nbackdrop-filter: blur(14px);\n-webkit-backdrop-filter: blur(14px);\n\nposition: fixed !important;\ntransform: translateX(0) !important;\nvisibility: visible !important;\nopacity: 1 !important;\n\nwidth: 240px !important;\nmin-width: 240px !important;\nleft: 0 !important;\ntop: 64px !important;\nheight: calc(100vh - 64px) !important;\n\nz-index: 1000 !important;\ntransition: none !important;\n}\n\n.v-navigation-drawer--rail,\n.v-navigation-drawer--temporary {\ntransform: translateX(0) !important;\nwidth: 240px !important;\n}\n\n.v-navigation-drawer__content {\nbackground: transparent !important;\n}\n\n/* === MAIN CONTENT ‚Äì L√ÑMNA PLATS F√ñR HEADER + SIDEBAR === */\n.v-main {\npadding-left: 240px !important; /* plats f√∂r sidomeny */\npadding-top: 64px !important; /* plats f√∂r header */\nmargin-left: 0 !important;\n\nheight: calc(100vh - 64px) !important;\noverflow-y: auto !important; /* endast main scrollar */\n\ntransition: none !important;\n}\n\n.v-main__wrap {\npadding-top: 0 !important;\n}\n\n/* === G√ñM STANDARDINNEH√ÖLL I DRAWERN === */\n.v-navigation-drawer__content > .v-list,\n.v-navigation-drawer__content > nav,\n.v-navigation-drawer__content > *:not(.custom-sidebar) {\ndisplay: none !important;\n}\n\n/* ===================================================== */\n/* CUSTOM SIDEBAR STYLES */\n/* ===================================================== */\n\n.custom-sidebar {\nfont-family: 'Montserrat', sans-serif;\ncolor: #ffffff;\n}\n\n/* Logo h√∂gst upp */\n.sidebar-logo {\npadding: 20px 16px;\nborder-bottom: 1px solid rgba(255, 255, 255, 0.25);\n}\n\n.sidebar-logo-text {\nfont-size: 22px;\nfont-weight: 700;\ncolor: #ffffff;\nletter-spacing: 3px;\n}\n\n/* Sektionstitlar (ANL√ÑGGNING / NODER / SYSTEM) */\n.menu-section-title {\nfont-size: 12px !important;\nfont-weight: 700 !important;\ncolor: rgba(255, 255, 255, 0.85) !important;\ntext-transform: uppercase;\npadding: 18px 18px 8px;\nletter-spacing: 2px !important; /* extra teckenavst√•nd */\n}\n\n/* Huvudmenyposter (Refboard, Kontrollrum, osv) */\n.custom-sidebar .menu-item {\ndisplay: flex;\nalign-items: center;\n\npadding: 14px 22px !important;\nmargin-bottom: 2px;\n\nfont-size: 16px !important;\nfont-weight: 600 !important;\nletter-spacing: 1.5px !important; /* teckenavst√•nd */\n\ntext-decoration: none;\ncolor: #ffffff !important;\ncursor: pointer;\n\nbackground: transparent;\nborder-radius: 0;\n}\n\n/* Se till att ikon + text blir kritvita */\n.custom-sidebar .menu-item,\n.custom-sidebar .menu-item * {\ncolor: #ffffff !important;\n}\n\n/* Ikon + text + pil */\n.menu-item-icon {\nwidth: 22px;\nmargin-right: 12px;\ntext-align: center;\nfont-size: 16px;\n}\n\n.menu-item-text {\nflex: 1;\n}\n\n.menu-item-arrow {\nfont-size: 10px;\ntransition: transform 0.2s;\n}\n\n.menu-item-arrow.open {\ntransform: rotate(180deg);\n}\n\n/* Hover + aktiv rad */\n.custom-sidebar .menu-item:hover {\nbackground: rgba(255, 255, 255, 0.18) !important;\n}\n\n.custom-sidebar .menu-item.active {\nbackground: rgba(255, 255, 255, 0.26) !important;\nborder-left: 3px solid #ffffff !important;\n}\n\n/* Submeny (t.ex. under Inst√§llningar) */\n.submenu {\nmax-height: 0;\noverflow: hidden;\ntransition: max-height 0.3s;\nbackground: rgba(0, 0, 0, 0.08);\n}\n\n.submenu.open {\nmax-height: 500px;\n}\n\n.custom-sidebar .submenu-item {\ndisplay: block;\npadding: 10px 22px 10px 54px !important;\n\nfont-size: 14px !important;\nletter-spacing: 0.8px !important;\n\ntext-decoration: none;\ncolor: rgba(255, 255, 255, 0.95) !important;\ncursor: pointer;\n}\n\n.custom-sidebar .submenu-item:hover {\nbackground: rgba(255, 255, 255, 0.15);\ncolor: #ffffff !important;\n}\n\n/* === GRUPPER / CARDS I DASHBOARDEN === */\n.nrdb-ui-group {\noverflow: visible !important;\n}\n\n/* === TUNNARE TEXT I SIDEBAR === */\n\n/* Huvudmeny ‚Äì tunnare (regular/light k√§nsla) */\n.custom-sidebar .menu-item {\nfont-weight: 300 !important; /* prova 300 om du vill ha √§nnu tunnare */\n}\n\n/* Submeny ‚Äì √§nnu ett sn√§pp tunnare */\n.custom-sidebar .submenu-item {\nfont-weight: 200 !important;\n}\n\n/* Sektionstitlar (ANL√ÑGGNING / NODER / SYSTEM) ‚Äì lite tydligare men inte bold */\n.menu-section-title {\nfont-weight: 500 !important;\n}\n\n/* === SIDOMENY ‚Äì HOVER SOM LJUS VIT/BL√Ö GLAS, AKTIV MER BL√Ö === */\n\n/* Bas f√∂r raderna ‚Äì lite diskret bl√• glas */\n.custom-sidebar .menu-item {\nbackground-image: linear-gradient(\n90deg,\nrgba(24, 172, 236, 0.20),\nrgba(0, 132, 200, 0.16)\n);\nborder-top: 1px solid rgba(255, 255, 255, 0.05);\nborder-bottom: 1px solid rgba(0, 0, 0, 0.22);\n\ntransition: background 0.25s ease, background-position 0.25s ease;\nbackground-size: 160% 160%;\nbackground-position: 0% 50%;\n}\n\n/* Submeny ‚Äì lite svagare version av samma k√§nsla */\n.custom-sidebar .submenu-item {\nbackground-image: linear-gradient(\n90deg,\nrgba(24, 172, 236, 0.16),\nrgba(0, 132, 200, 0.12)\n);\nborder-top: 1px solid rgba(255, 255, 255, 0.04);\nborder-bottom: 1px solid rgba(0, 0, 0, 0.18);\n\ntransition: background 0.25s ease, background-position 0.25s ease;\nbackground-size: 160% 160%;\nbackground-position: 0% 50%;\n}\n\n/* HOVER ‚Äì g√•r mot n√§stan vit (som tabellen) men med lite bl√• i botten\n+ liten ‚Äúshift‚Äù i gradienten n√§r man hovrar */\n.custom-sidebar .menu-item:hover {\nbackground-image: linear-gradient(\n135deg,\nrgba(255, 255, 255, 0.85) 0%, /* n√§stan #FFFFFF */\nrgba(255, 255, 255, 0.75) 35%,\nrgba(24, 172, 236, 0.55) 100% /* lite ljusbl√• i slutet */\n);\nbackground-position: 100% 50%;\n}\n\n.custom-sidebar .submenu-item:hover {\nbackground-image: linear-gradient(\n135deg,\nrgba(255, 255, 255, 0.80) 0%,\nrgba(255, 255, 255, 0.70) 40%,\nrgba(24, 172, 236, 0.45) 100%\n);\nbackground-position: 100% 50%;\ncolor: #ffffff !important;\n}\n\n/* AKTIV ‚Äì mer bl√• och m√∂rkare √§n hover, inte ljusare */\n.custom-sidebar .menu-item.active {\nbackground-image: linear-gradient(\n135deg,\nrgba(24, 172, 236, 0.95),\nrgba(0, 110, 210, 0.98)\n);\nborder-left: 3px solid #ffffff;\nsolid #ffffff;\n}\n\n/* ==== KS-GAUGES ‚Äì REN OCH ENKEL STIL ==== */\n\n/* Lite luft mellan varje gauge-widget */\n.ks1-gauge,\n.ks2-gauge,\n.ks3-gauge {\nmargin-bottom: 14px !important;\n}\n\n/* Kortet runt gaugen: transparent, ingen skugga */\n.ks1-gauge .v-card,\n.ks2-gauge .v-card,\n.ks3-gauge .v-card {\nbackground: transparent !important;\nbox-shadow: none !important;\nborder: none !important;\n}\n\n/* Track (bakgrundsring) ‚Äì ljusbl√• */\n.ks1-gauge .v-progress-circular,\n.ks2-gauge .v-progress-circular,\n.ks3-gauge .v-progress-circular {\ncolor: rgba(148, 227, 255, 0.35) !important;\n}\n\n/* V√§rdeb√•ge ‚Äì tydligt m√∂rkbl√• */\n.ks1-gauge .v-progress-circular__overlay,\n.ks2-gauge .v-progress-circular__overlay,\n.ks3-gauge .v-progress-circular__overlay {\nstroke: #0F75D4 !important;\nstroke-width: 8 !important;\nstroke-linecap: round !important;\n}\n\n/* === HEADER-TITEL ‚Äì FLYTTA OCH G√ñR VIT === */\n.v-toolbar-title,\n.v-app-bar-title {\ncolor: #ffffff !important; /* vit text */\nfont-weight: 600 !important;\nletter-spacing: 0.12em !important;\ntext-transform: uppercase !important;\nfont-size: 0.85rem !important;\n\n/* putta ut den s√• den b√∂rjar d√§r inneh√•llet b√∂rjar (efter sidomenyn) */\nmargin-left: 260px !important; /* 240px sidebar + lite luft */\n}\n\n/* === TILLBAKA-KNAPP ‚Äì GLOBAL HEADER === */\n.ctrl-back-btn {\n  background: rgba(255,255,255,0.15);\n  border: 1px solid rgba(255,255,255,0.4);\n  border-radius: 999px;\n  padding: 4px 14px;\n  font-size: 0.8rem;\n  font-weight: 500;\n  letter-spacing: 0.08em;\n  text-transform: uppercase;\n  color: #ffffff;\n  cursor: pointer;\n  backdrop-filter: blur(8px);\n}\n\n.ctrl-back-btn:hover {\n  background: rgba(255,255,255,0.25);\n}\n\n/* Placera knappen snyggt i app-baren */\n.v-app-bar .ctrl-header-left {\n  display: flex;\n  align-items: center;\n  margin-right: 12px;\n}\n\n/* ===== GLOBAL SCROLLBAR (alla sidor) ===== */\n\n/* Chrome / Edge / Chromium (Node-RED k√∂r Chromium) */\nbody::-webkit-scrollbar {\nwidth: 6px;\n}\n\nbody::-webkit-scrollbar-track {\nbackground: transparent;\n}\n\nbody::-webkit-scrollbar-thumb {\nbackground: rgba(15, 23, 42, 0.7);\nborder-radius: 999px;\n}\n\nbody::-webkit-scrollbar-thumb:hover {\nbackground: rgba(15, 23, 42, 0.9);\n} \n\n/* Firefox ‚Äì om du √∂ppnar dashboarden i vanlig browser */\nbody {\nscrollbar-width: thin;\nscrollbar-color: rgba(15, 23, 42, 0.8) transparent;\n}\n*/\nbody::-webkit-scrollbar {\nwidth: 0;\nheight: 0;\n}\n\nbody {\nscrollbar-width: none;\n}\n\n.sidebar-logo {\npadding: 16px 12px;\nbackground: url(\"/banner6.png\") no-repeat center;\nbackground-size: contain;\n}\n\n/* D√∂lj texten men beh√•ll den f√∂r sk√§rml√§sare */\n.sidebar-logo-text {\nfont-size: 0;\n}\n/* ===== REFLINK HEADER / APP-BAR ===== */\n\n/* Se till att inneh√•llet i topbaren ligger v√§nster, inte centrerat */\n.nrdb-app-bar .v-toolbar__content {\njustify-content: flex-start !important;\n}\n\n/* Titel-raden (d√§r REFBOARD-texten ligger) */\n.nrdb-app-bar-title,\n.v-app-bar-title,\n.nrdb-app-bar .v-toolbar-title {\ndisplay: flex !important;\nalign-items: center !important;\ngap: 18px !important; /* avst√•nd mellan logga och sidtitel */\nmargin-left: 18px !important;/* lite luft fr√•n v√§nsterkant */\n}\n\n/* Sj√§lva REFLINK-bannern */\n.nrdb-app-bar-title::before,\n.v-app-bar-title::before,\n.nrdb-app-bar .v-toolbar-title::before {\ncontent: \"\";\ndisplay: inline-block;\nwidth: 210px; /* st√∂rre banner */\nheight: 46px; /* lite h√∂gre */\nbackground: url(\"/banner2.png\") no-repeat left center;\nbackground-size: contain;\n}",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:style",
        "className": "",
        "x": 230,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "sidebar-menu-js",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "Sidebar Menu JS",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<script>\n  (function() {\n  const MENU_HTML = `\n<div class=\"custom-sidebar\">\n  <div class=\"sidebar-logo\">\n    <span class=\"sidebar-logo-text\">‚ùÑ REFLINK</span>\n  </div>\n\n  \n  <!-- ANL√ÑGGNING -->\n  <div class=\"menu-section-title\">ANL√ÑGGNING</div>\n  <a class=\"menu-item\" href=\"/dashboard/2\">\n    <span class=\"menu-item-icon\">üìä</span>\n    <span class=\"menu-item-text\">Refboard</span>\n  </a>\n  <a class=\"menu-item\" href=\"/dashboard/page1\">\n    <span class=\"menu-item-icon\">üéõÔ∏è</span>\n    <span class=\"menu-item-text\">Kontrollrum</span>\n  </a>\n  <!-- Larm flyttat hit -->\n  <a class=\"menu-item\" href=\"/dashboard/alarms\">\n    <span class=\"menu-item-icon\">üîî</span>\n    <span class=\"menu-item-text\">Larm</span>\n  </a>\n  \n  <!-- NODER -->\n  <div class=\"menu-section-title\">NODER</div>\n  <a class=\"menu-item\" href=\"/dashboard/scan\">\n    <span class=\"menu-item-icon\">üì°</span>\n    <span class=\"menu-item-text\">Scanna</span>\n  </a>\n  <a class=\"menu-item\" href=\"/dashboard/addresses\">\n    <span class=\"menu-item-icon\">üìç</span>\n    <span class=\"menu-item-text\">Adresser</span>\n  </a>\n  <a class=\"menu-item\" href=\"/dashboard/logging\">\n    <span class=\"menu-item-icon\">üìù</span>\n    <span class=\"menu-item-text\">Loggning</span>\n  </a>\n  <a class=\"menu-item\" href=\"/dashboard/config\">\n    <span class=\"menu-item-icon\">‚öôÔ∏è</span>\n    <span class=\"menu-item-text\">Konfiguration</span>\n  </a>\n  \n  <!-- SYSTEM -->\n  <div class=\"menu-section-title\">SYSTEM</div>\n  <div class=\"menu-item\" data-toggle=\"settings\">\n    <span class=\"menu-item-icon\">‚öôÔ∏è</span>\n    <span class=\"menu-item-text\">Inst√§llningar</span>\n    <span class=\"menu-item-arrow\">‚ñº</span>\n  </div>\n  <div class=\"submenu\" id=\"submenu-settings\">\n    <a class=\"submenu-item\" href=\"/dashboard/serial\">Serieportar</a>\n    <a class=\"submenu-item\" href=\"/dashboard/network\">N√§tverk</a>\n    <a class=\"submenu-item\" href=\"/dashboard/protocols\">Protokoll</a>\n    <a class=\"submenu-item\" href=\"/dashboard/system\">System</a>\n    <a class=\"submenu-item\" href=\"/dashboard/security\">S√§kerhet</a>\n    <a class=\"submenu-item\" href=\"/dashboard/diagnostics\">Diagnostik</a>\n  </div>\n  <a class=\"menu-item\" href=\"/dashboard/statistics\">\n    <span class=\"menu-item-icon\">üìà</span>\n    <span class=\"menu-item-text\">Statistik</span>\n  </a>\n  <!-- Verktyg flyttat hit -->\n  <a class=\"menu-item\" href=\"/dashboard/overview\">\n    <span class=\"menu-item-icon\">üîß</span>\n    <span class=\"menu-item-text\">Verktyg</span>\n  </a>\n</div>\n`;\n\n  function injectSidebar() {\n    const drawer = document.querySelector('.v-navigation-drawer__content');\n    if (!drawer) return;\n    \n    // Check if already injected\n    if (drawer.querySelector('.custom-sidebar')) return;\n    \n    // Create and inject menu\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = MENU_HTML;\n    drawer.appendChild(wrapper.firstElementChild);\n    \n    // Setup dropdown toggles\n    document.querySelectorAll('[data-toggle]').forEach(el => {\n      el.addEventListener('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const target = this.getAttribute('data-toggle');\n        const submenu = document.getElementById('submenu-' + target);\n        const arrow = this.querySelector('.menu-item-arrow');\n        if (submenu) {\n          submenu.classList.toggle('open');\n          if (arrow) arrow.classList.toggle('open');\n          // Save state\n          sessionStorage.setItem('submenu-' + target, submenu.classList.contains('open'));\n        }\n      });\n    });\n    \n    // Restore dropdown states and highlight active\n    const path = window.location.pathname;\n    \n    // Restore saved dropdown states\n    document.querySelectorAll('.submenu').forEach(submenu => {\n      const id = submenu.id.replace('submenu-', '');\n      if (sessionStorage.getItem('submenu-' + id) === 'true') {\n        submenu.classList.add('open');\n        const toggle = document.querySelector('[data-toggle=\"' + id + '\"]');\n        if (toggle) {\n          const arrow = toggle.querySelector('.menu-item-arrow');\n          if (arrow) arrow.classList.add('open');\n        }\n      }\n    });\n    \n    // Highlight active menu item\n    document.querySelectorAll('.menu-item[href], .submenu-item[href]').forEach(el => {\n      if (el.getAttribute('href') === path) {\n        el.classList.add('active');\n        const submenu = el.closest('.submenu');\n        if (submenu) {\n          submenu.classList.add('open');\n          const id = submenu.id.replace('submenu-', '');\n          sessionStorage.setItem('submenu-' + id, 'true');\n          const toggle = document.querySelector('[data-toggle=\"' + id + '\"]');\n          if (toggle) {\n            const arrow = toggle.querySelector('.menu-item-arrow');\n            if (arrow) arrow.classList.add('open');\n          }\n        }\n      }\n    });\n    \n    console.log('REFLINK Sidebar injected');\n  }\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', injectSidebar);\n  } else {\n    injectSidebar();\n  }\n  setTimeout(injectSidebar, 300);\n  setTimeout(injectSidebar, 600);\n  setTimeout(injectSidebar, 1000);\n  setTimeout(injectSidebar, 2000);\n  setInterval(injectSidebar, 2000);\n})();\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:head",
        "className": "",
        "x": 250,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d837cc09ff57527e",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "ALL APP",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "\n</style>\n\n.body, .html, .#app {\n  background: url('/public/scan-bg9.png') no-repeat center center fixed !important;\n  background-size: cover !important;\n}\n*/\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:style",
        "className": "",
        "x": 220,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "6fa8f68486285307",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "71605fc57a3c19c1",
        "ui": "",
        "name": "Kontrollrum template",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* KONTROLLRUM ‚Äì bakgrund */\nbody {\n  background:\n    radial-gradient(circle at top left, rgba(56,189,248,0.20), transparent 55%),\n    radial-gradient(circle at bottom right, rgba(248,113,113,0.18), transparent 55%),\n    url(\"/control-bg.png\") no-repeat center center fixed !important;\n  background-size: cover !important;\n}\n\n/* KORT I KONTROLLRUM */\n.v-card {\n  background: rgba(255, 255, 255, 0.2) !important;\n  border-radius: 18px !important;\n  border: 1px solid rgba(148, 163, 184, 0.55) !important;\n  box-shadow: 0 16px 40px rgba(15, 23, 42, 0.75) !important;\n  color: #F9FAFB !important;\n}\n\n/* Lite snyggare text */\n.nrdb-group-title {\n  font-weight: 800;\n  letter-spacing: 0.08em;\n  text-transform: uppercase;\n  font-size: 16px;\n  color: #ffffff;\n}\n\n.nrdb-widget-label,\n.nrdb-widget-value,\nspan,\np {\n  color: #E5E7EB;\n}\n\n/* Enheter / sm√•texter */\n.nrdb-widget-unit,\n.nrdb-widget-sublabel {\n  color: #000FF;\n  font-size: 11px;\n}\nbody {\n  background: url('/bg11.png') no-repeat center center fixed !important;\n  background-size: cover !important;\n}\n\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 680,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "a8e16b6141029bd3",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "71605fc57a3c19c1",
        "ui": "",
        "name": "",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ==== KONTROLLRUM ‚Äì KNAPPSTILER (Dashboard 2) ==== */\n\n/* Prim√§r knapp ‚Äì container har klassen, vi stylar knappen inuti */\n.ctrl-btn-primary button.v-btn {\n  background: linear-gradient(135deg, #5508ad93, #0372a1) !important;\n  color: #020617 !important;\n  border-radius: 18px !important;\n  font-weight: 600 !important;\n  padding: 4px 18px !important;\n  text-transform: none !important;\n}\n\n/* Hover-effekt */\n.ctrl-btn-primary button.v-btn:hover {\n  filter: brightness(1.1);\n}\n\n/* Sekund√§r knapp */\n.ctrl-btn-secondary button.v-btn {\n  background: transparent !important;\n  color: #E5E7EB !important;\n  border-radius: 999px !important;\n  border: 1px solid rgba(148,163,184,0.7) !important;\n  font-weight: 500 !important;\n  padding: 4px 18px !important;\n  text-transform: none !important;\n}\n\n/* Hover p√• sekund√§r */\n.ctrl-btn-secondary button.v-btn:hover {\n  background: rgba(148,163,184,0.20) !important;\n}\n /* ==== KONTROLLRUM ‚Äì AK-CC55 TABELL (Dashboard 2) ==== */\n\n/* Widget-container runt tabellen */\n.akcc-table {\n  background: transparent !important;\n  border-radius: 16px !important;\n  padding: 4px !important;\n}\n\n/* Sj√§lva Vuetify-tabellen (b√•de v-table och v-data-table) */\n.akcc-table .v-table,\n.akcc-table .v-data-table {\n  background-color: rgba(73, 27, 255, 0.557) !important; /* transparent #1BBFFF */\n  border-radius: 16px !important;\n  overflow: hidden !important;\n}\n\n/* Header-rad */\n.akcc-table .v-table thead tr th,\n.akcc-table .v-data-table thead tr th {\n  background-color: rgba(27, 191, 255, 0.35) !important;\n  color: #ffffff !important;\n  font-weight: 600 !important;\n  border-bottom: 1px solid rgba(255,255,255,0.2) !important;\n}\n\n/* Vanliga celler */\n.akcc-table .v-table tbody tr td,\n.akcc-table .v-data-table tbody tr td {\n  background-color: rgba(27, 191, 255, 0.15) !important;\n  color: #ffffff !important;\n  border-bottom: 1px solid rgba(255,255,255,0.08) !important;\n}\n\n/* Hover-effekt p√• rad */\n.akcc-table .v-table tbody tr:hover td,\n.akcc-table .v-data-table tbody tr:hover td {\n  background-color: rgba(27, 191, 255, 0.35) !important;\n}\n\n/* Ta ev. bort ‚Äúalternating rows‚Äù om tema l√§gger in det */\n.akcc-table .v-table tbody tr:nth-child(even) td,\n.akcc-table .v-data-table tbody tr:nth-child(even) td {\n  background-color: rgba(27, 191, 255, 0.12) !important;\n}\n\n/* ==== KONTROLLRUM ‚Äì STATUSF√ÑRGER I AK-CC-TABELL ==== */\n\n/* Status: OK */\n.akcc-table td:last-child {\n/* default f√∂r sista kolumnen = status */\nfont-weight: 600 !important;\n}\n\n/* Textmatchning via attribute selectors */\n.akcc-table td:last-child:has(> span:contains(\"OK\")),\n.akcc-table td:last-child:has(> div:contains(\"OK\")) {\ncolor: #22c55e !important; /* gr√∂n */\n}\n\n/* L√•g SH = gul/orange */\n.akcc-table td:last-child:has(> span:contains(\"L√•g SH\")),\n.akcc-table td:last-child:has(> div:contains(\"L√•g SH\")) {\ncolor: #eab308 !important;\n}\n\n/* H√∂g SH = r√∂d */\n.akcc-table td:last-child:has(> span:contains(\"H√∂g SH\")),\n.akcc-table td:last-child:has(> div:contains(\"H√∂g SH\")) {\ncolor: #ef4444 !important;\n}\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 650,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "5c903c9b38151e43",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "table",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<div class=\"ctrl-list\">\n  <!-- LISTA MED CONTROLLERS -->\n  <div class=\"ctrl-row\" v-for=\"c in msg.controllers\" :key=\"c.id\" @click=\"openQuick(c)\">\n\n    <div class=\"ctrl-main\">\n      <div class=\"ctrl-name\">{{ c.namn || c.id }}</div>\n      <div class=\"ctrl-sub\">\n        {{ c.typ }} ‚Ä¢\n        <span v-if=\"c.live && c.live.temp !== undefined\">\n          {{ c.live.temp }} ¬∞C\n        </span>\n        <span v-else>- ¬∞C</span>\n        ‚Ä¢ {{ (c.live && c.live.status) ? c.live.status : 'Ok√§nd' }}\n      </div>\n    </div>\n\n    <!-- TRE PRICKAR = AVANCERAT -->\n    <button class=\"ctrl-more\" @click.stop=\"openAdvanced(c)\">\n      &#8226;&#8226;&#8226;\n    </button>\n  </div>\n</div>\n\n<!-- SNABB-POPUP F√ñR PARAMETRAR -->\n<div class=\"quick-overlay\" v-if=\"showQuick\">\n  <div class=\"quick-dialog\">\n    <div class=\"qd-header\">\n      <div>\n        <div class=\"qd-title\">{{ quick.name }}</div>\n        <div class=\"qd-sub\">{{ quick.type }} ‚Ä¢ {{ quick.id }}</div>\n      </div>\n      <button class=\"qd-close\" @click=\"closeQuick\">‚úï</button>\n    </div>\n\n    <div class=\"qd-body\">\n      <!-- B√∂rv√§rde -->\n      <div class=\"qp-row\">\n        <label>B√∂rv√§rde</label>\n        <input type=\"number\"\n               v-model.number=\"quick.setpoint\" />\n        <span class=\"unit\">¬∞C</span>\n      </div>\n\n      <!-- Avfrostningsintervall -->\n      <div class=\"qp-row\">\n        <label>Avfrostningsintervall</label>\n        <input type=\"number\"\n               v-model.number=\"quick.defrostInterval\" />\n        <span class=\"unit\">min</span>\n      </div>\n\n      <!-- Fl√§ktl√§ge -->\n      <div class=\"qp-row\">\n        <label>Fl√§ktl√§ge</label>\n        <select v-model=\"quick.fanMode\">\n          <option :value=\"0\">Med kompressor</option>\n          <option :value=\"1\">Kontinuerlig</option>\n        </select>\n      </div>\n    </div>\n\n    <div class=\"qd-footer\">\n      <button class=\"btn-secondary\" @click=\"openAdvancedFromQuick\">\n        Alla parametrar‚Ä¶\n      </button>\n      <div class=\"qd-spacer\"></div>\n      <button class=\"btn-ghost\" @click=\"closeQuick\">Avbryt</button>\n      <button class=\"btn-primary\" @click=\"saveQuick\">Spara</button>\n    </div>\n  </div>\n</div>\n\n<script>\n  (function(scope) {\n    // Lokalt UI-state\n    scope.showQuick = false;\n    scope.quick = null;\n\n    // √ñppna snabb-popup (klick p√• rad)\n    scope.openQuick = function(c) {\n      scope.quick = {\n        id:   c.id,\n        name: c.namn || c.id,\n        type: c.typ,\n        // F√∂rifyll fr√•n live-data om det finns, annars standard\n        setpoint:         c.live && c.live.setpoint        !== undefined ? c.live.setpoint        : 2,\n        defrostInterval:  c.live && c.live.defrostInterval !== undefined ? c.live.defrostInterval : 180,\n        fanMode:          c.live && c.live.fanMode         !== undefined ? c.live.fanMode         : 0\n      };\n      scope.showQuick = true;\n      scope.$evalAsync(); // s√§kerst√§ll uppdatering\n    };\n\n    // St√§ng snabb-popup\n    scope.closeQuick = function() {\n      scope.showQuick = false;\n      scope.$evalAsync();\n    };\n\n    // Spara snabb-parametrar ‚Üí skicka till Node-RED\n    scope.saveQuick = function() {\n      if (!scope.quick) return;\n      scope.send({\n        topic: \"quick-save\",\n        payload: scope.quick\n      });\n      scope.showQuick = false;\n      scope.$evalAsync();\n    };\n\n    // Tre prickar p√• raden ‚Üí Avancerat\n    scope.openAdvanced = function(c) {\n      scope.send({\n        topic: \"advanced\",\n        payload: { id: c.id }\n      });\n    };\n\n    // ‚ÄúAlla parametrar‚Ä¶‚Äù inifr√•n popupen\n    scope.openAdvancedFromQuick = function() {\n      if (!scope.quick) return;\n      scope.send({\n        topic: \"advanced\",\n        payload: { id: scope.quick.id, from: \"quick-dialog\" }\n      });\n    };\n\n  })(scope);\n</script>\n\n<style>\n  /* ===== LISTA ===== */\n  .ctrl-list {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n  }\n\n  .ctrl-row {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 6px 10px;\n    border-radius: 10px;\n    cursor: pointer;\n    background: rgba(15, 23, 42, 0.7);\n  }\n\n  .ctrl-row:hover {\n    background: rgba(15, 23, 42, 0.9);\n  }\n\n  .ctrl-main {\n    display: flex;\n    flex-direction: column;\n  }\n\n  .ctrl-name {\n    font-weight: 600;\n  }\n\n  .ctrl-sub {\n    font-size: 0.8rem;\n    opacity: 0.8;\n  }\n\n  .ctrl-more {\n    border: none;\n    background: transparent;\n    font-size: 1.2rem;\n    line-height: 1;\n    cursor: pointer;\n    padding: 2px 4px;\n    color: #e5e7eb;\n  }\n\n  /* ===== POPUP-OVERLAY ===== */\n  .quick-overlay {\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.55);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 9999;\n  }\n\n  .quick-dialog {\n    background: #020617;\n    border-radius: 16px;\n    padding: 14px 16px 12px 16px;\n    min-width: 260px;\n    max-width: 360px;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);\n    border: 1px solid rgba(148, 163, 184, 0.4);\n  }\n\n  /* HEADER */\n  .qd-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n  }\n\n  .qd-title {\n    font-weight: 600;\n  }\n\n  .qd-sub {\n    font-size: 0.75rem;\n    opacity: 0.7;\n  }\n\n  .qd-close {\n    border: none;\n    background: transparent;\n    color: #9ca3af;\n    cursor: pointer;\n    font-size: 1rem;\n  }\n\n  /* BODY */\n  .qd-body {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 10px;\n  }\n\n  .qp-row {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .qp-row label {\n    flex: 0 0 120px;\n    font-size: 0.8rem;\n  }\n\n  .qp-row input,\n  .qp-row select {\n    flex: 1 1 auto;\n    padding: 3px 6px;\n    border-radius: 6px;\n    border: 1px solid rgba(148, 163, 184, 0.6);\n    background: #020617;\n    color: #e5e7eb;\n    font-size: 0.8rem;\n  }\n\n  .qp-row .unit {\n    flex: 0 0 30px;\n    font-size: 0.8rem;\n    opacity: 0.8;\n  }\n\n  /* FOOTER / KNAPPAR */\n  .qd-footer {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-top: 4px;\n  }\n\n  .qd-spacer {\n    flex: 1 1 auto;\n  }\n\n  .btn-primary,\n  .btn-ghost,\n  .btn-secondary {\n    border-radius: 999px;\n    padding: 4px 12px;\n    font-size: 0.8rem;\n    border: 1px solid transparent;\n    cursor: pointer;\n  }\n\n  .btn-primary {\n    background: linear-gradient(135deg, #1bbfff, #0372a1);\n    color: #020617;\n    font-weight: 600;\n  }\n\n  .btn-primary:hover {\n    filter: brightness(1.1);\n  }\n\n  .btn-ghost {\n    background: transparent;\n    color: #e5e7eb;\n    border-color: rgba(148, 163, 184, 0.5);\n  }\n\n  .btn-secondary {\n    background: transparent;\n    color: #e5e7eb;\n    border-color: rgba(148, 163, 184, 0.3);\n    opacity: 0.85;\n  }\n\n  .btn-secondary:hover,\n  .btn-ghost:hover {\n    background: rgba(15, 23, 42, 0.9);\n  }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:style",
        "className": "akcc-table",
        "x": 630,
        "y": 160,
        "wires": [
            [
                "0234437416940166",
                "a1e6287d914b0b01"
            ]
        ]
    },
    {
        "id": "8e2dd0593c0ad671",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "23024e263184d0e6",
        "ui": "",
        "name": "REFBOARD template",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ============================\n   REFBOARD ‚Äì PAGE TEMPLATE\n   ============================ */\n\n/* Bakgrund f√∂r REFBOARD-sidan */\nbody {\n  background: url('/bg15.png') no-repeat center center fixed !important;\n  background-size: cover !important;\n}\n\n/* ---------------------------------\n   KORT / CARDS\n   --------------------------------- */\n\n.v-card {\n  background: rgba(255, 255, 255, 0.2) !important;\n  border-radius: 18px !important;\n  border: 1px solid rgba(130, 17, 236, 0.006) !important;\n  box-shadow: 0 16px 40px rgba(15, 23, 42, 0.75) !important;\n  color: #f2f5f785 !important;\n}\n\n/* ---------------------------------\n   RUBRIKER & TEXT\n   --------------------------------- */\n\n/* Grupp-titlar */\n.nrdb-group-title {\n  font-weight: 800;\n  letter-spacing: 0.08em;\n  text-transform: uppercase;\n  font-size: 16px;\n  color: #ffffff;\n}\n\n/* Generell text i widgets */\n.nrdb-widget-label,\n.nrdb-widget-value,\nspan,\np {\n  color: #f7f8fabf;\n}\n\n/* Enheter / sm√•texter */\n.nrdb-widget-unit,\n.nrdb-widget-sublabel {\n  color: #1BBFFF;\n  font-size: 11px;\n}\n\n/* ---------------------------------\n   KNAPPAR ‚Äì G√ÑLLER BARA REFBOARD\n   (sidan har klassen .ref-page)\n   --------------------------------- */\n\n/* Prim√§r knapp ‚Äì container har klassen ctrl-btn-primary */\n.ref-page .ctrl-btn-primary button.v-btn {\n  background: linear-gradient(135deg, #5508ad93, #0372a1) !important;\n  color: #020617 !important;\n  border-radius: 18px !important;\n  font-weight: 600 !important;\n  padding: 4px 18px !important;\n  text-transform: none !important;\n}\n\n/* Hover-effekt prim√§r */\n.ref-page .ctrl-btn-primary button.v-btn:hover {\n  filter: brightness(1.1);\n}\n\n/* Sekund√§r knapp */\n.ref-page .ctrl-btn-secondary button.v-btn {\n  background: transparent !important;\n  color: #E5E7EB !important;\n  border-radius: 999px !important;\n  border: 1px solid rgba(148,163,184,0.7) !important;\n  font-weight: 500 !important;\n  padding: 4px 18px !important;\n  text-transform: none !important;\n}\n\n/* Hover p√• sekund√§r */\n.ref-page .ctrl-btn-secondary button.v-btn:hover {\n  background: rgba(148,163,184,0.20) !important;\n}\n\n/* ---------------------------------\n   TABELLER ‚Äì G√ÑLLER BARA REFBOARD\n   --------------------------------- */\n\n/* Widget-container runt tabellen (om du anv√§nder denna klassen) */\n.v-card.larm-ctrl-group .akcc-table {\n  background: transparent !important;\n  border-radius: 16px !important;\n  padding: 4px !important;\n}\n\n/* Sj√§lva Vuetify-tabellen (v-table / v-data-table) */\n.ref-page .v-table,\n.ref-page .v-data-table {\n  background-color: rgba(53, 3, 252, 0.551) !important; /* transparent bl√• */\n  border-radius: 16px !important;\n  overflow: hidden !important;\n}\n\n/* Header-rad */\n.ref-page .v-table thead tr th,\n.ref-page .v-data-table thead tr th {\n  background-color: rgba(27, 191, 255, 0.35) !important;\n  color: #ffffff !important;\n  font-weight: 600 !important;\n  border-bottom: 1px solid rgba(255,255,255,0.2) !important;\n}\n\n/* Vanliga celler */\n.ref-page .v-table tbody tr td,\n.ref-page .v-data-table tbody tr td {\n  background-color: rgba(27, 191, 255, 0.15) !important;\n  color: #ffffff !important;\n  border-bottom: 1px solid rgba(255,255,255,0.08) !important;\n}\n\n/* Hover-effekt p√• rad */\n.ref-page .v-table tbody tr:hover td,\n.ref-page .v-data-table tbody tr:hover td {\n  background-color: rgba(27, 191, 255, 0.35) !important;\n}\n\n/* Ta bort ev. alternating rows fr√•n tema */\n.ref-page .v-table tbody tr:nth-child(even) td,\n.ref-page .v-data-table tbody tr:nth-child(even) td {\n  background-color: rgba(27, 191, 255, 0.12) !important;\n}\n\n/* Sista kolumnen (t.ex. status) lite fetare */\n.ref-page td:last-child {\n  font-weight: 600 !important;\n}\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "ref-page",
        "x": 280,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "6d208385af8fb907",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "23024e263184d0e6",
        "ui": "",
        "name": "",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<div class=\"ctrl-header-left\">\n    <button class=\"ctrl-back-btn\" onclick=\"window.history.back()\">\n    ‚Üê Tillbaka\n  </button>\n</div>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "widget:page",
        "className": "",
        "x": 220,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "0234437416940166",
        "type": "debug",
        "z": "de23328697951a0d",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "complete msg object",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 160,
        "wires": []
    },
    {
        "id": "a1e6287d914b0b01",
        "type": "switch",
        "z": "de23328697951a0d",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "== quick",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "== quick-save",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "== advanced",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 790,
        "y": 280,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "5d4a660b638615a9",
        "type": "ui-template",
        "z": "de23328697951a0d",
        "group": "",
        "page": "23024e263184d0e6",
        "ui": "",
        "name": "",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ==== LARM ‚Äì KNAPPSTILER (Dashboard 2) ==== */\n\n/* Prim√§r knapp ‚Äì container har klassen, vi stylar knappen inuti */\n.v-card.ref-page .ctrl-btn-primary button.v-btn {\n  background: linear-gradient(135deg, #5508ad93, #0372a1) !important;\n  color: #020617 !important;\n  border-radius: 18px !important;\n  font-weight: 600 !important;\n  padding: 4px 18px !important;\n  text-transform: none !important;\n}\n\n/* Hover-effekt */\n.v-card.ref-page .ctrl-btn-primary button.v-btn:hover {\n  filter: brightness(1.1);\n}\n\n/* Sekund√§r knapp */\n.v-card.ref-page .ctrl-btn-secondary button.v-btn {\n  background: transparent !important;\n  color: #E5E7EB !important;\n  border-radius: 999px !important;\n  border: 1px solid rgba(148,163,184,0.7) !important;\n  font-weight: 500 !important;\n  padding: 4px 18px !important;\n  text-transform: none !important;\n}\n\n/* Hover p√• sekund√§r */\n.v-card.ref-page .ctrl-btn-secondary button.v-btn:hover {\n  background: rgba(148,163,184,0.20) !important;\n}\n\n\n/* ==== LARM ‚Äì TABELL (Dashboard 2) ==== */\n\n/* Widget-container runt tabellen */\n.v-card.larm-ctrl-group .akcc-table {\n  background: transparent !important;\n  border-radius: 16px !important;\n  padding: 4px !important;\n}\n\n/* Sj√§lva Vuetify-tabellen (b√•de v-table och v-data-table) */\n.v-card.ref-page .v-table,\n.v-card.ref-page .v-data-table {\n  background-color: rgba(73, 27, 255, 0.5) !important; /* transparent #1BBFFF */\n  border-radius: 16px !important;\n  overflow: hidden !important;\n}\n\n/* Header-rad */\n.v-card.ref-page .v-table thead tr th,\n.v-card.ref-page .v-data-table thead tr th {\n  background-color: rgba(27, 191, 255, 0.35) !important;\n  color: #ffffff !important;\n  font-weight: 600 !important;\n  border-bottom: 1px solid rgba(255,255,255,0.2) !important;\n}\n\n/* Vanliga celler */\n.v-card.ref-page .v-table tbody tr td,\n.v-card.ref-page .v-data-table tbody tr td {\n  background-color: rgba(27, 191, 255, 0.15) !important;\n  color: #ffffff !important;\n  border-bottom: 1px solid rgba(255,255,255,0.08) !important;\n}\n\n/* Hover-effekt p√• rad */\n.v-card.ref-page .v-table tbody tr:hover td,\n.v-card.ref-page .v-data-table tbody tr:hover td {\n  background-color: rgba(27, 191, 255, 0.35) !important;\n}\n\n/* Ta ev. bort ‚Äúalternating rows‚Äù om tema l√§gger in det */\n.v-card.ref-page .v-table tbody tr:nth-child(even) td,\n.v-card.ref-page .v-data-table tbody tr:nth-child(even) td {\n  background-color: rgba(27, 191, 255, 0.12) !important;\n}\n\n\n/* ==== LARM ‚Äì STATUSF√ÑRGER I TABELL ==== */\n\n/* Status: sista kolumnen */\n.v-card.ref-page td:last-child {\n  font-weight: 600 !important;\n}\n\n/* OBS: :contains funkar inte i ‚Äúriktig‚Äù CSS, bara i t.ex. jQuery.\n   S√• detta kanske INTE funkar i Node-RED/Chromium.\n   L√§mnar kvar om du provar, annars f√•r vi l√∂sa statusf√§rg med t.ex. klasser via msg. */\n\n/* Status: OK */\n.v-card.ref-page td:last-child:has(> span:contains(\"OK\")),\n.v-card.ref-page td:last-child:has(> div:contains(\"OK\")) {\n  color: #22c55e !important; /* gr√∂n */\n}\n\n/* L√•g SH = gul/orange */\n.v-cardref-page td:last-child:has(> span:contains(\"L√•g SH\")),\n.v-card.ref-page td:last-child:has(> div:contains(\"L√•g SH\")) {\n  color: #eab308 !important;\n}\n\n/* H√∂g SH = r√∂d */\n.v-card.ref-page td:last-child:has(> span:contains(\"H√∂g SH\")),\n.v-card.ref-page td:last-child:has(> div:contains(\"H√∂g SH\")) {\n  color: #ef4444 !important;\n}\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "ref-page",
        "x": 250,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "a078b83601fa50b0",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Ping-test",
        "label": "Ping-test",
        "order": 6,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "Ping-test",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 160,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "874409fbe6cb6263",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Port-test",
        "label": "Port-test",
        "order": 7,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 300,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "5a4943d6c874188c",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Modbus-test",
        "label": "Modbus-test",
        "order": 8,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 450,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "7538e684711afd34",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Snabbdiagnos",
        "label": "Servicel√§ge",
        "order": 1,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 620,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "71f4a2820fc35921",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Ping-test",
        "label": "√Ñndra B√∂rv√§rde",
        "order": 5,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 160,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "72f4e48e363ea444",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Port-test",
        "label": "On/Off Controllers",
        "order": 4,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 300,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "879ea296b33e365d",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Modbus-test",
        "label": "On/Off Maskiner",
        "order": 3,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 450,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "e3f1999bb644da6b",
        "type": "ui-button",
        "z": "493c5b8aa580413b",
        "group": "d564e1876232e645",
        "name": "Snabbdiagnos",
        "label": "Export Backup ",
        "order": 2,
        "width": "3",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "ctrl-btn-primary",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 620,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "e6d13c6c55941835",
        "type": "inject",
        "z": "493c5b8aa580413b",
        "name": "Fake trigger ak-cc",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "updateRefboard",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Refboard",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 260,
        "wires": [
            [
                "1b37507cd95d86fd"
            ]
        ]
    },
    {
        "id": "1b37507cd95d86fd",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "function 1",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// INITIERA REGULATORS + MACHINES - Reflink Message Standard\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// --- KYLAR (10 st) ---\n// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'processData';\nmsg.group = msg.group || 'Data';\n\n\nconst regulators = [];\nconst fridgeSetpoint = 4;\n\nfor (let i = 1; i <= 10; i++) {\n    const sh = 4 + Math.random() * 5;\n    const room = 3.9 + Math.random() * (6.1 - 3.9);\n    let status = \"OK\";\n    if (room < 4.0) status = \"Lite kall\";\n    if (room > 6.0) status = \"Lite varm\";\n\n    regulators.push({\n        row: i,\n        id: `node-${String(i).padStart(3, '0')}`,\n        deviceId: `node-${String(i).padStart(3, '0')}`,\n        name: `AK-CC55-${i.toString().padStart(2, \"0\")}`,\n        setpoint: `${fridgeSetpoint} ¬∞C`,\n        roomTemp: `${room.toFixed(1)} ¬∞C`,\n        superheatK: `${sh.toFixed(1)} K`,\n        status: status,\n        // Legacy format\n        namn: `AK-CC55-${i.toString().padStart(2, \"0\")}`,\n        typ: 'AK-CC55',\n        live: {\n            temp: parseFloat(room.toFixed(1)),\n            status: status,\n            setpoint: fridgeSetpoint,\n            defrostInterval: 180,\n            fanMode: 0\n        }\n    });\n}\n\n// --- FRYSSAR (4 st) ---\nconst freezerSetpoint = -22;\nfor (let i = 1; i <= 4; i++) {\n    const sh = 4 + Math.random() * 5;\n    const room = -22 + Math.random() * 3;\n    let status = \"OK\";\n    if (room > -20.0) status = \"Varm frys\";\n\n    regulators.push({\n        row: 10 + i,\n        id: `node-f${String(i).padStart(2, '0')}`,\n        deviceId: `node-f${String(i).padStart(2, '0')}`,\n        name: `AK-CC55-F${i.toString().padStart(2, \"0\")}`,\n        setpoint: `${freezerSetpoint} ¬∞C`,\n        roomTemp: `${room.toFixed(1)} ¬∞C`,\n        superheatK: `${sh.toFixed(1)} K`,\n        status: status,\n        namn: `AK-CC55-F${i.toString().padStart(2, \"0\")}`,\n        typ: 'AK-CC55',\n        live: {\n            temp: parseFloat(room.toFixed(1)),\n            status: status,\n            setpoint: freezerSetpoint,\n            defrostInterval: 360,\n            fanMode: 0\n        }\n    });\n}\n\n// --- MASKINER ---\nconst machines = [\n    { id: 1, name: \"Rack 1\", capacityPercent: 43, status: 'OK' },\n    { id: 2, name: \"Rack 2\", capacityPercent: 68, status: 'OK' },\n    { id: 3, name: \"Rack 3\", capacityPercent: 80, status: 'Varning' }\n];\n\n// --- SPARA GLOBALT ---\nconst reflink = global.get('reflink') || {};\nreflink.regulators = regulators;\nreflink.machines = machines;\nglobal.set('reflink', reflink);\nglobal.set('controllers', regulators);\n\nnode.status({ fill: 'green', shape: 'dot', text: `${regulators.length} ctrl, ${machines.length} mach` });\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// OUTPUT ENLIGT STANDARD\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nmsg.action = 'updateRefboard';\nmsg.group = 'Refboard';\nmsg.controllers = regulators;\nmsg.machines = machines;\nmsg.payload = regulators;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 260,
        "wires": [
            [
                "1d9c821e05dc7b82",
                "9e784102384b3076"
            ]
        ]
    },
    {
        "id": "1d9c821e05dc7b82",
        "type": "ui-table",
        "z": "493c5b8aa580413b",
        "group": "f68f985b729761f1",
        "name": "AK-CC55",
        "label": "",
        "order": 1,
        "width": "0",
        "height": "0",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": true,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "#",
                "key": "row",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Regulator",
                "key": "name",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Temperatur (¬∞C)",
                "key": "roomTemp",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "SP (¬∞C)",
                "key": "setpoint",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Superheat (k)",
                "key": "superheatK",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Status",
                "key": "status",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 600,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "9e784102384b3076",
        "type": "link out",
        "z": "493c5b8aa580413b",
        "name": "DATA: CONTROLLERS",
        "mode": "link",
        "links": [
            "6207f84beee3e7ca"
        ],
        "x": 555,
        "y": 240,
        "wires": []
    },
    {
        "id": "59d159d3fe8c3d95",
        "type": "ui-switch",
        "z": "493c5b8aa580413b",
        "name": "",
        "label": "switch",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-spread",
        "clickableArea": "switch",
        "onvalue": true,
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": false,
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 930,
        "y": 160,
        "wires": [
            []
        ],
        "group": "f68f985b729761f1"
    },
    {
        "id": "c740bb8e33ec124e",
        "type": "inject",
        "z": "493c5b8aa580413b",
        "name": "refboard data",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "updateRefboard",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Refboard",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 460,
        "wires": [
            [
                "940cf3fa6113fa8b",
                "dab0d1e7f1a042d3",
                "4f7dc647323baf23",
                "7a5eb9bbab30aa42"
            ]
        ]
    },
    {
        "id": "48cbbd9cd04dbb84",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "AK-cc kylar",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// AK-CC KYLAR - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showKylar';\nmsg.group = msg.group || 'Kylar';\n\nconst regs = global.get(\"reflink.regulators\") || [];\n\nconst kylar = regs.filter(r => {\n    // Kolla p√• setpoint >= 0 (s√§krare √§n namn)\n    const sp = parseFloat((r.setpoint || '0').toString().replace(/[^0-9.-]/g, ''));\n    return !isNaN(sp) && sp >= 0;\n});\n\nmsg.controllers = kylar;\nmsg.payload = kylar;\nmsg.count = kylar.length;\n\nnode.status({ fill: 'green', shape: 'dot', text: `${kylar.length} kylar` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "940cf3fa6113fa8b",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "AK-cc frysar",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// AK-CC FRYSAR - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showFrysar';\nmsg.group = msg.group || 'Frysar';\n\nconst regs = global.get(\"reflink.regulators\") || [];\n\nconst frysar = regs.filter(r => {\n    const sp = parseFloat((r.setpoint || '0').toString().replace(/[^0-9.-]/g, ''));\n    return !isNaN(sp) && sp < 0;\n});\n\nmsg.controllers = frysar;\nmsg.payload = frysar;\nmsg.count = frysar.length;\n\nnode.status({ fill: 'blue', shape: 'dot', text: `${frysar.length} frysar` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 380,
        "wires": [
            [
                "04b752f7fa025c49"
            ]
        ]
    },
    {
        "id": "affbc91c800419a3",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "Maskiner",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// MASKINER - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showMachines';\nmsg.group = msg.group || 'Machines';\n\nconst maxHz = 70;\nconst machines = (global.get(\"reflink.machines\") || []).map(m => {\n    const hz = (m.capacityPercent / 100) * maxHz;\n    return {\n        ...m,\n        freqHz: hz.toFixed(1) + \" Hz\"\n    };\n});\n\nmsg.machines = machines;\nmsg.payload = machines;\nmsg.count = machines.length;\n\nnode.status({ fill: 'green', shape: 'dot', text: `${machines.length} maskiner` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "04b752f7fa025c49",
        "type": "ui-table",
        "z": "493c5b8aa580413b",
        "name": "",
        "label": "",
        "order": 0,
        "width": 0,
        "height": 0,
        "maxrows": 0,
        "passthru": false,
        "autocols": true,
        "showSearch": true,
        "deselect": true,
        "selectionType": "none",
        "columns": null,
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "append",
        "className": "",
        "x": 510,
        "y": 380,
        "wires": [
            []
        ],
        "group": "f68f985b729761f1"
    },
    {
        "id": "dab0d1e7f1a042d3",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "refboard enhets list Layout",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// REFBOARD KYLAR LAYOUT - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showKylar';\nmsg.group = msg.group || 'Kylar';\n\nconst regs = global.get(\"reflink.regulators\") || [];\n\nfunction fmtTemp(str) {\n    if (!str || typeof str !== \"string\") return \"‚Äì\";\n    let s = str.trim().replace(\",\", \".\").replace(\".\", \",\");\n    s = s.replace(/¬∞?C$/i, \"\").trim();\n    return s + \" ¬∞C\";\n}\n\nconst kylar = regs.filter(r => {\n    const sp = parseFloat((r.setpoint || \"0\").toString().replace(/[^0-9.-]/g, \"\"));\n    return !isNaN(sp) && sp >= 0;\n});\n\nconst rows = kylar\n    .slice()\n    .sort((a, b) => (a.row || 0) - (b.row || 0))\n    .map(r => ({\n        row: r.row,\n        namn: r.name || r.namn,\n        varde: `${fmtTemp(r.roomTemp)} (${fmtTemp(r.setpoint)})`,\n        status: r.status || \"OK\"\n    }));\n\nmsg.payload = rows;\nmsg.count = rows.length;\n\nnode.status({ fill: 'green', shape: 'dot', text: `${rows.length} kylar` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 460,
        "wires": [
            [
                "f032ad5cac0126b8"
            ]
        ]
    },
    {
        "id": "f032ad5cac0126b8",
        "type": "ui-table",
        "z": "493c5b8aa580413b",
        "group": "0f46ecdf93377d8e",
        "name": "Kylar",
        "label": "",
        "order": 1,
        "width": "3",
        "height": "1",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": true,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "#",
                "key": "row",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Namn",
                "key": "namn",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "√Ñr (B√∂r)",
                "key": "varde",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 650,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "1925859c9c6aa50c",
        "type": "ui-table",
        "z": "493c5b8aa580413b",
        "group": "b8abf29b08652e6d",
        "name": "Frysar",
        "label": "Frysar",
        "order": 1,
        "width": "3",
        "height": "1",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": true,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "#",
                "key": "row",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Namn",
                "key": "namn",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "√Ñr (B√∂r)",
                "key": "varde",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 650,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "4f7dc647323baf23",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "refboard enhetsfrys list Layout",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// REFBOARD FRYSAR LAYOUT - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showFrysar';\nmsg.group = msg.group || 'Frysar';\n\nconst regs = global.get(\"reflink.regulators\") || [];\n\nfunction fmtTemp(str) {\n    if (!str || typeof str !== \"string\") return \"‚Äì\";\n    let s = str.trim().replace(\",\", \".\").replace(\".\", \",\");\n    s = s.replace(/¬∞?C$/i, \"\").trim();\n    return s + \" ¬∞C\";\n}\n\nconst frysar = regs.filter(r => {\n    const sp = parseFloat((r.setpoint || \"0\").toString().replace(/[^0-9.-]/g, \"\"));\n    return !isNaN(sp) && sp < 0;\n});\n\nconst rows = frysar\n    .slice()\n    .sort((a, b) => (a.row || 0) - (b.row || 0))\n    .map(r => ({\n        row: r.row,\n        namn: r.name || r.namn,\n        varde: `${fmtTemp(r.roomTemp)} (${fmtTemp(r.setpoint)})`,\n        status: r.status || \"OK\"\n    }));\n\nmsg.payload = rows;\nmsg.count = rows.length;\n\nnode.status({ fill: 'blue', shape: 'dot', text: `${rows.length} frysar` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 500,
        "wires": [
            [
                "1925859c9c6aa50c"
            ]
        ]
    },
    {
        "id": "1307d93aab4908db",
        "type": "ui-gauge",
        "z": "493c5b8aa580413b",
        "name": "KS-1",
        "group": "c596de87c9e2efac",
        "order": 1,
        "value": "payload",
        "valueType": "msg",
        "width": 3,
        "height": "4",
        "gtype": "gauge-34",
        "gstyle": "rounded",
        "title": "Ks-1",
        "alwaysShowTitle": false,
        "floatingTitlePosition": "top-left",
        "units": "Hz",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#0058bb",
                "text": "70",
                "textType": "str"
            }
        ],
        "min": 0,
        "max": "70",
        "sizeThickness": "6",
        "sizeGap": "6",
        "sizeKeyThickness": "1",
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 510,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "fd70a858a32d4c8b",
        "type": "ui-gauge",
        "z": "493c5b8aa580413b",
        "name": "KS-2",
        "group": "c596de87c9e2efac",
        "order": 2,
        "value": "payload",
        "valueType": "msg",
        "width": 3,
        "height": "4",
        "gtype": "gauge-34",
        "gstyle": "rounded",
        "title": "Ks-2",
        "alwaysShowTitle": false,
        "floatingTitlePosition": "top-left",
        "units": "Hz",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#0058bb",
                "text": "70",
                "textType": "str"
            }
        ],
        "min": 0,
        "max": "70",
        "sizeThickness": "6",
        "sizeGap": "6",
        "sizeKeyThickness": "1",
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 510,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "c66c042d7a0d1d6e",
        "type": "ui-gauge",
        "z": "493c5b8aa580413b",
        "name": "",
        "group": "c596de87c9e2efac",
        "order": 3,
        "value": "payload",
        "valueType": "msg",
        "width": 3,
        "height": "4",
        "gtype": "gauge-34",
        "gstyle": "rounded",
        "title": "Ks-3",
        "alwaysShowTitle": false,
        "floatingTitlePosition": "top-left",
        "units": "Hz",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#0058bb",
                "text": "",
                "textType": "label"
            }
        ],
        "min": 0,
        "max": "70",
        "sizeThickness": "6",
        "sizeGap": "6",
        "sizeKeyThickness": "1",
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 510,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "7a5eb9bbab30aa42",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "Maskiner",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// MASKINER GAUGES - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showMachineGauges';\nmsg.group = msg.group || 'Machines';\n\nconst machines = global.get(\"reflink.machines\") || [];\nconst msgs = [null, null, null];\n\nmachines.forEach(m => {\n    const idx = (m.id || 1) - 1;\n    if (idx >= 0 && idx < msgs.length) {\n        msgs[idx] = {\n            payload: m.capacityPercent || 0,\n            topic: m.name,\n            action: 'machineGauge',\n            group: 'Machines'\n        };\n    }\n});\n\nnode.status({ fill: 'green', shape: 'dot', text: `${machines.length} gauges` });\n\nreturn msgs;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 640,
        "wires": [
            [
                "1307d93aab4908db",
                "fd70a858a32d4c8b",
                "c66c042d7a0d1d6e"
            ]
        ]
    },
    {
        "id": "dc703e2d0a2792c4",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "Larm",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// LARM - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'createAlarms';\nmsg.group = msg.group || 'Alarms';\n\nfunction ts(minutesAgo) {\n    const d = new Date(Date.now() - minutesAgo * 60 * 1000);\n    return d.toISOString();\n}\n\n// Skapa testlarm om inga finns\nlet reflink = global.get('reflink') || {};\nif (!reflink.alarms || !reflink.alarms.active || reflink.alarms.active.length === 0) {\n    const alarms = [\n        {\n            id: \"ALM-1\",\n            device: \"AK-CC55-03\",\n            severity: \"warning\",\n            timestamp: ts(2),\n            type: \"L√•g superheat\",\n            code: \"LOW_SH\",\n            message: \"L√•g superheat 2,8 K (b√∂r 5‚Äì7 K)\",\n            hitCount: 1\n        },\n        {\n            id: \"ALM-2\",\n            device: \"AK-CC55-F02\",\n            severity: \"critical\",\n            timestamp: ts(8),\n            type: \"Regulator offline\",\n            code: \"OFFLINE\",\n            message: \"Ingen kommunikation med regulator\",\n            hitCount: 3\n        },\n        {\n            id: \"ALM-3\",\n            device: \"Rack 1\",\n            severity: \"critical\",\n            timestamp: ts(1),\n            type: \"S3-fel\",\n            code: \"S3_ERR\",\n            message: \"Kompressor S3 fel\",\n            hitCount: 1\n        }\n    ];\n\n    const summary = alarms.reduce((acc, a) => {\n        acc.total++;\n        if (a.severity === \"critical\") acc.critical++;\n        else if (a.severity === \"warning\") acc.warning++;\n        else acc.info++;\n        return acc;\n    }, { total: 0, critical: 0, warning: 0, info: 0 });\n\n    reflink.alarms = { active: alarms, summary: summary, history: [] };\n    global.set('reflink', reflink);\n}\n\nmsg.alarms = reflink.alarms.active;\nmsg.alarmsSummary = reflink.alarms.summary;\nmsg.payload = {\n    success: true,\n    data: reflink.alarms.active\n};\n\nconst s = reflink.alarms.summary;\nnode.status({ \n    fill: s.critical > 0 ? 'red' : (s.warning > 0 ? 'yellow' : 'green'), \n    shape: 'dot', \n    text: `${s.total} larm` \n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 720,
        "wires": [
            [
                "a8f80107f85b127b"
            ]
        ]
    },
    {
        "id": "9c340c84543b2af1",
        "type": "http in",
        "z": "493c5b8aa580413b",
        "name": "",
        "url": "/api/alarms/active",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 720,
        "wires": [
            [
                "dc703e2d0a2792c4"
            ]
        ]
    },
    {
        "id": "a8f80107f85b127b",
        "type": "http response",
        "z": "493c5b8aa580413b",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 720,
        "wires": []
    },
    {
        "id": "8f64ef2dc09207cc",
        "type": "inject",
        "z": "493c5b8aa580413b",
        "name": "Refboard Larm",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "showAlarms",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Alarms",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 780,
        "wires": [
            [
                "b53ab2ee9aa3edfe"
            ]
        ]
    },
    {
        "id": "b53ab2ee9aa3edfe",
        "type": "function",
        "z": "493c5b8aa580413b",
        "name": "Refboard larm ‚Äì summary + senaste",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// REFBOARD LARM SUMMARY - Med Safe Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showAlarmSummary';\nmsg.group = msg.group || 'Alarms';\n\nconst reflink = global.get('reflink') || {};\nconst alarms = reflink.alarms || { active: [], summary: { total: 0, critical: 0, warning: 0, info: 0 } };\nconst summary = alarms.summary;\n\n// --- 1) Sammanfattning ---\nconst total = summary.total || alarms.active.length;\n\nlet summaryText;\nif (total === 0) {\n    summaryText = \"‚úÖ Inga aktiva larm\";\n} else {\n    summaryText =\n        `‚ö†Ô∏è ${total} aktiva larm ‚Ä¢ ` +\n        `${summary.critical} kritiska ‚Ä¢ ` +\n        `${summary.warning} varningar`;\n}\n\nconst msgSummary = { \n    payload: summaryText,\n    action: 'alarmSummary',\n    group: 'Alarms'\n};\n\n// --- 2) Senaste larm ---\nconst sorted = (alarms.active || []).slice().sort((a, b) => {\n    const ta = a.timestamp ? new Date(a.timestamp).getTime() : 0;\n    const tb = b.timestamp ? new Date(b.timestamp).getTime() : 0;\n    return tb - ta;\n});\n\nconst latest = sorted.slice(0, 3).map(a => ({\n    enhet: a.device,\n    text: a.message\n}));\n\nconst msgLatest = { \n    payload: latest,\n    action: 'latestAlarms',\n    group: 'Alarms'\n};\n\nnode.status({ \n    fill: summary.critical > 0 ? 'red' : (summary.warning > 0 ? 'yellow' : 'green'), \n    shape: 'dot', \n    text: summaryText.substring(0, 30) \n});\n\nreturn [msgSummary, msgLatest];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 780,
        "wires": [
            [
                "856f270d686b72ed"
            ],
            [
                "8b3c5d68b2739ca7"
            ]
        ]
    },
    {
        "id": "42145cb0b225578b",
        "type": "ui-template",
        "z": "493c5b8aa580413b",
        "name": "",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <div>\n        <h2>Counter</h2>\n        <!-- Conditional Styling using Attribute Binding (\":\") -->\n        <!-- and rendering content inside <tags></tags> with {{ }} -->\n        <p :style=\"{'color' : (count > 5 ? 'red' : 'green' )}\">Current Count: {{ count }}</p>\n        <!-- Computed Rendering using Vue Computed Variables -->\n        <p class=\"my-class\">Formatted Count: {{ formattedCount }}</p>\n        <!-- Conditional Rendering with \"v-if\" -->\n        <b v-if=\"count > 5\">Too many!</b>\n        <v-btn @click=\"increase()\">Increment</v-btn>\n    </div>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                count: 0\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n            count: function () {\n                if (this.count % 5 === 0) {\n                    this.send({payload: 'Multiple of 5'})\n                }\n            }\n        },\n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n            formattedCount: function () {\n                return this.count + ' Apples'\n            }\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            increase: function () {\n                this.count++\n            }\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 420,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "8b3c5d68b2739ca7",
        "type": "ui-table",
        "z": "493c5b8aa580413b",
        "group": "fb0d647584d2fd17",
        "name": "",
        "label": "",
        "order": 2,
        "width": "3",
        "height": "1",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": true,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "Enhet",
                "key": "enhet",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Text",
                "key": "text",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 690,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "856f270d686b72ed",
        "type": "ui-text",
        "z": "493c5b8aa580413b",
        "group": "fb0d647584d2fd17",
        "order": 1,
        "width": "3",
        "height": "1",
        "name": "Larmstatus",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#717171",
        "wrapText": false,
        "className": "",
        "value": "payload",
        "valueType": "msg",
        "x": 710,
        "y": 780,
        "wires": []
    },
    {
        "id": "48fddaa2df22e4b0",
        "type": "ui-progress",
        "z": "scan-dashboard-2",
        "group": "reflink-group-scanall",
        "name": "",
        "label": "Progress",
        "order": 0,
        "width": 0,
        "height": 0,
        "color": "",
        "className": "",
        "x": 360,
        "y": 640,
        "wires": []
    },
    {
        "id": "modbus-scan-template",
        "type": "ui-template",
        "z": "scan-dashboard-2",
        "group": "",
        "page": "reflink-page-scan",
        "ui": "45086322eb4ebcac",
        "name": "Modbus Scan Configuration",
        "order": 1,
        "width": "12",
        "height": "12",
        "head": "",
        "format": "<template>\n  <div class=\"modbus-scan-page\">\n    <v-row>\n      <!-- REFBUS Line 1 -->\n      <v-col cols=\"12\" md=\"6\">\n        <div :class=\"['refbus-config', { 'disabled': !line1.enabled }]\">\n          <div class=\"d-flex align-center justify-space-between mb-4\">\n            <h3>REFBUS Line 1</h3>\n            <v-switch\n              v-model=\"line1.enabled\"\n              label=\"Enabled\"\n              color=\"primary\"\n              density=\"compact\"\n              hide-details\n              class=\"ma-0\"\n            ></v-switch>\n          </div>\n          <div :class=\"{ 'disabled-content': !line1.enabled }\">\n            <v-select\n              v-model=\"line1.baudrate\"\n              :items=\"baudrates\"\n              label=\"Baudrate\"\n              density=\"compact\"\n              :disabled=\"!line1.enabled\"\n            ></v-select>\n            \n            <v-select\n              v-model=\"line1.parity\"\n              :items=\"parities\"\n              label=\"Parity\"\n              density=\"compact\"\n              :disabled=\"!line1.enabled\"\n            ></v-select>\n            \n            <v-select\n              v-model=\"line1.databits\"\n              :items=\"databits\"\n              label=\"Databits\"\n              density=\"compact\"\n              :disabled=\"!line1.enabled\"\n            ></v-select>\n            \n            <v-text-field\n              v-model.number=\"line1.timeout\"\n              label=\"Timeout (ms)\"\n              type=\"number\"\n              density=\"compact\"\n              :disabled=\"!line1.enabled\"\n            ></v-text-field>\n            \n            <v-divider class=\"my-3\"></v-divider>\n            \n            <div class=\"mb-2\">\n              <strong>Scan Ranges</strong>\n            </div>\n            \n            <div v-for=\"(range, index) in line1.scanRanges\" :key=\"'line1-' + index\" class=\"mb-2\">\n              <v-row dense>\n                <v-col cols=\"5\">\n                  <v-text-field\n                    v-model.number=\"range.addressLow\"\n                    label=\"Address Low\"\n                    type=\"number\"\n                    density=\"compact\"\n                    :disabled=\"!line1.enabled\"\n                  ></v-text-field>\n                </v-col>\n                <v-col cols=\"5\">\n                  <v-text-field\n                    v-model.number=\"range.addressHigh\"\n                    label=\"Address High\"\n                    type=\"number\"\n                    density=\"compact\"\n                    :disabled=\"!line1.enabled\"\n                  ></v-text-field>\n                </v-col>\n                <v-col cols=\"2\" class=\"d-flex align-center\">\n                  <v-btn\n                    icon=\"mdi-delete\"\n                    size=\"small\"\n                    variant=\"text\"\n                    color=\"error\"\n                    :disabled=\"!line1.enabled || line1.scanRanges.length <= 1\"\n                    @click=\"removeRange(1, index)\"\n                  ></v-btn>\n                </v-col>\n              </v-row>\n            </div>\n            \n            <v-btn\n              size=\"small\"\n              variant=\"outlined\"\n              color=\"primary\"\n              :disabled=\"!line1.enabled\"\n              @click=\"addRange(1)\"\n              class=\"mb-3\"\n            >\n              <v-icon left size=\"small\">mdi-plus</v-icon>\n              L√§gg till range\n            </v-btn>\n            \n            <v-btn\n              color=\"primary\"\n              block\n              size=\"large\"\n              :disabled=\"!line1.enabled || line1.status === 'Scanning...'\"\n              :loading=\"line1.status === 'Scanning...'\"\n              @click=\"scanLine(1)\"\n            >\n              <v-icon left>mdi-radar</v-icon>\n              Scan Line 1\n            </v-btn>\n            \n            <div class=\"mt-2 text-caption\">\n              <div><strong>Status:</strong> {{ line1.status }}</div>\n              <div><strong>Devices found:</strong> {{ line1.devicesFound }}</div>\n            </div>\n          </div>\n        </div>\n      </v-col>\n      \n      <!-- REFBUS Line 2 -->\n      <v-col cols=\"12\" md=\"6\">\n        <div :class=\"['refbus-config', { 'disabled': !line2.enabled }]\">\n          <div class=\"d-flex align-center justify-space-between mb-4\">\n            <h3>REFBUS Line 2</h3>\n            <v-switch\n              v-model=\"line2.enabled\"\n              label=\"Enabled\"\n              color=\"primary\"\n              density=\"compact\"\n              hide-details\n              class=\"ma-0\"\n            ></v-switch>\n          </div>\n          <div :class=\"{ 'disabled-content': !line2.enabled }\">\n            <v-select\n              v-model=\"line2.baudrate\"\n              :items=\"baudrates\"\n              label=\"Baudrate\"\n              density=\"compact\"\n              :disabled=\"!line2.enabled\"\n            ></v-select>\n            \n            <v-select\n              v-model=\"line2.parity\"\n              :items=\"parities\"\n              label=\"Parity\"\n              density=\"compact\"\n              :disabled=\"!line2.enabled\"\n            ></v-select>\n            \n            <v-select\n              v-model=\"line2.databits\"\n              :items=\"databits\"\n              label=\"Databits\"\n              density=\"compact\"\n              :disabled=\"!line2.enabled\"\n            ></v-select>\n            \n            <v-text-field\n              v-model.number=\"line2.timeout\"\n              label=\"Timeout (ms)\"\n              type=\"number\"\n              density=\"compact\"\n              :disabled=\"!line2.enabled\"\n            ></v-text-field>\n            \n            <v-divider class=\"my-3\"></v-divider>\n            \n            <div class=\"mb-2\">\n              <strong>Scan Ranges</strong>\n            </div>\n            \n            <div v-for=\"(range, index) in line2.scanRanges\" :key=\"'line2-' + index\" class=\"mb-2\">\n              <v-row dense>\n                <v-col cols=\"5\">\n                  <v-text-field\n                    v-model.number=\"range.addressLow\"\n                    label=\"Address Low\"\n                    type=\"number\"\n                    density=\"compact\"\n                    :disabled=\"!line2.enabled\"\n                  ></v-text-field>\n                </v-col>\n                <v-col cols=\"5\">\n                  <v-text-field\n                    v-model.number=\"range.addressHigh\"\n                    label=\"Address High\"\n                    type=\"number\"\n                    density=\"compact\"\n                    :disabled=\"!line2.enabled\"\n                  ></v-text-field>\n                </v-col>\n                <v-col cols=\"2\" class=\"d-flex align-center\">\n                  <v-btn\n                    icon=\"mdi-delete\"\n                    size=\"small\"\n                    variant=\"text\"\n                    color=\"error\"\n                    :disabled=\"!line2.enabled || line2.scanRanges.length <= 1\"\n                    @click=\"removeRange(2, index)\"\n                  ></v-btn>\n                </v-col>\n              </v-row>\n            </div>\n            \n            <v-btn\n              size=\"small\"\n              variant=\"outlined\"\n              color=\"primary\"\n              :disabled=\"!line2.enabled\"\n              @click=\"addRange(2)\"\n              class=\"mb-3\"\n            >\n              <v-icon left size=\"small\">mdi-plus</v-icon>\n              L√§gg till range\n            </v-btn>\n            \n            <v-btn\n              color=\"primary\"\n              block\n              size=\"large\"\n              :disabled=\"!line2.enabled || line2.status === 'Scanning...'\"\n              :loading=\"line2.status === 'Scanning...'\"\n              @click=\"scanLine(2)\"\n            >\n              <v-icon left>mdi-radar</v-icon>\n              Scan Line 2\n            </v-btn>\n            \n            <div class=\"mt-2 text-caption\">\n              <div><strong>Status:</strong> {{ line2.status }}</div>\n              <div><strong>Devices found:</strong> {{ line2.devicesFound }}</div>\n            </div>\n          </div>\n        </div>\n      </v-col>\n    </v-row>\n    \n    <!-- Scan All and Clear buttons -->\n    <v-row class=\"mt-6\">\n      <v-col cols=\"12\" class=\"text-center\">\n        <v-btn\n          color=\"primary\"\n          size=\"large\"\n          :disabled=\"scanningAll || (!line1.enabled && !line2.enabled)\"\n          :loading=\"scanningAll\"\n          @click=\"scanAll\"\n        >\n          <v-icon left>mdi-radar</v-icon>\n          Scan All\n        </v-btn>\n        \n        <div class=\"mt-2\">\n          <v-btn\n            variant=\"text\"\n            color=\"primary\"\n            size=\"small\"\n            @click=\"clearDeviceTypes\"\n          >\n            Clear device types and rescan\n          </v-btn>\n        </div>\n      </v-col>\n    </v-row>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      line1: {\n        enabled: true,\n        baudrate: 19200,\n        parity: 'even',\n        databits: 8,\n        timeout: 1000,\n        scanRanges: [{ addressLow: 1, addressHigh: 247 }],\n        status: 'Idle',\n        devicesFound: 0\n      },\n      line2: {\n        enabled: true,\n        baudrate: 19200,\n        parity: 'even',\n        databits: 8,\n        timeout: 1000,\n        scanRanges: [{ addressLow: 1, addressHigh: 247 }],\n        status: 'Idle',\n        devicesFound: 0\n      },\n      baudrates: [1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200],\n      parities: [\n        { title: 'None', value: 'none' },\n        { title: 'Even', value: 'even' },\n        { title: 'Odd', value: 'odd' }\n      ],\n      databits: [7, 8],\n      scanningAll: false\n    }\n  },\n  methods: {\n    addRange(lineNum) {\n      const line = lineNum === 1 ? this.line1 : this.line2;\n      line.scanRanges.push({ addressLow: 1, addressHigh: 247 });\n    },\n    removeRange(lineNum, index) {\n      const line = lineNum === 1 ? this.line1 : this.line2;\n      if (line.scanRanges.length > 1) {\n        line.scanRanges.splice(index, 1);\n      }\n    },\n    scanLine(lineNum) {\n      const line = lineNum === 1 ? this.line1 : this.line2;\n      if (!line.enabled || line.status === 'Scanning...') return;\n      \n      // Mock scan - update status\n      line.status = 'Scanning...';\n      \n      // Simulate scan process\n      setTimeout(() => {\n        line.status = 'Done';\n        line.devicesFound = Math.floor(Math.random() * 10) + 1; // Mock device count\n      }, 2000);\n      \n      // Send message to Node-RED (if needed)\n      this.$send({\n        topic: 'scan',\n        payload: `scan${lineNum}`,\n        line: lineNum,\n        config: {\n          enabled: line.enabled,\n          baudrate: line.baudrate,\n          parity: line.parity,\n          databits: line.databits,\n          timeout: line.timeout,\n          scanRanges: line.scanRanges\n        }\n      });\n    },\n    scanAll() {\n      if (this.scanningAll) return;\n      if (!this.line1.enabled && !this.line2.enabled) return;\n      \n      this.scanningAll = true;\n      \n      // Scan enabled lines\n      if (this.line1.enabled && this.line1.status !== 'Scanning...') {\n        this.scanLine(1);\n      }\n      if (this.line2.enabled && this.line2.status !== 'Scanning...') {\n        this.scanLine(2);\n      }\n      \n      setTimeout(() => {\n        this.scanningAll = false;\n      }, 2500);\n      \n      // Send message to Node-RED\n      this.$send({\n        topic: 'scan',\n        payload: 'scanall',\n        config: {\n          line1: this.line1.enabled ? {\n            baudrate: this.line1.baudrate,\n            parity: this.line1.parity,\n            databits: this.line1.databits,\n            timeout: this.line1.timeout,\n            scanRanges: this.line1.scanRanges\n          } : null,\n          line2: this.line2.enabled ? {\n            baudrate: this.line2.baudrate,\n            parity: this.line2.parity,\n            databits: this.line2.databits,\n            timeout: this.line2.timeout,\n            scanRanges: this.line2.scanRanges\n          } : null\n        }\n      });\n    },\n    clearDeviceTypes() {\n      // Reset device counts\n      this.line1.devicesFound = 0;\n      this.line2.devicesFound = 0;\n      this.line1.status = 'Idle';\n      this.line2.status = 'Idle';\n      \n      // Send message to Node-RED for full rescan\n      this.$send({\n        topic: 'scan',\n        payload: 'clear-and-rescan'\n      });\n    }\n  }\n}\n</script>\n\n<style scoped>\n.modbus-scan-page {\n  padding: 16px;\n}\n\n.refbus-config {\n  height: 100%;\n}\n\n.refbus-config.disabled {\n  opacity: 0.6;\n}\n\n.refbus-config h3 {\n  color: #ffffff;\n  font-size: 18px;\n  font-weight: 600;\n  margin: 0;\n}\n\n.disabled-content {\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.text-caption {\n  color: rgba(255, 255, 255, 0.7);\n  font-size: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "widget:page",
        "className": "",
        "x": 400,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "overview-temps-header",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-temps",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Temps header",
        "label": "",
        "format": "Butik / kylrum / frys - temp√∂versikt",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#ffffff",
        "wrapText": false,
        "className": "",
        "x": 560,
        "y": 380,
        "wires": []
    },
    {
        "id": "overview-temps-placeholder",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-temps",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Temps placeholder",
        "label": "",
        "format": "H√§r l√§gger vi in medeltemp / status f√∂r diskar, kylrum, frysrum.",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 13,
        "color": "#e0f7ff",
        "wrapText": true,
        "className": "",
        "value": "payload",
        "valueType": "msg",
        "x": 590,
        "y": 300,
        "wires": []
    },
    {
        "id": "overview-machines-header",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-machines",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Machines header",
        "label": "",
        "format": "Maskinrum / kompressorer / kondensor",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#ffffff",
        "wrapText": false,
        "className": "",
        "x": 530,
        "y": 220,
        "wires": []
    },
    {
        "id": "overview-machines-placeholder",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-machines",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Machines placeholder",
        "label": "",
        "format": "H√§r kan vi visa driftl√§ge, kompressorer ig√•ng, HP/LP mm.",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 13,
        "color": "#e0f7ff",
        "wrapText": true,
        "className": "",
        "x": 500,
        "y": 480,
        "wires": []
    },
    {
        "id": "overview-alarms-header",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-alarms",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Alarms header",
        "label": "",
        "format": "Aktiva larm",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#ffffff",
        "wrapText": false,
        "className": "",
        "x": 560,
        "y": 120,
        "wires": []
    },
    {
        "id": "overview-alarms-placeholder",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-alarms",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Alarms placeholder",
        "label": "",
        "format": "H√§r visar vi antal aktiva larm och ev. topp 3 kritiska.",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 13,
        "color": "#ffcccc",
        "wrapText": true,
        "className": "",
        "x": 230,
        "y": 220,
        "wires": []
    },
    {
        "id": "overview-events-header",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-events",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Events header",
        "label": "",
        "format": "Senaste h√§ndelser",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#ffffff",
        "wrapText": false,
        "className": "",
        "x": 380,
        "y": 280,
        "wires": []
    },
    {
        "id": "overview-events-placeholder",
        "type": "ui-text",
        "z": "overview-dashboard-2",
        "group": "overview-group-events",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Events placeholder",
        "label": "",
        "format": "H√§r kan vi visa senaste larmkvittenser, setpoint√§ndringar, servicebes√∂k mm.",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 13,
        "color": "#e0f7ff",
        "wrapText": true,
        "className": "",
        "value": "payload",
        "valueType": "msg",
        "x": 190,
        "y": 300,
        "wires": []
    },
    {
        "id": "network-interfaces-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-interfaces",
        "page": "",
        "ui": "",
        "name": "Network Interfaces",
        "order": 1,
        "width": "12",
        "height": "8",
        "head": "",
        "format": "<template>\n  <div class=\"network-interfaces\">\n    <v-row>\n      <v-col cols=\"12\" md=\"4\" v-for=\"(iface, name) in interfaces\" :key=\"name\">\n        <v-card class=\"interface-card\" :class=\"{ 'interface-up': iface.status === 'UP' }\">\n          <v-card-title class=\"d-flex align-center\">\n            <v-icon :color=\"iface.status === 'UP' ? '#4CAF50' : '#F44336'\" class=\"mr-2\">\n              {{ iface.status === 'UP' ? 'mdi-check-circle' : 'mdi-close-circle' }}\n            </v-icon>\n            <span>{{ name }}</span>\n            <v-chip class=\"ml-auto\" :color=\"iface.status === 'UP' ? 'success' : 'error'\" size=\"small\">\n              {{ iface.status }}\n            </v-chip>\n          </v-card-title>\n          \n          <v-card-text>\n            <v-list density=\"compact\" class=\"bg-transparent\">\n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-ip</v-icon></template>\n                <v-list-item-title>IP-adress</v-list-item-title>\n                <v-list-item-subtitle>{{ iface.ipAddress || 'Ingen' }}</v-list-item-subtitle>\n              </v-list-item>\n              \n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-slash-forward-box</v-icon></template>\n                <v-list-item-title>Prefix / Mask</v-list-item-title>\n                <v-list-item-subtitle>{{ iface.prefix ? '/' + iface.prefix + ' (' + iface.netmask + ')' : '-' }}</v-list-item-subtitle>\n              </v-list-item>\n              \n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-router</v-icon></template>\n                <v-list-item-title>Gateway</v-list-item-title>\n                <v-list-item-subtitle>{{ iface.gateway || '-' }}</v-list-item-subtitle>\n              </v-list-item>\n              \n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-dns</v-icon></template>\n                <v-list-item-title>DNS</v-list-item-title>\n                <v-list-item-subtitle>{{ iface.dns && iface.dns.length ? iface.dns.join(', ') : '-' }}</v-list-item-subtitle>\n              </v-list-item>\n              \n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-ethernet</v-icon></template>\n                <v-list-item-title>MAC</v-list-item-title>\n                <v-list-item-subtitle>{{ iface.mac || '-' }}</v-list-item-subtitle>\n              </v-list-item>\n              \n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-speedometer</v-icon></template>\n                <v-list-item-title>Hastighet</v-list-item-title>\n                <v-list-item-subtitle>{{ iface.linkSpeed || '-' }}</v-list-item-subtitle>\n              </v-list-item>\n              \n              <v-list-item>\n                <template v-slot:prepend><v-icon size=\"small\">mdi-cog</v-icon></template>\n                <v-list-item-title>Konfiguration</v-list-item-title>\n                <v-list-item-subtitle>\n                  <v-chip size=\"x-small\" :color=\"iface.dhcp ? 'primary' : 'secondary'\">\n                    {{ iface.dhcp ? 'DHCP' : 'Statisk IP' }}\n                  </v-chip>\n                </v-list-item-subtitle>\n              </v-list-item>\n            </v-list>\n          </v-card-text>\n          \n          <v-card-actions>\n            <v-btn color=\"primary\" variant=\"tonal\" size=\"small\" @click=\"openConfig(name)\">\n              <v-icon left size=\"small\">mdi-pencil</v-icon> Konfigurera\n            </v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-col>\n    </v-row>\n    \n    <!-- Config Dialog -->\n    <v-dialog v-model=\"configDialog\" max-width=\"500\">\n      <v-card>\n        <v-card-title>Konfigurera {{ selectedInterface }}</v-card-title>\n        <v-card-text>\n          <v-switch v-model=\"configForm.dhcp\" label=\"Anv√§nd DHCP\" color=\"primary\"></v-switch>\n          \n          <template v-if=\"!configForm.dhcp\">\n            <v-text-field v-model=\"configForm.ipAddress\" label=\"IP-adress\" placeholder=\"192.168.1.100\"></v-text-field>\n            <v-text-field v-model=\"configForm.prefix\" label=\"Prefix (CIDR)\" placeholder=\"24\" type=\"number\"></v-text-field>\n            <v-text-field v-model=\"configForm.gateway\" label=\"Gateway\" placeholder=\"192.168.1.1\"></v-text-field>\n            <v-text-field v-model=\"configForm.dns1\" label=\"DNS 1\" placeholder=\"8.8.8.8\"></v-text-field>\n            <v-text-field v-model=\"configForm.dns2\" label=\"DNS 2\" placeholder=\"8.8.4.4\"></v-text-field>\n          </template>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"configDialog = false\">Avbryt</v-btn>\n          <v-btn color=\"primary\" @click=\"saveConfig\" :loading=\"saving\">Spara</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n    \n    <v-btn color=\"primary\" class=\"mt-4\" @click=\"refresh\" :loading=\"loading\">\n      <v-icon left>mdi-refresh</v-icon> Uppdatera\n    </v-btn>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      interfaces: {},\n      loading: false,\n      saving: false,\n      configDialog: false,\n      selectedInterface: '',\n      configForm: {\n        dhcp: true,\n        ipAddress: '',\n        prefix: 24,\n        gateway: '',\n        dns1: '',\n        dns2: ''\n      }\n    }\n  },\n  mounted() {\n    this.refresh();\n    // Auto-refresh every 30 seconds\n    this.refreshInterval = setInterval(() => this.refresh(), 30000);\n  },\n  beforeUnmount() {\n    if (this.refreshInterval) clearInterval(this.refreshInterval);\n  },\n  methods: {\n    async refresh() {\n      this.loading = true;\n      try {\n        const res = await fetch('/api/network/interfaces');\n        const data = await res.json();\n        if (data.success) {\n          this.interfaces = data.data;\n        }\n      } catch (e) {\n        console.error('Failed to fetch interfaces:', e);\n      }\n      this.loading = false;\n    },\n    openConfig(name) {\n      this.selectedInterface = name;\n      const iface = this.interfaces[name];\n      this.configForm = {\n        dhcp: iface.dhcp !== false,\n        ipAddress: iface.ipAddress || '',\n        prefix: iface.prefix || 24,\n        gateway: iface.gateway || '',\n        dns1: iface.dns?.[0] || '',\n        dns2: iface.dns?.[1] || ''\n      };\n      this.configDialog = true;\n    },\n    async saveConfig() {\n      this.saving = true;\n      try {\n        const res = await fetch(`/api/network/interface/${this.selectedInterface}/configure`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(this.configForm)\n        });\n        const data = await res.json();\n        if (data.success) {\n          this.configDialog = false;\n          setTimeout(() => this.refresh(), 2000);\n        }\n      } catch (e) {\n        console.error('Failed to save config:', e);\n      }\n      this.saving = false;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.network-interfaces {\n  padding: 16px;\n}\n.interface-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n  transition: all 0.3s ease;\n}\n.interface-card.interface-up {\n  border-color: rgba(76, 175, 80, 0.5);\n}\n.interface-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);\n}\n.v-list-item-title {\n  font-size: 12px !important;\n  color: rgba(255,255,255,0.7);\n}\n.v-list-item-subtitle {\n  font-size: 14px !important;\n  color: #ffffff !important;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "active-interface-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-active",
        "page": "",
        "ui": "",
        "name": "Active Interface",
        "order": 1,
        "width": "4",
        "height": "3",
        "head": "",
        "format": "<template>\n  <div class=\"active-interface\">\n    <v-card class=\"status-card\">\n      <v-card-text class=\"text-center\">\n        <v-icon :color=\"active.interface ? '#4CAF50' : '#F44336'\" size=\"64\">\n          {{ active.interface ? 'mdi-check-network' : 'mdi-network-off' }}\n        </v-icon>\n        <h2 class=\"mt-3\">{{ active.interface || 'Ingen anslutning' }}</h2>\n        <p class=\"text-caption\">{{ active.status }}</p>\n        <p v-if=\"active.latency\" class=\"text-caption\">Latens: {{ active.latency }} ms</p>\n      </v-card-text>\n    </v-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      active: { interface: null, status: 'Laddar...', latency: null }\n    }\n  },\n  mounted() {\n    this.refresh();\n    this.interval = setInterval(() => this.refresh(), 10000);\n  },\n  beforeUnmount() {\n    if (this.interval) clearInterval(this.interval);\n  },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/network/active');\n        const data = await res.json();\n        if (data.success) {\n          this.active = data.data;\n        }\n      } catch (e) {\n        this.active = { interface: null, status: 'Fel', latency: null };\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.status-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "ping-test-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-pingtest",
        "page": "",
        "ui": "",
        "name": "Ping Test",
        "order": 1,
        "width": "4",
        "height": "4",
        "head": "",
        "format": "<template>\n  <div class=\"ping-test\">\n    <v-card class=\"ping-card\">\n      <v-card-text>\n        <v-text-field v-model=\"host\" label=\"Host / IP\" placeholder=\"8.8.8.8 eller reflink.systems\" density=\"compact\" clearable></v-text-field>\n        <v-btn color=\"primary\" block @click=\"runPing\" :loading=\"loading\" :disabled=\"!host\">\n          <v-icon left>mdi-access-point-network</v-icon> Ping\n        </v-btn>\n        \n        <v-alert v-if=\"result\" :type=\"result.success ? 'success' : 'error'\" class=\"mt-3\" density=\"compact\">\n          <div v-if=\"result.success\">\n            <strong>{{ result.host }}</strong><br>\n            Skickade: {{ result.packets?.transmitted }}<br>\n            Mottagna: {{ result.packets?.received }}<br>\n            Paketf√∂rlust: {{ result.packets?.loss }}%<br>\n            <span v-if=\"result.rtt?.avg\">Svarstid (avg): {{ result.rtt.avg }} ms</span>\n          </div>\n          <div v-else>\n            {{ result.error || 'Host unreachable' }}\n          </div>\n        </v-alert>\n      </v-card-text>\n    </v-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      host: '',\n      loading: false,\n      result: null\n    }\n  },\n  methods: {\n    async runPing() {\n      this.loading = true;\n      this.result = null;\n      try {\n        const res = await fetch('/api/network/ping', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ host: this.host, count: 3 })\n        });\n        const data = await res.json();\n        this.result = data.data;\n      } catch (e) {\n        this.result = { success: false, error: e.message };\n      }\n      this.loading = false;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.ping-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "system-info-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-sysinfo",
        "page": "",
        "ui": "",
        "name": "System Info",
        "order": 1,
        "width": "6",
        "height": "8",
        "head": "",
        "format": "<template>\n  <div class=\"system-info\">\n    <v-row>\n      <v-col cols=\"12\" md=\"6\">\n        <v-card class=\"info-card\">\n          <v-card-title><v-icon class=\"mr-2\">mdi-server</v-icon> System</v-card-title>\n          <v-card-text>\n            <v-list density=\"compact\" class=\"bg-transparent\">\n              <v-list-item>\n                <v-list-item-title>Hostname</v-list-item-title>\n                <v-list-item-subtitle>{{ info.hostname }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Modell</v-list-item-title>\n                <v-list-item-subtitle>{{ info.piModel }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Kernel</v-list-item-title>\n                <v-list-item-subtitle>{{ info.kernelVersion }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Uptime</v-list-item-title>\n                <v-list-item-subtitle>{{ info.uptime }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Node-RED</v-list-item-title>\n                <v-list-item-subtitle>{{ info.nodeRedVersion }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Dashboard</v-list-item-title>\n                <v-list-item-subtitle>{{ info.dashboardVersion }}</v-list-item-subtitle>\n              </v-list-item>\n            </v-list>\n          </v-card-text>\n        </v-card>\n      </v-col>\n      \n      <v-col cols=\"12\" md=\"6\">\n        <v-card class=\"info-card\">\n          <v-card-title><v-icon class=\"mr-2\">mdi-chart-line</v-icon> Resurser</v-card-title>\n          <v-card-text>\n            <div class=\"mb-3\">\n              <div class=\"d-flex justify-space-between\">\n                <span>CPU Temp</span>\n                <span :class=\"getTempClass(info.cpuTemp)\">{{ info.cpuTemp }}¬∞C</span>\n              </div>\n              <v-progress-linear :value=\"info.cpuTemp\" :max=\"100\" :color=\"getTempColor(info.cpuTemp)\" height=\"8\" rounded></v-progress-linear>\n            </div>\n            \n            <div class=\"mb-3\">\n              <div class=\"d-flex justify-space-between\">\n                <span>CPU Load (1m)</span>\n                <span>{{ info.loadAverage?.[0]?.toFixed(2) }}</span>\n              </div>\n              <v-progress-linear :value=\"(info.loadAverage?.[0] / info.cpuCores) * 100\" :max=\"100\" color=\"primary\" height=\"8\" rounded></v-progress-linear>\n            </div>\n            \n            <div class=\"mb-3\">\n              <div class=\"d-flex justify-space-between\">\n                <span>Minne</span>\n                <span>{{ info.usedMemoryPercent }}%</span>\n              </div>\n              <v-progress-linear :value=\"info.usedMemoryPercent\" :max=\"100\" color=\"info\" height=\"8\" rounded></v-progress-linear>\n            </div>\n            \n            <div>\n              <div class=\"d-flex justify-space-between\">\n                <span>Disk</span>\n                <span>{{ info.disk?.usedPercent }}%</span>\n              </div>\n              <v-progress-linear :value=\"info.disk?.usedPercent\" :max=\"100\" color=\"warning\" height=\"8\" rounded></v-progress-linear>\n            </div>\n          </v-card-text>\n        </v-card>\n      </v-col>\n    </v-row>\n    \n    <v-btn color=\"primary\" class=\"mt-4\" @click=\"refresh\" :loading=\"loading\">\n      <v-icon left>mdi-refresh</v-icon> Uppdatera\n    </v-btn>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      info: {},\n      loading: false\n    }\n  },\n  mounted() {\n    this.refresh();\n    this.interval = setInterval(() => this.refresh(), 15000);\n  },\n  beforeUnmount() {\n    if (this.interval) clearInterval(this.interval);\n  },\n  methods: {\n    async refresh() {\n      this.loading = true;\n      try {\n        const res = await fetch('/api/system/info');\n        const data = await res.json();\n        if (data.success) this.info = data.data;\n      } catch (e) {\n        console.error('Failed to fetch system info:', e);\n      }\n      this.loading = false;\n    },\n    getTempColor(temp) {\n      if (temp < 50) return 'success';\n      if (temp < 65) return 'warning';\n      return 'error';\n    },\n    getTempClass(temp) {\n      if (temp < 50) return 'text-success';\n      if (temp < 65) return 'text-warning';\n      return 'text-error';\n    }\n  }\n}\n</script>\n\n<style scoped>\n.info-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n.v-list-item-title {\n  font-size: 12px !important;\n  color: rgba(255,255,255,0.7);\n}\n.v-list-item-subtitle {\n  font-size: 14px !important;\n  color: #ffffff !important;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "service-mode-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-service",
        "page": "",
        "ui": "",
        "name": "Service Mode",
        "order": 1,
        "width": "6",
        "height": "5",
        "head": "",
        "format": "<template>\n  <div class=\"service-mode\">\n    <v-card class=\"service-card\">\n      <v-card-title><v-icon class=\"mr-2\">mdi-wrench</v-icon> Service Mode</v-card-title>\n      <v-card-text>\n        <v-row>\n          <v-col cols=\"6\">\n            <v-btn color=\"warning\" block variant=\"tonal\" @click=\"confirm('restart-nodered')\" :loading=\"loading === 'restart-nodered'\">\n              <v-icon left>mdi-restart</v-icon> Starta om Node-RED\n            </v-btn>\n          </v-col>\n          <v-col cols=\"6\">\n            <v-btn color=\"orange\" block variant=\"tonal\" @click=\"confirm('reboot')\" :loading=\"loading === 'reboot'\">\n              <v-icon left>mdi-restart-alert</v-icon> Starta om Pi\n            </v-btn>\n          </v-col>\n          <v-col cols=\"6\">\n            <v-btn color=\"error\" block variant=\"tonal\" @click=\"confirm('shutdown')\" :loading=\"loading === 'shutdown'\">\n              <v-icon left>mdi-power</v-icon> St√§ng av\n            </v-btn>\n          </v-col>\n          <v-col cols=\"6\">\n            <v-btn color=\"info\" block variant=\"tonal\" @click=\"confirm('safemode')\" :loading=\"loading === 'safemode'\">\n              <v-icon left>mdi-shield-check</v-icon> Safe Mode\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-card-text>\n    </v-card>\n    \n    <v-dialog v-model=\"confirmDialog\" max-width=\"400\">\n      <v-card>\n        <v-card-title>Bekr√§fta</v-card-title>\n        <v-card-text>{{ confirmMessage }}</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"confirmDialog = false\">Avbryt</v-btn>\n          <v-btn color=\"error\" @click=\"executeAction\">Bekr√§fta</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      loading: null,\n      confirmDialog: false,\n      confirmAction: null,\n      confirmMessage: ''\n    }\n  },\n  methods: {\n    confirm(action) {\n      this.confirmAction = action;\n      const messages = {\n        'restart-nodered': 'Vill du starta om Node-RED? Dashboard kommer vara otillg√§ngligt i ca 30 sekunder.',\n        'reboot': 'Vill du starta om Raspberry Pi? Systemet kommer vara otillg√§ngligt i ca 1 minut.',\n        'shutdown': 'Vill du st√§nga av Raspberry Pi? Du m√•ste fysiskt starta den igen.',\n        'safemode': 'Vill du starta i Safe Mode? Plugins kommer inte laddas.'\n      };\n      this.confirmMessage = messages[action];\n      this.confirmDialog = true;\n    },\n    async executeAction() {\n      this.confirmDialog = false;\n      this.loading = this.confirmAction;\n      \n      try {\n        const endpoints = {\n          'restart-nodered': '/api/system/restart-nodered',\n          'reboot': '/api/system/reboot',\n          'shutdown': '/api/system/shutdown',\n          'safemode': '/api/system/safemode'\n        };\n        \n        await fetch(endpoints[this.confirmAction], { method: 'POST' });\n      } catch (e) {\n        console.error('Action failed:', e);\n      }\n      \n      this.loading = null;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.service-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "modbus-config-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-modbus",
        "page": "",
        "ui": "",
        "name": "Modbus TCP Config",
        "order": 1,
        "width": "6",
        "height": "6",
        "head": "",
        "format": "<template>\n  <div class=\"modbus-config\">\n    <v-card class=\"config-card\">\n      <v-card-title class=\"d-flex align-center\">\n        <v-icon class=\"mr-2\">mdi-server-network</v-icon> Modbus TCP Server\n        <v-switch v-model=\"config.enabled\" class=\"ml-auto\" color=\"primary\" hide-details density=\"compact\"></v-switch>\n      </v-card-title>\n      <v-card-text>\n        <v-text-field v-model=\"config.port\" label=\"Port\" type=\"number\" density=\"compact\" :disabled=\"config.enabled\"></v-text-field>\n        <v-text-field v-model=\"config.timeout\" label=\"Timeout (ms)\" type=\"number\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.maxClients\" label=\"Max Clients\" type=\"number\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.unitId\" label=\"Unit ID\" type=\"number\" density=\"compact\"></v-text-field>\n        <v-textarea v-model=\"config.notes\" label=\"Anteckningar\" rows=\"2\" density=\"compact\"></v-textarea>\n      </v-card-text>\n      <v-card-actions>\n        <v-btn color=\"primary\" @click=\"save\" :loading=\"saving\">Spara</v-btn>\n        <v-btn @click=\"refresh\">√Öterst√§ll</v-btn>\n      </v-card-actions>\n    </v-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      config: {},\n      saving: false\n    }\n  },\n  mounted() { this.refresh(); },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/config/modbus');\n        const data = await res.json();\n        if (data.success) this.config = data.data;\n      } catch (e) { console.error(e); }\n    },\n    async save() {\n      this.saving = true;\n      try {\n        await fetch('/api/config/modbus', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(this.config)\n        });\n      } catch (e) { console.error(e); }\n      this.saving = false;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "bacnet-config-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-bacnet",
        "page": "",
        "ui": "",
        "name": "BACnet/IP Config",
        "order": 1,
        "width": "6",
        "height": "6",
        "head": "",
        "format": "<template>\n  <div class=\"bacnet-config\">\n    <v-card class=\"config-card\">\n      <v-card-title class=\"d-flex align-center\">\n        <v-icon class=\"mr-2\">mdi-home-automation</v-icon> BACnet/IP\n        <v-switch v-model=\"config.enabled\" class=\"ml-auto\" color=\"primary\" hide-details density=\"compact\"></v-switch>\n      </v-card-title>\n      <v-card-text>\n        <v-text-field v-model=\"config.deviceInstance\" label=\"Device Instance\" type=\"number\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.udpPort\" label=\"UDP Port\" type=\"number\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.broadcastAddress\" label=\"Broadcast Address\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.vendorName\" label=\"Vendor Name\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.modelName\" label=\"Model Name\" density=\"compact\"></v-text-field>\n      </v-card-text>\n      <v-card-actions>\n        <v-btn color=\"primary\" @click=\"save\" :loading=\"saving\">Spara</v-btn>\n        <v-btn @click=\"refresh\">√Öterst√§ll</v-btn>\n      </v-card-actions>\n    </v-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      config: {},\n      saving: false\n    }\n  },\n  mounted() { this.refresh(); },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/config/bacnet');\n        const data = await res.json();\n        if (data.success) this.config = data.data;\n      } catch (e) { console.error(e); }\n    },\n    async save() {\n      this.saving = true;\n      try {\n        await fetch('/api/config/bacnet', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(this.config)\n        });\n      } catch (e) { console.error(e); }\n      this.saving = false;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "rs485-config-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-rs485",
        "page": "",
        "ui": "",
        "name": "RS485 Config",
        "order": 1,
        "width": "12",
        "height": "6",
        "head": "",
        "format": "<template>\n  <div class=\"rs485-config\">\n    <v-row>\n      <v-col cols=\"12\" md=\"6\">\n        <v-card class=\"config-card\">\n          <v-card-title><v-icon class=\"mr-2\">mdi-serial-port</v-icon> RS485 Inst√§llningar</v-card-title>\n          <v-card-text>\n            <v-select v-model=\"config.port\" :items=\"ports\" label=\"Serieport\" density=\"compact\"></v-select>\n            <v-select v-model=\"config.baudrate\" :items=\"baudrates\" label=\"Baudrate\" density=\"compact\"></v-select>\n            <v-select v-model=\"config.parity\" :items=\"parities\" label=\"Parity\" density=\"compact\"></v-select>\n            <v-select v-model=\"config.stopBits\" :items=\"[1, 2]\" label=\"Stop Bits\" density=\"compact\"></v-select>\n            <v-select v-model=\"config.mode\" :items=\"['RTU', 'ASCII']\" label=\"Mode\" density=\"compact\"></v-select>\n            <v-switch v-model=\"config.termination\" label=\"Termination\" color=\"primary\" density=\"compact\"></v-switch>\n          </v-card-text>\n          <v-card-actions>\n            <v-btn color=\"primary\" @click=\"save\" :loading=\"saving\">Spara</v-btn>\n            <v-btn @click=\"refresh\">√Öterst√§ll</v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-col>\n      \n      <v-col cols=\"12\" md=\"6\">\n        <v-card class=\"config-card\">\n          <v-card-title><v-icon class=\"mr-2\">mdi-bug</v-icon> Diagnostik</v-card-title>\n          <v-card-text>\n            <v-list density=\"compact\" class=\"bg-transparent\">\n              <v-list-item>\n                <v-list-item-title>TX Errors</v-list-item-title>\n                <v-list-item-subtitle>{{ diagnostics.errors?.tx || 0 }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>RX Errors</v-list-item-title>\n                <v-list-item-subtitle>{{ diagnostics.errors?.rx || 0 }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Collisions</v-list-item-title>\n                <v-list-item-subtitle>{{ diagnostics.errors?.collisions || 0 }}</v-list-item-subtitle>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-title>Timeouts</v-list-item-title>\n                <v-list-item-subtitle>{{ diagnostics.errors?.timeouts || 0 }}</v-list-item-subtitle>\n              </v-list-item>\n            </v-list>\n            \n            <v-divider class=\"my-2\"></v-divider>\n            <h4>Senaste frames</h4>\n            <div v-for=\"frame in diagnostics.lastFrames\" :key=\"frame.timestamp\" class=\"frame-item\">\n              <code>{{ frame.timestamp.split('T')[1].split('.')[0] }} [{{ frame.direction }}] Unit:{{ frame.unitId }} FC:{{ frame.functionCode }}</code>\n            </div>\n          </v-card-text>\n          <v-card-actions>\n            <v-btn @click=\"refreshDiag\" :loading=\"loadingDiag\">Uppdatera</v-btn>\n            <v-btn color=\"warning\" @click=\"resetErrors\">Nollst√§ll</v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-col>\n    </v-row>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      config: {},\n      diagnostics: { errors: {}, lastFrames: [] },\n      ports: ['/dev/ttyAMA0', '/dev/ttyUSB0', '/dev/ttyUSB1', '/dev/ttyS0'],\n      baudrates: [1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200],\n      parities: ['none', 'even', 'odd'],\n      saving: false,\n      loadingDiag: false\n    }\n  },\n  mounted() {\n    this.refresh();\n    this.refreshDiag();\n    this.loadPorts();\n  },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/config/rs485');\n        const data = await res.json();\n        if (data.success) this.config = data.data;\n      } catch (e) { console.error(e); }\n    },\n    async save() {\n      this.saving = true;\n      try {\n        await fetch('/api/config/rs485', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(this.config)\n        });\n      } catch (e) { console.error(e); }\n      this.saving = false;\n    },\n    async loadPorts() {\n      try {\n        const res = await fetch('/api/config/rs485/ports');\n        const data = await res.json();\n        if (data.success && data.data.length) {\n          this.ports = [...new Set([...this.ports, ...data.data])];\n        }\n      } catch (e) { console.error(e); }\n    },\n    async refreshDiag() {\n      this.loadingDiag = true;\n      try {\n        const res = await fetch('/api/config/rs485/diagnostics');\n        const data = await res.json();\n        if (data.success) this.diagnostics = data.data;\n      } catch (e) { console.error(e); }\n      this.loadingDiag = false;\n    },\n    async resetErrors() {\n      try {\n        await fetch('/api/config/rs485/reset-errors', { method: 'POST' });\n        this.refreshDiag();\n      } catch (e) { console.error(e); }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n.frame-item {\n  font-size: 11px;\n  padding: 2px 0;\n  border-bottom: 1px solid rgba(255,255,255,0.1);\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "logging-config-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-logging",
        "page": "",
        "ui": "",
        "name": "Logging Config",
        "order": 1,
        "width": "6",
        "height": "6",
        "head": "",
        "format": "<template>\n  <div class=\"logging-config\">\n    <v-card class=\"config-card\">\n      <v-card-title><v-icon class=\"mr-2\">mdi-file-document</v-icon> Loggning</v-card-title>\n      <v-card-text>\n        <v-select v-model=\"config.interval\" :items=\"intervals\" label=\"Loggintervall\" item-title=\"text\" item-value=\"value\" density=\"compact\"></v-select>\n        <v-text-field v-model=\"config.maxDays\" label=\"Beh√•ll loggar (dagar)\" type=\"number\" density=\"compact\"></v-text-field>\n        <v-text-field v-model=\"config.localPath\" label=\"Lokal s√∂kv√§g\" density=\"compact\"></v-text-field>\n        \n        <v-switch v-model=\"config.sftpEnabled\" label=\"SFTP Backup\" color=\"primary\" density=\"compact\"></v-switch>\n        <template v-if=\"config.sftpEnabled\">\n          <v-text-field v-model=\"config.sftpHost\" label=\"SFTP Host\" density=\"compact\"></v-text-field>\n          <v-text-field v-model=\"config.sftpUser\" label=\"SFTP User\" density=\"compact\"></v-text-field>\n          <v-text-field v-model=\"config.sftpPath\" label=\"SFTP Path\" density=\"compact\"></v-text-field>\n        </template>\n        \n        <v-switch v-model=\"config.httpEnabled\" label=\"HTTP POST\" color=\"primary\" density=\"compact\"></v-switch>\n        <v-text-field v-if=\"config.httpEnabled\" v-model=\"config.httpEndpoint\" label=\"HTTP Endpoint\" density=\"compact\"></v-text-field>\n        \n        <v-switch v-model=\"config.longTermEnabled\" label=\"L√•ngtidsloggning\" color=\"primary\" density=\"compact\"></v-switch>\n      </v-card-text>\n      <v-card-actions>\n        <v-btn color=\"primary\" @click=\"save\" :loading=\"saving\">Spara</v-btn>\n        <v-btn @click=\"refresh\">√Öterst√§ll</v-btn>\n      </v-card-actions>\n    </v-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      config: {},\n      saving: false,\n      intervals: [\n        { text: '10 sekunder', value: 10 },\n        { text: '30 sekunder', value: 30 },\n        { text: '1 minut', value: 60 },\n        { text: '5 minuter', value: 300 },\n        { text: '10 minuter', value: 600 },\n        { text: '15 minuter', value: 900 },\n        { text: '30 minuter', value: 1800 },\n        { text: '1 timme', value: 3600 }\n      ]\n    }\n  },\n  mounted() { this.refresh(); },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/config/logging');\n        const data = await res.json();\n        if (data.success) this.config = data.data;\n      } catch (e) { console.error(e); }\n    },\n    async save() {\n      this.saving = true;\n      try {\n        await fetch('/api/config/logging', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(this.config)\n        });\n      } catch (e) { console.error(e); }\n      this.saving = false;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "config-mgmt-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-configmgmt",
        "page": "",
        "ui": "",
        "name": "Config Management",
        "order": 1,
        "width": "6",
        "height": "5",
        "head": "",
        "format": "<template>\n  <div class=\"config-mgmt\">\n    <v-card class=\"config-card\">\n      <v-card-title><v-icon class=\"mr-2\">mdi-cog-transfer</v-icon> Konfigurationshantering</v-card-title>\n      <v-card-text>\n        <v-row>\n          <v-col cols=\"6\">\n            <v-btn color=\"primary\" block @click=\"exportConfig\" :loading=\"exporting\">\n              <v-icon left>mdi-download</v-icon> Exportera\n            </v-btn>\n          </v-col>\n          <v-col cols=\"6\">\n            <v-btn color=\"secondary\" block @click=\"$refs.fileInput.click()\">\n              <v-icon left>mdi-upload</v-icon> Importera\n            </v-btn>\n            <input ref=\"fileInput\" type=\"file\" accept=\".json\" @change=\"importConfig\" style=\"display: none\">\n          </v-col>\n          <v-col cols=\"12\">\n            <v-btn color=\"warning\" block variant=\"tonal\" @click=\"confirmReset = true\">\n              <v-icon left>mdi-restore</v-icon> √Öterst√§ll till Default\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-card-text>\n    </v-card>\n    \n    <v-dialog v-model=\"confirmReset\" max-width=\"400\">\n      <v-card>\n        <v-card-title>Bekr√§fta √•terst√§llning</v-card-title>\n        <v-card-text>Alla inst√§llningar kommer √•terst√§llas till fabriksinst√§llningar. Vill du forts√§tta?</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"confirmReset = false\">Avbryt</v-btn>\n          <v-btn color=\"error\" @click=\"resetToDefaults\">√Öterst√§ll</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      exporting: false,\n      confirmReset: false\n    }\n  },\n  methods: {\n    async exportConfig() {\n      this.exporting = true;\n      try {\n        const res = await fetch('/api/config/export');\n        const data = await res.json();\n        if (data.success) {\n          const blob = new Blob([JSON.stringify(data.data, null, 2)], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `reflink-config-${new Date().toISOString().split('T')[0]}.json`;\n          a.click();\n          URL.revokeObjectURL(url);\n        }\n      } catch (e) { console.error(e); }\n      this.exporting = false;\n    },\n    async importConfig(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      \n      const reader = new FileReader();\n      reader.onload = async (e) => {\n        try {\n          const config = JSON.parse(e.target.result);\n          await fetch('/api/config/import', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(config)\n          });\n          alert('Konfiguration importerad!');\n        } catch (err) {\n          alert('Fel vid import: ' + err.message);\n        }\n      };\n      reader.readAsText(file);\n    },\n    async resetToDefaults() {\n      this.confirmReset = false;\n      try {\n        await fetch('/api/config/reset', { method: 'POST' });\n        alert('Konfiguration √•terst√§lld!');\n      } catch (e) { console.error(e); }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "users-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-users",
        "page": "",
        "ui": "",
        "name": "Users Management",
        "order": 1,
        "width": "6",
        "height": "6",
        "head": "",
        "format": "<template>\n  <div class=\"users-mgmt\">\n    <v-card class=\"config-card\">\n      <v-card-title class=\"d-flex\">\n        <v-icon class=\"mr-2\">mdi-account-group</v-icon> Anv√§ndare\n        <v-btn class=\"ml-auto\" size=\"small\" color=\"primary\" @click=\"showCreate = true\">\n          <v-icon>mdi-plus</v-icon>\n        </v-btn>\n      </v-card-title>\n      <v-card-text>\n        <v-list density=\"compact\" class=\"bg-transparent\">\n          <v-list-item v-for=\"user in users\" :key=\"user.username\">\n            <template v-slot:prepend>\n              <v-icon>{{ user.role === 'admin' ? 'mdi-shield-crown' : 'mdi-account' }}</v-icon>\n            </template>\n            <v-list-item-title>{{ user.username }}</v-list-item-title>\n            <v-list-item-subtitle>{{ user.role }} - {{ formatDate(user.lastLogin) }}</v-list-item-subtitle>\n            <template v-slot:append>\n              <v-btn icon size=\"x-small\" @click=\"openPassword(user.username)\">\n                <v-icon size=\"small\">mdi-key</v-icon>\n              </v-btn>\n              <v-btn icon size=\"x-small\" color=\"error\" @click=\"deleteUser(user.username)\" :disabled=\"user.username === 'admin'\">\n                <v-icon size=\"small\">mdi-delete</v-icon>\n              </v-btn>\n            </template>\n          </v-list-item>\n        </v-list>\n      </v-card-text>\n    </v-card>\n    \n    <v-dialog v-model=\"showCreate\" max-width=\"400\">\n      <v-card>\n        <v-card-title>Skapa anv√§ndare</v-card-title>\n        <v-card-text>\n          <v-text-field v-model=\"newUser.username\" label=\"Anv√§ndarnamn\" density=\"compact\"></v-text-field>\n          <v-text-field v-model=\"newUser.password\" label=\"L√∂senord\" type=\"password\" density=\"compact\"></v-text-field>\n          <v-select v-model=\"newUser.role\" :items=\"['admin', 'technician', 'viewer']\" label=\"Roll\" density=\"compact\"></v-select>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"showCreate = false\">Avbryt</v-btn>\n          <v-btn color=\"primary\" @click=\"createUser\">Skapa</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n    \n    <v-dialog v-model=\"showPassword\" max-width=\"400\">\n      <v-card>\n        <v-card-title>√Ñndra l√∂senord f√∂r {{ selectedUser }}</v-card-title>\n        <v-card-text>\n          <v-text-field v-model=\"newPassword\" label=\"Nytt l√∂senord\" type=\"password\" density=\"compact\"></v-text-field>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"showPassword = false\">Avbryt</v-btn>\n          <v-btn color=\"primary\" @click=\"changePassword\">Spara</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      users: [],\n      showCreate: false,\n      showPassword: false,\n      selectedUser: '',\n      newPassword: '',\n      newUser: { username: '', password: '', role: 'technician' }\n    }\n  },\n  mounted() { this.refresh(); },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/auth/users');\n        const data = await res.json();\n        if (data.success) this.users = data.data;\n      } catch (e) { console.error(e); }\n    },\n    async createUser() {\n      try {\n        await fetch('/api/auth/users', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(this.newUser)\n        });\n        this.showCreate = false;\n        this.newUser = { username: '', password: '', role: 'technician' };\n        this.refresh();\n      } catch (e) { console.error(e); }\n    },\n    openPassword(username) {\n      this.selectedUser = username;\n      this.newPassword = '';\n      this.showPassword = true;\n    },\n    async changePassword() {\n      try {\n        await fetch(`/api/auth/users/${this.selectedUser}/password`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ newPassword: this.newPassword })\n        });\n        this.showPassword = false;\n      } catch (e) { console.error(e); }\n    },\n    async deleteUser(username) {\n      if (confirm(`Ta bort anv√§ndare ${username}?`)) {\n        try {\n          await fetch(`/api/auth/users/${username}`, { method: 'DELETE' });\n          this.refresh();\n        } catch (e) { console.error(e); }\n      }\n    },\n    formatDate(date) {\n      return date ? new Date(date).toLocaleString('sv-SE') : 'Aldrig';\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "apikeys-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-apikeys",
        "page": "",
        "ui": "",
        "name": "API Keys Management",
        "order": 1,
        "width": "6",
        "height": "6",
        "head": "",
        "format": "<template>\n  <div class=\"apikeys-mgmt\">\n    <v-card class=\"config-card\">\n      <v-card-title class=\"d-flex\">\n        <v-icon class=\"mr-2\">mdi-key-chain</v-icon> API-nycklar\n        <v-btn class=\"ml-auto\" size=\"small\" color=\"primary\" @click=\"showCreate = true\">\n          <v-icon>mdi-plus</v-icon>\n        </v-btn>\n      </v-card-title>\n      <v-card-text>\n        <v-list density=\"compact\" class=\"bg-transparent\">\n          <v-list-item v-for=\"key in keys\" :key=\"key.id\">\n            <template v-slot:prepend>\n              <v-icon>mdi-key</v-icon>\n            </template>\n            <v-list-item-title>{{ key.name }}</v-list-item-title>\n            <v-list-item-subtitle>\n              {{ key.keyPreview }} - Anv√§nd {{ key.usageCount }} ggr\n            </v-list-item-subtitle>\n            <template v-slot:append>\n              <v-btn icon size=\"x-small\" color=\"error\" @click=\"deleteKey(key.id)\">\n                <v-icon size=\"small\">mdi-delete</v-icon>\n              </v-btn>\n            </template>\n          </v-list-item>\n        </v-list>\n        \n        <v-alert v-if=\"newKey\" type=\"success\" class=\"mt-3\" density=\"compact\" closable @click:close=\"newKey = null\">\n          <strong>Ny API-nyckel skapad!</strong><br>\n          Spara denna nyckel - den visas endast EN g√•ng:<br>\n          <code style=\"word-break: break-all\">{{ newKey }}</code>\n        </v-alert>\n      </v-card-text>\n    </v-card>\n    \n    <v-dialog v-model=\"showCreate\" max-width=\"400\">\n      <v-card>\n        <v-card-title>Skapa API-nyckel</v-card-title>\n        <v-card-text>\n          <v-text-field v-model=\"keyName\" label=\"Namn\" placeholder=\"Ex: Integration XYZ\" density=\"compact\"></v-text-field>\n          <v-checkbox v-model=\"permissions\" label=\"Read\" value=\"read\" density=\"compact\"></v-checkbox>\n          <v-checkbox v-model=\"permissions\" label=\"Write\" value=\"write\" density=\"compact\"></v-checkbox>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"showCreate = false\">Avbryt</v-btn>\n          <v-btn color=\"primary\" @click=\"createKey\">Skapa</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      keys: [],\n      showCreate: false,\n      keyName: '',\n      permissions: ['read'],\n      newKey: null\n    }\n  },\n  mounted() { this.refresh(); },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/auth/apikeys');\n        const data = await res.json();\n        if (data.success) this.keys = data.data;\n      } catch (e) { console.error(e); }\n    },\n    async createKey() {\n      try {\n        const res = await fetch('/api/auth/apikeys', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ name: this.keyName, permissions: this.permissions })\n        });\n        const data = await res.json();\n        if (data.success) {\n          this.newKey = data.data.key;\n          this.showCreate = false;\n          this.keyName = '';\n          this.permissions = ['read'];\n          this.refresh();\n        }\n      } catch (e) { console.error(e); }\n    },\n    async deleteKey(id) {\n      if (confirm('Ta bort denna API-nyckel?')) {\n        try {\n          await fetch(`/api/auth/apikeys/${id}`, { method: 'DELETE' });\n          this.refresh();\n        } catch (e) { console.error(e); }\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "failover-component",
        "type": "ui-template",
        "z": "settings-flow",
        "group": "settings-group-failover",
        "page": "",
        "ui": "",
        "name": "Failover Status",
        "order": 1,
        "width": "4",
        "height": "4",
        "head": "",
        "format": "<template>\n  <div class=\"failover-status\">\n    <v-card class=\"status-card\">\n      <v-card-title><v-icon class=\"mr-2\">mdi-swap-horizontal</v-icon> Failover</v-card-title>\n      <v-card-text>\n        <div v-for=\"(iface, idx) in failover.priority\" :key=\"iface\" class=\"priority-item\" :class=\"{ active: failover.active === iface }\">\n          <span class=\"priority-number\">{{ idx + 1 }}</span>\n          <v-icon :color=\"failover.interfaces?.[iface]?.hasInternet ? '#4CAF50' : '#F44336'\" size=\"small\">\n            {{ failover.interfaces?.[iface]?.hasInternet ? 'mdi-check-circle' : 'mdi-close-circle' }}\n          </v-icon>\n          <span class=\"iface-name\">{{ iface }}</span>\n          <span v-if=\"failover.interfaces?.[iface]?.latency\" class=\"latency\">\n            {{ failover.interfaces[iface].latency }}ms\n          </span>\n          <v-chip v-if=\"failover.active === iface\" size=\"x-small\" color=\"success\" class=\"ml-2\">AKTIV</v-chip>\n        </div>\n      </v-card-text>\n    </v-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      failover: { priority: ['eth0', 'eth1', 'wlan0'], active: null, interfaces: {} }\n    }\n  },\n  mounted() {\n    this.refresh();\n    this.interval = setInterval(() => this.refresh(), 15000);\n  },\n  beforeUnmount() {\n    if (this.interval) clearInterval(this.interval);\n  },\n  methods: {\n    async refresh() {\n      try {\n        const res = await fetch('/api/network/failover');\n        const data = await res.json();\n        if (data.success) this.failover = data.data;\n      } catch (e) { console.error(e); }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.status-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n  border-radius: 12px;\n}\n.priority-item {\n  display: flex;\n  align-items: center;\n  padding: 8px 12px;\n  margin: 4px 0;\n  border-radius: 8px;\n  background: rgba(255,255,255,0.05);\n  transition: all 0.3s ease;\n}\n.priority-item.active {\n  background: rgba(76, 175, 80, 0.2);\n  border: 1px solid rgba(76, 175, 80, 0.5);\n}\n.priority-number {\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  background: rgba(27, 191, 255, 0.3);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  font-weight: bold;\n  margin-right: 8px;\n}\n.iface-name {\n  flex: 1;\n  margin-left: 8px;\n  font-weight: 500;\n}\n.latency {\n  font-size: 11px;\n  opacity: 0.7;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "alarms-main-component",
        "type": "ui-template",
        "z": "alarms-stats-flow",
        "group": "alarms-group-main",
        "page": "",
        "ui": "",
        "name": "Larm Modul",
        "order": 1,
        "width": "12",
        "height": "20",
        "head": "",
        "format": "<template>\n  <div class=\"alarms-module\">\n    <!-- Tabs -->\n    <v-tabs v-model=\"activeTab\" bg-color=\"transparent\" color=\"#1BBFFF\">\n      <v-tab value=\"active\">\n        <v-badge :content=\"activeAlarms.length\" :color=\"criticalCount > 0 ? 'error' : 'primary'\" inline>\n          Aktiva Larm\n        </v-badge>\n      </v-tab>\n      <v-tab value=\"history\">Larmhistorik</v-tab>\n      <v-tab value=\"incident\" v-if=\"selectedIncident\">Incident</v-tab>\n      <v-tab value=\"service\">Service-l√§ge</v-tab>\n    </v-tabs>\n\n    <v-window v-model=\"activeTab\">\n      <!-- AKTIVA LARM -->\n      <v-window-item value=\"active\">\n        <div class=\"tab-content\">\n          <!-- Filter -->\n          <v-row class=\"mb-4\">\n            <v-col cols=\"12\" md=\"6\">\n              <v-btn-toggle v-model=\"severityFilter\" multiple density=\"compact\">\n                <v-btn value=\"critical\" color=\"error\" variant=\"tonal\" size=\"small\">\n                  <v-icon size=\"small\">mdi-alert-circle</v-icon> Kritiska ({{ bySeverity.critical }})\n                </v-btn>\n                <v-btn value=\"warning\" color=\"warning\" variant=\"tonal\" size=\"small\">\n                  <v-icon size=\"small\">mdi-alert</v-icon> Varningar ({{ bySeverity.warning }})\n                </v-btn>\n                <v-btn value=\"info\" color=\"info\" variant=\"tonal\" size=\"small\">\n                  <v-icon size=\"small\">mdi-information</v-icon> Info ({{ bySeverity.info }})\n                </v-btn>\n              </v-btn-toggle>\n            </v-col>\n            <v-col cols=\"12\" md=\"4\">\n              <v-text-field v-model=\"searchText\" prepend-inner-icon=\"mdi-magnify\" label=\"S√∂k enhet/text\" density=\"compact\" clearable hide-details></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" md=\"2\">\n              <v-btn color=\"success\" block @click=\"refreshAlarms\" :loading=\"loading\">\n                <v-icon>mdi-refresh</v-icon>\n              </v-btn>\n            </v-col>\n          </v-row>\n\n          <!-- Alarm List -->\n          <v-card v-if=\"filteredAlarms.length === 0\" class=\"empty-state\">\n            <v-card-text class=\"text-center py-8\">\n              <v-icon size=\"64\" color=\"success\">mdi-check-circle-outline</v-icon>\n              <h3 class=\"mt-4\">Inga aktiva larm</h3>\n              <p class=\"text-caption\">Alla system fungerar normalt</p>\n            </v-card-text>\n          </v-card>\n\n          <v-card v-for=\"alarm in filteredAlarms\" :key=\"alarm.id\" class=\"alarm-card mb-3\" :class=\"'severity-' + alarm.severity\">\n            <v-card-text class=\"d-flex align-center\">\n              <div class=\"alarm-indicator\" :class=\"alarm.severity\"></div>\n              <div class=\"alarm-content flex-grow-1\">\n                <div class=\"d-flex align-center mb-1\">\n                  <v-chip :color=\"getSeverityColor(alarm.severity)\" size=\"x-small\" class=\"mr-2\">\n                    {{ getSeverityLabel(alarm.severity) }}\n                  </v-chip>\n                  <span class=\"alarm-time\">{{ formatTime(alarm.timestamp) }}</span>\n                  <v-chip v-if=\"alarm.hitCount > 1\" size=\"x-small\" color=\"warning\" class=\"ml-2\">\n                    x{{ alarm.hitCount }}\n                  </v-chip>\n                </div>\n                <div class=\"alarm-device\">{{ alarm.device }}</div>\n                <div class=\"alarm-message\">{{ alarm.message }}</div>\n                <v-chip v-if=\"alarm.code\" size=\"x-small\" variant=\"outlined\" class=\"mt-1\">Kod: {{ alarm.code }}</v-chip>\n              </div>\n              <v-tooltip :text=\"alarm.description || 'Ingen beskrivning'\" location=\"top\">\n                <template v-slot:activator=\"{ props }\">\n                  <v-btn v-bind=\"props\" icon size=\"small\" variant=\"text\" class=\"mr-2\">\n                    <v-icon>mdi-information-outline</v-icon>\n                  </v-btn>\n                </template>\n              </v-tooltip>\n              <v-btn color=\"success\" variant=\"tonal\" @click=\"acknowledgeAlarm(alarm)\" :loading=\"ackLoading === alarm.id\">\n                <v-icon left>mdi-check</v-icon> Kvittera\n              </v-btn>\n            </v-card-text>\n          </v-card>\n\n          <!-- Bulk Actions -->\n          <v-row v-if=\"activeAlarms.length > 0\" class=\"mt-4\">\n            <v-col>\n              <v-btn color=\"success\" variant=\"outlined\" @click=\"acknowledgeAll()\">\n                <v-icon left>mdi-check-all</v-icon> Kvittera alla\n              </v-btn>\n            </v-col>\n          </v-row>\n        </div>\n      </v-window-item>\n\n      <!-- LARMHISTORIK -->\n      <v-window-item value=\"history\">\n        <div class=\"tab-content\">\n          <!-- Filter -->\n          <v-row class=\"mb-4\">\n            <v-col cols=\"12\" md=\"3\">\n              <v-text-field v-model=\"historyFilters.start\" type=\"date\" label=\"Fr√•n datum\" density=\"compact\" hide-details></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" md=\"3\">\n              <v-text-field v-model=\"historyFilters.end\" type=\"date\" label=\"Till datum\" density=\"compact\" hide-details></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" md=\"2\">\n              <v-select v-model=\"historyFilters.severity\" :items=\"severityOptions\" label=\"Allvarlighetsgrad\" density=\"compact\" clearable hide-details></v-select>\n            </v-col>\n            <v-col cols=\"12\" md=\"2\">\n              <v-text-field v-model=\"historyFilters.device\" label=\"Enhet\" density=\"compact\" clearable hide-details></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" md=\"2\">\n              <v-btn color=\"primary\" block @click=\"loadHistory\" :loading=\"historyLoading\">\n                <v-icon>mdi-magnify</v-icon> S√∂k\n              </v-btn>\n            </v-col>\n          </v-row>\n\n          <v-checkbox v-model=\"historyFilters.unacknowledgedOnly\" label=\"Visa bara okvitterade\" density=\"compact\" hide-details class=\"mb-4\"></v-checkbox>\n\n          <!-- History Table -->\n          <v-data-table :headers=\"historyHeaders\" :items=\"historyItems\" :loading=\"historyLoading\" class=\"history-table\" density=\"compact\" :items-per-page=\"20\">\n            <template v-slot:item.timestamp=\"{ item }\">\n              {{ formatDateTime(item.timestamp) }}\n            </template>\n            <template v-slot:item.severity=\"{ item }\">\n              <v-chip :color=\"getSeverityColor(item.severity)\" size=\"x-small\">\n                {{ getSeverityLabel(item.severity) }}\n              </v-chip>\n            </template>\n            <template v-slot:item.durationFormatted=\"{ item }\">\n              {{ item.durationFormatted || '-' }}\n            </template>\n            <template v-slot:item.acknowledgedBy=\"{ item }\">\n              {{ item.acknowledgedBy || '-' }}\n            </template>\n            <template v-slot:item.actions=\"{ item }\">\n              <v-btn icon size=\"x-small\" @click=\"openIncident(item)\">\n                <v-icon>mdi-eye</v-icon>\n              </v-btn>\n            </template>\n          </v-data-table>\n\n          <v-btn color=\"primary\" variant=\"outlined\" class=\"mt-4\" @click=\"exportHistory\">\n            <v-icon left>mdi-download</v-icon> Exportera CSV\n          </v-btn>\n        </div>\n      </v-window-item>\n\n      <!-- INCIDENT-VY -->\n      <v-window-item value=\"incident\">\n        <div class=\"tab-content\" v-if=\"selectedIncident\">\n          <v-btn variant=\"text\" @click=\"activeTab = 'history'\" class=\"mb-4\">\n            <v-icon left>mdi-arrow-left</v-icon> Tillbaka till historik\n          </v-btn>\n\n          <v-row>\n            <!-- Sammanfattning -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"incident-summary\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-file-document-outline</v-icon>\n                  Incidentsammanfattning\n                </v-card-title>\n                <v-card-text>\n                  <v-list density=\"compact\" class=\"bg-transparent\">\n                    <v-list-item>\n                      <v-list-item-title>Larmtyp</v-list-item-title>\n                      <v-list-item-subtitle>\n                        <v-chip :color=\"getSeverityColor(incidentData?.alarm?.severity)\" size=\"small\">\n                          {{ getSeverityLabel(incidentData?.alarm?.severity) }}\n                        </v-chip>\n                      </v-list-item-subtitle>\n                    </v-list-item>\n                    <v-list-item>\n                      <v-list-item-title>Enhet</v-list-item-title>\n                      <v-list-item-subtitle>{{ incidentData?.alarm?.device }}</v-list-item-subtitle>\n                    </v-list-item>\n                    <v-list-item>\n                      <v-list-item-title>Larmtext</v-list-item-title>\n                      <v-list-item-subtitle>{{ incidentData?.alarm?.message }}</v-list-item-subtitle>\n                    </v-list-item>\n                    <v-list-item>\n                      <v-list-item-title>Starttid</v-list-item-title>\n                      <v-list-item-subtitle>{{ formatDateTime(incidentData?.alarm?.timestamp) }}</v-list-item-subtitle>\n                    </v-list-item>\n                    <v-list-item>\n                      <v-list-item-title>Sluttid</v-list-item-title>\n                      <v-list-item-subtitle>{{ formatDateTime(incidentData?.alarm?.endedAt) }}</v-list-item-subtitle>\n                    </v-list-item>\n                    <v-list-item>\n                      <v-list-item-title>Varaktighet</v-list-item-title>\n                      <v-list-item-subtitle>{{ incidentData?.alarm?.durationFormatted || '-' }}</v-list-item-subtitle>\n                    </v-list-item>\n                    <v-list-item>\n                      <v-list-item-title>Kvitterad av</v-list-item-title>\n                      <v-list-item-subtitle>{{ incidentData?.alarm?.acknowledgedBy || '-' }}</v-list-item-subtitle>\n                    </v-list-item>\n                  </v-list>\n\n                  <v-divider class=\"my-3\"></v-divider>\n\n                  <!-- Kommentarer -->\n                  <h4 class=\"mb-2\">Kommentarer</h4>\n                  <div v-if=\"incidentData?.alarm?.comments?.length\">\n                    <div v-for=\"comment in incidentData.alarm.comments\" :key=\"comment.id\" class=\"comment-item\">\n                      <div class=\"comment-meta\">{{ comment.author }} - {{ formatDateTime(comment.timestamp) }}</div>\n                      <div class=\"comment-text\">{{ comment.text }}</div>\n                    </div>\n                  </div>\n                  <p v-else class=\"text-caption\">Inga kommentarer</p>\n\n                  <v-textarea v-model=\"newComment\" label=\"L√§gg till kommentar\" rows=\"2\" density=\"compact\" class=\"mt-3\"></v-textarea>\n                  <v-btn color=\"primary\" size=\"small\" @click=\"addComment\" :loading=\"commentLoading\" :disabled=\"!newComment\">\n                    <v-icon left size=\"small\">mdi-plus</v-icon> L√§gg till\n                  </v-btn>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Graf -->\n            <v-col cols=\"12\" md=\"8\">\n              <v-card class=\"incident-chart\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-chart-line</v-icon>\n                  M√§tv√§rden (30 min f√∂re + 30 min efter)\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"chart-container\" ref=\"chartContainer\">\n                    <canvas ref=\"incidentChart\"></canvas>\n                  </div>\n                  <div class=\"chart-legend\">\n                    <span v-for=\"series in incidentData?.measurements?.series\" :key=\"series.key\" class=\"legend-item\">\n                      <span class=\"legend-color\" :style=\"{backgroundColor: series.color}\"></span>\n                      {{ series.name }} ({{ series.unit }})\n                    </span>\n                  </div>\n                </v-card-text>\n              </v-card>\n\n              <!-- Export -->\n              <v-row class=\"mt-4\">\n                <v-col>\n                  <v-btn color=\"primary\" variant=\"outlined\" @click=\"exportIncident('csv')\">\n                    <v-icon left>mdi-file-delimited</v-icon> Exportera CSV\n                  </v-btn>\n                  <v-btn color=\"primary\" variant=\"outlined\" class=\"ml-2\" @click=\"exportIncident('json')\">\n                    <v-icon left>mdi-code-json</v-icon> Exportera JSON\n                  </v-btn>\n                </v-col>\n              </v-row>\n            </v-col>\n          </v-row>\n        </div>\n      </v-window-item>\n\n      <!-- SERVICE-L√ÑGE -->\n      <v-window-item value=\"service\">\n        <div class=\"tab-content\">\n          <v-row class=\"mb-4\">\n            <v-col cols=\"12\" md=\"8\">\n              <v-text-field v-model=\"serviceSearch\" prepend-inner-icon=\"mdi-magnify\" label=\"S√∂k enhet\" density=\"compact\" clearable hide-details></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" md=\"4\">\n              <v-btn color=\"primary\" @click=\"refreshServiceMode\" :loading=\"serviceLoading\">\n                <v-icon left>mdi-refresh</v-icon> Uppdatera\n              </v-btn>\n            </v-col>\n          </v-row>\n\n          <!-- Active Service Modes -->\n          <v-alert v-if=\"devicesInService.length > 0\" type=\"info\" variant=\"tonal\" class=\"mb-4\">\n            <v-icon>mdi-wrench</v-icon>\n            {{ devicesInService.length }} enhet(er) i service-l√§ge\n          </v-alert>\n\n          <!-- Device List -->\n          <v-card v-for=\"device in filteredServiceDevices\" :key=\"device.deviceId\" class=\"service-device-card mb-3\" :class=\"{'in-service': device.serviceMode}\">\n            <v-card-text class=\"d-flex align-center\">\n              <v-icon v-if=\"device.serviceMode\" color=\"info\" class=\"mr-3\">mdi-wrench</v-icon>\n              <v-icon v-else class=\"mr-3\">mdi-cube-outline</v-icon>\n              \n              <div class=\"flex-grow-1\">\n                <div class=\"device-name\">{{ device.name || device.deviceId }}</div>\n                <div class=\"device-info\">\n                  <span v-if=\"device.model\">{{ device.model }}</span>\n                  <span v-if=\"device.address\"> @ {{ device.address }}</span>\n                </div>\n                <div v-if=\"device.serviceMode\" class=\"service-info\">\n                  <v-chip size=\"x-small\" color=\"info\">Service aktivt</v-chip>\n                  <span class=\"ml-2\">Slutar: {{ formatDateTime(device.serviceEndsAt) }}</span>\n                  <span v-if=\"device.remainingMinutes\" class=\"ml-2\">({{ device.remainingMinutes }} min kvar)</span>\n                </div>\n              </div>\n\n              <v-switch v-model=\"device.serviceMode\" color=\"info\" hide-details @change=\"toggleServiceMode(device)\" :loading=\"serviceToggleLoading === device.deviceId\"></v-switch>\n            </v-card-text>\n\n            <!-- Duration picker when enabling -->\n            <v-expand-transition>\n              <v-card-text v-if=\"serviceDurationPicker === device.deviceId\" class=\"pt-0\">\n                <v-divider class=\"mb-3\"></v-divider>\n                <v-row>\n                  <v-col cols=\"12\" md=\"6\">\n                    <v-select v-model=\"serviceDuration\" :items=\"durationPresets\" label=\"Varaktighet\" density=\"compact\"></v-select>\n                  </v-col>\n                  <v-col cols=\"12\" md=\"6\" v-if=\"serviceDuration === 'custom'\">\n                    <v-text-field v-model=\"customEndTime\" type=\"datetime-local\" label=\"Sluttid\" density=\"compact\"></v-text-field>\n                  </v-col>\n                </v-row>\n                <v-btn color=\"info\" @click=\"confirmServiceMode(device)\">Aktivera service-l√§ge</v-btn>\n                <v-btn variant=\"text\" @click=\"serviceDurationPicker = null\" class=\"ml-2\">Avbryt</v-btn>\n              </v-card-text>\n            </v-expand-transition>\n          </v-card>\n        </div>\n      </v-window-item>\n    </v-window>\n\n    <!-- Ack Dialog -->\n    <v-dialog v-model=\"ackDialog\" max-width=\"400\">\n      <v-card>\n        <v-card-title>Kvittera larm</v-card-title>\n        <v-card-text>\n          <p class=\"mb-3\">{{ ackAlarm?.message }}</p>\n          <v-text-field v-model=\"ackBy\" label=\"Kvitterat av\" density=\"compact\"></v-text-field>\n          <v-textarea v-model=\"ackComment\" label=\"Kommentar (valfritt)\" rows=\"2\" density=\"compact\"></v-textarea>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn @click=\"ackDialog = false\">Avbryt</v-btn>\n          <v-btn color=\"success\" @click=\"confirmAck\" :loading=\"ackLoading\">Kvittera</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      activeTab: 'active',\n      loading: false,\n      activeAlarms: [],\n      severityFilter: ['critical', 'warning', 'info'],\n      searchText: '',\n      \n      // Ack\n      ackDialog: false,\n      ackAlarm: null,\n      ackBy: '',\n      ackComment: '',\n      ackLoading: null,\n      \n      // History\n      historyLoading: false,\n      historyItems: [],\n      historyFilters: {\n        start: '',\n        end: '',\n        severity: null,\n        device: '',\n        unacknowledgedOnly: false\n      },\n      historyHeaders: [\n        { title: 'Tidpunkt', key: 'timestamp', width: '150px' },\n        { title: 'Enhet', key: 'device' },\n        { title: 'Allvarlighet', key: 'severity', width: '100px' },\n        { title: 'Meddelande', key: 'message' },\n        { title: 'Varaktighet', key: 'durationFormatted', width: '100px' },\n        { title: 'Kvitterad av', key: 'acknowledgedBy', width: '120px' },\n        { title: '', key: 'actions', width: '60px', sortable: false }\n      ],\n      severityOptions: [\n        { title: 'Kritiskt', value: 'critical' },\n        { title: 'Varning', value: 'warning' },\n        { title: 'Info', value: 'info' }\n      ],\n      \n      // Incident\n      selectedIncident: null,\n      incidentData: null,\n      incidentLoading: false,\n      newComment: '',\n      commentLoading: false,\n      chart: null,\n      \n      // Service Mode\n      serviceLoading: false,\n      serviceDevices: [],\n      serviceSearch: '',\n      serviceDurationPicker: null,\n      serviceDuration: '1h',\n      customEndTime: '',\n      serviceToggleLoading: null,\n      durationPresets: [\n        { title: '15 minuter', value: '15min' },\n        { title: '30 minuter', value: '30min' },\n        { title: '1 timme', value: '1h' },\n        { title: '3 timmar', value: '3h' },\n        { title: '6 timmar', value: '6h' },\n        { title: '12 timmar', value: '12h' },\n        { title: '24 timmar', value: '24h' },\n        { title: 'Anpassad', value: 'custom' }\n      ]\n    }\n  },\n  \n  computed: {\n    filteredAlarms() {\n      return this.activeAlarms.filter(a => {\n        if (!this.severityFilter.includes(a.severity)) return false;\n        if (this.searchText) {\n          const search = this.searchText.toLowerCase();\n          return a.device.toLowerCase().includes(search) || \n                 a.message.toLowerCase().includes(search);\n        }\n        return true;\n      });\n    },\n    bySeverity() {\n      const counts = { critical: 0, warning: 0, info: 0 };\n      this.activeAlarms.forEach(a => counts[a.severity]++);\n      return counts;\n    },\n    criticalCount() {\n      return this.bySeverity.critical;\n    },\n    devicesInService() {\n      return this.serviceDevices.filter(d => d.serviceMode);\n    },\n    filteredServiceDevices() {\n      if (!this.serviceSearch) return this.serviceDevices;\n      const search = this.serviceSearch.toLowerCase();\n      return this.serviceDevices.filter(d => \n        (d.name || d.deviceId).toLowerCase().includes(search) ||\n        (d.model || '').toLowerCase().includes(search)\n      );\n    }\n  },\n  \n  mounted() {\n    this.refreshAlarms();\n    this.refreshServiceMode();\n    this.autoRefresh = setInterval(() => {\n      if (this.activeTab === 'active') this.refreshAlarms();\n      if (this.activeTab === 'service') this.refreshServiceMode();\n    }, 30000);\n  },\n  \n  beforeUnmount() {\n    if (this.autoRefresh) clearInterval(this.autoRefresh);\n    if (this.chart) this.chart.destroy();\n  },\n  \n  methods: {\n    async refreshAlarms() {\n      this.loading = true;\n      try {\n        const res = await fetch('/api/alarms/active');\n        const data = await res.json();\n        if (data.success) this.activeAlarms = data.data;\n      } catch (e) { console.error(e); }\n      this.loading = false;\n    },\n    \n    getSeverityColor(severity) {\n      const colors = { critical: 'error', warning: 'warning', info: 'info' };\n      return colors[severity] || 'grey';\n    },\n    \n    getSeverityLabel(severity) {\n      const labels = { critical: 'Kritiskt', warning: 'Varning', info: 'Info' };\n      return labels[severity] || severity;\n    },\n    \n    formatTime(ts) {\n      if (!ts) return '-';\n      return new Date(ts).toLocaleTimeString('sv-SE');\n    },\n    \n    formatDateTime(ts) {\n      if (!ts) return '-';\n      return new Date(ts).toLocaleString('sv-SE');\n    },\n    \n    acknowledgeAlarm(alarm) {\n      this.ackAlarm = alarm;\n      this.ackBy = '';\n      this.ackComment = '';\n      this.ackDialog = true;\n    },\n    \n    async confirmAck() {\n      if (!this.ackAlarm) return;\n      this.ackLoading = this.ackAlarm.id;\n      try {\n        await fetch('/api/alarms/ack', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            alarmId: this.ackAlarm.id,\n            acknowledgedBy: this.ackBy || 'Ok√§nd',\n            comment: this.ackComment\n          })\n        });\n        this.ackDialog = false;\n        this.refreshAlarms();\n      } catch (e) { console.error(e); }\n      this.ackLoading = null;\n    },\n    \n    async acknowledgeAll(severity) {\n      if (!confirm('Kvittera alla larm?')) return;\n      try {\n        await fetch('/api/alarms/ack-all', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ acknowledgedBy: 'Bulk', severity })\n        });\n        this.refreshAlarms();\n      } catch (e) { console.error(e); }\n    },\n    \n    async loadHistory() {\n      this.historyLoading = true;\n      try {\n        const params = new URLSearchParams();\n        if (this.historyFilters.start) params.append('start', this.historyFilters.start);\n        if (this.historyFilters.end) params.append('end', this.historyFilters.end);\n        if (this.historyFilters.severity) params.append('severity', this.historyFilters.severity);\n        if (this.historyFilters.device) params.append('device', this.historyFilters.device);\n        if (this.historyFilters.unacknowledgedOnly) params.append('unacknowledgedOnly', 'true');\n        params.append('limit', '500');\n        \n        const res = await fetch('/api/alarms/history?' + params);\n        const data = await res.json();\n        if (data.success) this.historyItems = data.data;\n      } catch (e) { console.error(e); }\n      this.historyLoading = false;\n    },\n    \n    async openIncident(alarm) {\n      this.selectedIncident = alarm;\n      this.incidentLoading = true;\n      this.activeTab = 'incident';\n      \n      try {\n        const res = await fetch(`/api/alarms/incident/${alarm.id}`);\n        const data = await res.json();\n        if (data.success) {\n          this.incidentData = data.data;\n          this.$nextTick(() => this.renderChart());\n        }\n      } catch (e) { console.error(e); }\n      this.incidentLoading = false;\n    },\n    \n    renderChart() {\n      if (!this.incidentData?.measurements?.data) return;\n      if (this.chart) this.chart.destroy();\n      \n      const ctx = this.$refs.incidentChart?.getContext('2d');\n      if (!ctx) return;\n      \n      const measurements = this.incidentData.measurements;\n      const labels = measurements.data.map(d => new Date(d.timestamp).toLocaleTimeString('sv-SE'));\n      \n      const datasets = measurements.series.map(s => ({\n        label: s.name,\n        data: measurements.data.map(d => d[s.key]),\n        borderColor: s.color,\n        backgroundColor: s.color + '20',\n        fill: false,\n        tension: 0.3\n      }));\n      \n      // Chart.js needs to be loaded\n      if (typeof Chart !== 'undefined') {\n        this.chart = new Chart(ctx, {\n          type: 'line',\n          data: { labels, datasets },\n          options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: {\n              y: { grid: { color: 'rgba(255,255,255,0.1)' } },\n              x: { grid: { color: 'rgba(255,255,255,0.1)' } }\n            },\n            plugins: {\n              annotation: {\n                annotations: {\n                  alarmLine: {\n                    type: 'line',\n                    xMin: new Date(this.incidentData.alarm.timestamp).toLocaleTimeString('sv-SE'),\n                    xMax: new Date(this.incidentData.alarm.timestamp).toLocaleTimeString('sv-SE'),\n                    borderColor: '#F44336',\n                    borderWidth: 2,\n                    label: { content: 'Larm', enabled: true }\n                  }\n                }\n              }\n            }\n          }\n        });\n      }\n    },\n    \n    async addComment() {\n      if (!this.newComment || !this.selectedIncident) return;\n      this.commentLoading = true;\n      try {\n        await fetch(`/api/alarms/incident/${this.selectedIncident.id}/comment`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ comment: this.newComment, author: 'Anv√§ndare' })\n        });\n        this.newComment = '';\n        this.openIncident(this.selectedIncident);\n      } catch (e) { console.error(e); }\n      this.commentLoading = false;\n    },\n    \n    async exportHistory() {\n      const params = new URLSearchParams();\n      if (this.historyFilters.start) params.append('start', this.historyFilters.start);\n      if (this.historyFilters.end) params.append('end', this.historyFilters.end);\n      window.open('/api/alarms/export?' + params, '_blank');\n    },\n    \n    async exportIncident(format) {\n      if (!this.selectedIncident) return;\n      window.open(`/api/alarms/incident/${this.selectedIncident.id}/export?format=${format}`, '_blank');\n    },\n    \n    // Service Mode\n    async refreshServiceMode() {\n      this.serviceLoading = true;\n      try {\n        const res = await fetch('/api/servicemode');\n        const data = await res.json();\n        if (data.success) {\n          this.serviceDevices = Object.values(data.data);\n        }\n      } catch (e) { console.error(e); }\n      this.serviceLoading = false;\n    },\n    \n    toggleServiceMode(device) {\n      if (device.serviceMode) {\n        // Show duration picker\n        this.serviceDurationPicker = device.deviceId;\n        device.serviceMode = false; // Reset until confirmed\n      } else {\n        this.disableServiceMode(device);\n      }\n    },\n    \n    async confirmServiceMode(device) {\n      this.serviceToggleLoading = device.deviceId;\n      try {\n        const body = {\n          deviceId: device.deviceId,\n          enabled: true,\n          duration: this.serviceDuration !== 'custom' ? this.serviceDuration : undefined,\n          endTime: this.serviceDuration === 'custom' ? this.customEndTime : undefined,\n          startedBy: 'Dashboard'\n        };\n        \n        await fetch('/api/servicemode/set', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(body)\n        });\n        \n        this.serviceDurationPicker = null;\n        this.refreshServiceMode();\n      } catch (e) { console.error(e); }\n      this.serviceToggleLoading = null;\n    },\n    \n    async disableServiceMode(device) {\n      this.serviceToggleLoading = device.deviceId;\n      try {\n        await fetch('/api/servicemode/set', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            deviceId: device.deviceId,\n            enabled: false,\n            endedBy: 'Dashboard'\n          })\n        });\n        this.refreshServiceMode();\n      } catch (e) { console.error(e); }\n      this.serviceToggleLoading = null;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.alarms-module {\n  padding: 16px;\n  font-family: 'Montserrat', sans-serif;\n}\n\n.tab-content {\n  padding: 20px 0;\n}\n\n.alarm-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border-radius: 12px;\n  border-left: 4px solid transparent;\n  transition: all 0.3s ease;\n}\n\n.alarm-card.severity-critical { border-left-color: #F44336; }\n.alarm-card.severity-warning { border-left-color: #FFC107; }\n.alarm-card.severity-info { border-left-color: #2196F3; }\n\n.alarm-card:hover {\n  transform: translateX(4px);\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n}\n\n.alarm-indicator {\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  margin-right: 16px;\n  animation: pulse 2s infinite;\n}\n\n.alarm-indicator.critical { background: #F44336; }\n.alarm-indicator.warning { background: #FFC107; }\n.alarm-indicator.info { background: #2196F3; }\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; transform: scale(1); }\n  50% { opacity: 0.5; transform: scale(1.2); }\n}\n\n.alarm-time {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.6);\n}\n\n.alarm-device {\n  font-weight: 600;\n  font-size: 14px;\n  color: #fff;\n}\n\n.alarm-message {\n  font-size: 13px;\n  color: rgba(255, 255, 255, 0.8);\n}\n\n.empty-state {\n  background: rgba(0, 20, 40, 0.5) !important;\n  border-radius: 12px;\n}\n\n.history-table {\n  background: rgba(0, 20, 40, 0.5) !important;\n  border-radius: 12px;\n}\n\n.incident-summary, .incident-chart {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border-radius: 12px;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n}\n\n.chart-container {\n  height: 300px;\n  position: relative;\n}\n\n.chart-legend {\n  display: flex;\n  gap: 16px;\n  margin-top: 12px;\n  flex-wrap: wrap;\n}\n\n.legend-item {\n  display: flex;\n  align-items: center;\n  font-size: 12px;\n}\n\n.legend-color {\n  width: 12px;\n  height: 12px;\n  border-radius: 2px;\n  margin-right: 6px;\n}\n\n.comment-item {\n  background: rgba(255, 255, 255, 0.05);\n  padding: 8px 12px;\n  border-radius: 8px;\n  margin-bottom: 8px;\n}\n\n.comment-meta {\n  font-size: 11px;\n  color: rgba(255, 255, 255, 0.5);\n  margin-bottom: 4px;\n}\n\n.comment-text {\n  font-size: 13px;\n}\n\n.service-device-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  transition: all 0.3s ease;\n}\n\n.service-device-card.in-service {\n  border-color: #2196F3;\n  background: rgba(33, 150, 243, 0.1) !important;\n}\n\n.device-name {\n  font-weight: 600;\n  font-size: 14px;\n}\n\n.device-info {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.6);\n}\n\n.service-info {\n  margin-top: 4px;\n  font-size: 12px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 510,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "stats-main-component",
        "type": "ui-template",
        "z": "alarms-stats-flow",
        "group": "stats-group-main",
        "page": "",
        "ui": "",
        "name": "Statistik Modul",
        "order": 1,
        "width": "12",
        "height": "20",
        "head": "",
        "format": "<template>\n  <div class=\"stats-module\">\n    <!-- Tabs -->\n    <v-tabs v-model=\"activeTab\" bg-color=\"transparent\" color=\"#1BBFFF\">\n      <v-tab value=\"system\">Systemstatistik</v-tab>\n      <v-tab value=\"temperatures\">Temperaturer</v-tab>\n      <v-tab value=\"modbus\">Kommunikation</v-tab>\n    </v-tabs>\n\n    <v-window v-model=\"activeTab\">\n      <!-- SYSTEMSTATISTIK -->\n      <v-window-item value=\"system\">\n        <div class=\"tab-content\">\n          <!-- Time Range -->\n          <v-btn-toggle v-model=\"systemRange\" mandatory class=\"mb-4\">\n            <v-btn value=\"1h\" size=\"small\">1 timme</v-btn>\n            <v-btn value=\"24h\" size=\"small\">24 timmar</v-btn>\n            <v-btn value=\"7d\" size=\"small\">7 dagar</v-btn>\n          </v-btn-toggle>\n\n          <v-row>\n            <!-- CPU -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-chip</v-icon> CPU\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"stat-value\">{{ systemStats?.current?.cpu?.usage || 0 }}%</div>\n                  <v-progress-linear :model-value=\"systemStats?.current?.cpu?.usage || 0\" height=\"8\" rounded :color=\"getCpuColor(systemStats?.current?.cpu?.usage)\"></v-progress-linear>\n                  <div class=\"stat-info\">{{ systemStats?.current?.cpu?.cores }} k√§rnor</div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Memory -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-memory</v-icon> Minne\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"stat-value\">{{ systemStats?.current?.memory?.usedPercent || 0 }}%</div>\n                  <v-progress-linear :model-value=\"systemStats?.current?.memory?.usedPercent || 0\" height=\"8\" rounded color=\"info\"></v-progress-linear>\n                  <div class=\"stat-info\">{{ systemStats?.current?.memory?.used }} / {{ systemStats?.current?.memory?.total }} MB</div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Disk -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-harddisk</v-icon> Disk\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"stat-value\">{{ systemStats?.current?.disk?.usedPercent || 0 }}%</div>\n                  <v-progress-linear :model-value=\"systemStats?.current?.disk?.usedPercent || 0\" height=\"8\" rounded :color=\"getDiskColor(systemStats?.current?.disk?.usedPercent)\"></v-progress-linear>\n                  <div class=\"stat-info\">{{ systemStats?.current?.disk?.used }} / {{ systemStats?.current?.disk?.total }}</div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Temperature -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-thermometer</v-icon> CPU Temperatur\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"stat-value\" :class=\"getTempClass(systemStats?.current?.temperature?.celsius)\">\n                    {{ systemStats?.current?.temperature?.celsius || '-' }}¬∞C\n                  </div>\n                  <v-progress-linear :model-value=\"systemStats?.current?.temperature?.celsius || 0\" :max=\"100\" height=\"8\" rounded :color=\"getTempColor(systemStats?.current?.temperature?.celsius)\"></v-progress-linear>\n                  <div class=\"stat-info\">{{ systemStats?.current?.temperature?.status }}</div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Uptime -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-clock-outline</v-icon> Uptime\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"stat-value\">{{ systemStats?.current?.uptime?.formatted || '-' }}</div>\n                  <div class=\"stat-info\">{{ systemStats?.current?.uptime?.days }} dagar, {{ systemStats?.current?.uptime?.hours }} timmar</div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Network -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-lan</v-icon> N√§tverk\n                </v-card-title>\n                <v-card-text>\n                  <div v-for=\"(iface, name) in systemStats?.current?.network\" :key=\"name\" class=\"network-iface\">\n                    <strong>{{ name }}</strong>\n                    <div class=\"network-stats\">\n                      <span>‚Üì {{ formatBytes(iface.rxBytes) }}</span>\n                      <span>‚Üë {{ formatBytes(iface.txBytes) }}</span>\n                    </div>\n                  </div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n          </v-row>\n\n          <!-- History Chart -->\n          <v-card class=\"stat-card mt-4\">\n            <v-card-title>\n              <v-icon class=\"mr-2\">mdi-chart-timeline-variant</v-icon>\n              Historik ({{ systemRange }})\n            </v-card-title>\n            <v-card-text>\n              <div class=\"chart-container\">\n                <canvas ref=\"systemChart\"></canvas>\n              </div>\n            </v-card-text>\n          </v-card>\n\n          <v-btn color=\"primary\" class=\"mt-4\" @click=\"refreshSystemStats\" :loading=\"systemLoading\">\n            <v-icon left>mdi-refresh</v-icon> Uppdatera\n          </v-btn>\n        </div>\n      </v-window-item>\n\n      <!-- TEMPERATURER -->\n      <v-window-item value=\"temperatures\">\n        <div class=\"tab-content\">\n          <v-row class=\"mb-4\">\n            <v-col cols=\"12\" md=\"4\">\n              <v-select v-model=\"selectedDevice\" :items=\"temperatureDevices\" label=\"V√§lj enhet\" density=\"compact\" clearable></v-select>\n            </v-col>\n            <v-col cols=\"12\" md=\"4\">\n              <v-btn-toggle v-model=\"tempRange\" mandatory>\n                <v-btn value=\"1h\" size=\"small\">1h</v-btn>\n                <v-btn value=\"6h\" size=\"small\">6h</v-btn>\n                <v-btn value=\"24h\" size=\"small\">24h</v-btn>\n                <v-btn value=\"7d\" size=\"small\">7d</v-btn>\n              </v-btn-toggle>\n            </v-col>\n            <v-col cols=\"12\" md=\"4\">\n              <v-btn color=\"primary\" @click=\"refreshTemperatures\" :loading=\"tempLoading\">\n                <v-icon left>mdi-refresh</v-icon> Uppdatera\n              </v-btn>\n            </v-col>\n          </v-row>\n\n          <!-- Current Values -->\n          <v-row v-if=\"tempStats?.stats\">\n            <v-col cols=\"6\" md=\"3\" v-for=\"(stat, key) in tempStats.stats\" :key=\"key\">\n              <v-card class=\"temp-card\">\n                <v-card-text class=\"text-center\">\n                  <div class=\"temp-label\">{{ getTempLabel(key) }}</div>\n                  <div class=\"temp-current\">{{ stat.current?.toFixed(1) || '-' }}¬∞C</div>\n                  <div class=\"temp-range\">\n                    <span class=\"min\">‚Üì{{ stat.min?.toFixed(1) }}</span>\n                    <span class=\"max\">‚Üë{{ stat.max?.toFixed(1) }}</span>\n                  </div>\n                  <div class=\"temp-avg\">Snitt: {{ stat.avg?.toFixed(1) }}¬∞C</div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n          </v-row>\n\n          <!-- Temperature Chart -->\n          <v-card class=\"stat-card mt-4\">\n            <v-card-title>\n              <v-icon class=\"mr-2\">mdi-thermometer-lines</v-icon>\n              Temperaturhistorik\n            </v-card-title>\n            <v-card-text>\n              <div class=\"chart-container\">\n                <canvas ref=\"tempChart\"></canvas>\n              </div>\n              <div class=\"chart-legend\" v-if=\"tempStats?.series\">\n                <span v-for=\"series in tempStats.series\" :key=\"series.key\" class=\"legend-item\">\n                  <span class=\"legend-color\" :style=\"{backgroundColor: series.color}\"></span>\n                  {{ series.name }}\n                </span>\n              </div>\n            </v-card-text>\n          </v-card>\n        </div>\n      </v-window-item>\n\n      <!-- MODBUS/KOMMUNIKATION -->\n      <v-window-item value=\"modbus\">\n        <div class=\"tab-content\">\n          <v-row>\n            <!-- Health Score -->\n            <v-col cols=\"12\" md=\"4\">\n              <v-card class=\"stat-card health-card\">\n                <v-card-text class=\"text-center\">\n                  <div class=\"health-score\" :class=\"getHealthClass(modbusStats?.healthScore)\">\n                    {{ modbusStats?.healthScore || 0 }}%\n                  </div>\n                  <div class=\"health-label\">Bus Health Score</div>\n                  <v-progress-linear :model-value=\"modbusStats?.healthScore || 0\" height=\"12\" rounded :color=\"getHealthColor(modbusStats?.healthScore)\"></v-progress-linear>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Error Summary -->\n            <v-col cols=\"12\" md=\"8\">\n              <v-card class=\"stat-card\">\n                <v-card-title>Fel senaste 24h</v-card-title>\n                <v-card-text>\n                  <v-row>\n                    <v-col cols=\"3\" class=\"text-center\">\n                      <div class=\"error-count\">{{ modbusStats?.errors?.timeout || 0 }}</div>\n                      <div class=\"error-label\">Timeout</div>\n                    </v-col>\n                    <v-col cols=\"3\" class=\"text-center\">\n                      <div class=\"error-count\">{{ modbusStats?.errors?.crc || 0 }}</div>\n                      <div class=\"error-label\">CRC</div>\n                    </v-col>\n                    <v-col cols=\"3\" class=\"text-center\">\n                      <div class=\"error-count\">{{ modbusStats?.errors?.collision || 0 }}</div>\n                      <div class=\"error-label\">Kollision</div>\n                    </v-col>\n                    <v-col cols=\"3\" class=\"text-center\">\n                      <div class=\"error-count\">{{ modbusStats?.errors?.retries || 0 }}</div>\n                      <div class=\"error-label\">Retries</div>\n                    </v-col>\n                  </v-row>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Top Problematic Devices -->\n            <v-col cols=\"12\" md=\"6\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-alert-circle</v-icon>\n                  Enheter med flest problem\n                </v-card-title>\n                <v-card-text>\n                  <v-list density=\"compact\" class=\"bg-transparent\">\n                    <v-list-item v-for=\"device in problematicDevices\" :key=\"device.deviceId\">\n                      <template v-slot:prepend>\n                        <v-icon color=\"warning\">mdi-alert</v-icon>\n                      </template>\n                      <v-list-item-title>{{ device.deviceId }}</v-list-item-title>\n                      <v-list-item-subtitle>{{ device.total }} fel</v-list-item-subtitle>\n                      <template v-slot:append>\n                        <span class=\"text-caption\">{{ formatDateTime(device.lastError) }}</span>\n                      </template>\n                    </v-list-item>\n                    <v-list-item v-if=\"!problematicDevices?.length\">\n                      <v-list-item-title class=\"text-success\">Inga problemenheter</v-list-item-title>\n                    </v-list-item>\n                  </v-list>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Error History Chart -->\n            <v-col cols=\"12\" md=\"6\">\n              <v-card class=\"stat-card\">\n                <v-card-title>\n                  <v-icon class=\"mr-2\">mdi-chart-bar</v-icon>\n                  Fel per timme\n                </v-card-title>\n                <v-card-text>\n                  <div class=\"chart-container-small\">\n                    <canvas ref=\"modbusChart\"></canvas>\n                  </div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n\n            <!-- Request Stats -->\n            <v-col cols=\"12\">\n              <v-card class=\"stat-card\">\n                <v-card-title>Kommunikationsstatistik</v-card-title>\n                <v-card-text>\n                  <v-row>\n                    <v-col cols=\"4\" class=\"text-center\">\n                      <div class=\"big-stat\">{{ modbusStats?.totalRequests || 0 }}</div>\n                      <div class=\"stat-label\">Totalt antal f√∂rfr√•gningar</div>\n                    </v-col>\n                    <v-col cols=\"4\" class=\"text-center\">\n                      <div class=\"big-stat text-success\">{{ modbusStats?.successfulRequests || 0 }}</div>\n                      <div class=\"stat-label\">Lyckade</div>\n                    </v-col>\n                    <v-col cols=\"4\" class=\"text-center\">\n                      <div class=\"big-stat text-error\">{{ (modbusStats?.totalRequests || 0) - (modbusStats?.successfulRequests || 0) }}</div>\n                      <div class=\"stat-label\">Misslyckade</div>\n                    </v-col>\n                  </v-row>\n                </v-card-text>\n              </v-card>\n            </v-col>\n          </v-row>\n\n          <v-row class=\"mt-4\">\n            <v-col>\n              <v-btn color=\"primary\" @click=\"refreshModbusStats\" :loading=\"modbusLoading\">\n                <v-icon left>mdi-refresh</v-icon> Uppdatera\n              </v-btn>\n              <v-btn color=\"warning\" variant=\"outlined\" class=\"ml-2\" @click=\"resetModbusStats\">\n                <v-icon left>mdi-restart</v-icon> Nollst√§ll statistik\n              </v-btn>\n            </v-col>\n          </v-row>\n        </div>\n      </v-window-item>\n    </v-window>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      activeTab: 'system',\n      \n      // System\n      systemRange: '1h',\n      systemStats: null,\n      systemLoading: false,\n      systemChart: null,\n      \n      // Temperatures\n      tempRange: '24h',\n      selectedDevice: null,\n      temperatureDevices: [],\n      tempStats: null,\n      tempLoading: false,\n      tempChart: null,\n      \n      // Modbus\n      modbusStats: null,\n      problematicDevices: [],\n      modbusLoading: false,\n      modbusChart: null\n    }\n  },\n  \n  watch: {\n    systemRange() { this.refreshSystemStats(); },\n    tempRange() { this.refreshTemperatures(); },\n    selectedDevice() { this.refreshTemperatures(); }\n  },\n  \n  mounted() {\n    this.refreshSystemStats();\n    this.loadTemperatureDevices();\n    this.refreshModbusStats();\n    \n    this.autoRefresh = setInterval(() => {\n      if (this.activeTab === 'system') this.refreshSystemStats();\n      if (this.activeTab === 'modbus') this.refreshModbusStats();\n    }, 30000);\n  },\n  \n  beforeUnmount() {\n    if (this.autoRefresh) clearInterval(this.autoRefresh);\n    if (this.systemChart) this.systemChart.destroy();\n    if (this.tempChart) this.tempChart.destroy();\n    if (this.modbusChart) this.modbusChart.destroy();\n  },\n  \n  methods: {\n    async refreshSystemStats() {\n      this.systemLoading = true;\n      try {\n        const res = await fetch(`/api/stats/system?range=${this.systemRange}`);\n        const data = await res.json();\n        if (data.success) {\n          this.systemStats = data.data;\n          this.$nextTick(() => this.renderSystemChart());\n        }\n      } catch (e) { console.error(e); }\n      this.systemLoading = false;\n    },\n    \n    renderSystemChart() {\n      if (!this.systemStats?.history?.length) return;\n      if (this.systemChart) this.systemChart.destroy();\n      \n      const ctx = this.$refs.systemChart?.getContext('2d');\n      if (!ctx || typeof Chart === 'undefined') return;\n      \n      const history = this.systemStats.history;\n      const labels = history.map(h => new Date(h.timestamp).toLocaleTimeString('sv-SE'));\n      \n      this.systemChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [\n            {\n              label: 'CPU %',\n              data: history.map(h => h.cpuUsage),\n              borderColor: '#1BBFFF',\n              tension: 0.3,\n              fill: false\n            },\n            {\n              label: 'RAM %',\n              data: history.map(h => h.memoryUsed),\n              borderColor: '#4CAF50',\n              tension: 0.3,\n              fill: false\n            },\n            {\n              label: 'Temp ¬∞C',\n              data: history.map(h => h.cpuTemp),\n              borderColor: '#F44336',\n              tension: 0.3,\n              fill: false,\n              yAxisID: 'y1'\n            }\n          ]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            y: { min: 0, max: 100, grid: { color: 'rgba(255,255,255,0.1)' } },\n            y1: { position: 'right', min: 0, max: 100, grid: { display: false } },\n            x: { grid: { color: 'rgba(255,255,255,0.1)' } }\n          }\n        }\n      });\n    },\n    \n    async loadTemperatureDevices() {\n      try {\n        const res = await fetch('/api/stats/temperatures');\n        const data = await res.json();\n        if (data.success) {\n          this.temperatureDevices = Object.keys(data.data).map(id => ({\n            title: id,\n            value: id\n          }));\n          if (this.temperatureDevices.length > 0) {\n            this.selectedDevice = this.temperatureDevices[0].value;\n          }\n        }\n      } catch (e) { console.error(e); }\n    },\n    \n    async refreshTemperatures() {\n      if (!this.selectedDevice) return;\n      this.tempLoading = true;\n      try {\n        const res = await fetch(`/api/stats/temperatures?device=${this.selectedDevice}&range=${this.tempRange}`);\n        const data = await res.json();\n        if (data.success) {\n          this.tempStats = data.data;\n          this.$nextTick(() => this.renderTempChart());\n        }\n      } catch (e) { console.error(e); }\n      this.tempLoading = false;\n    },\n    \n    renderTempChart() {\n      if (!this.tempStats?.data?.length) return;\n      if (this.tempChart) this.tempChart.destroy();\n      \n      const ctx = this.$refs.tempChart?.getContext('2d');\n      if (!ctx || typeof Chart === 'undefined') return;\n      \n      const data = this.tempStats.data;\n      const labels = data.map(d => new Date(d.timestamp).toLocaleTimeString('sv-SE'));\n      \n      const datasets = (this.tempStats.series || []).map(s => ({\n        label: s.name,\n        data: data.map(d => d[s.key]),\n        borderColor: s.color,\n        tension: 0.3,\n        fill: false\n      })).filter(ds => ds.data.some(v => v !== undefined));\n      \n      this.tempChart = new Chart(ctx, {\n        type: 'line',\n        data: { labels, datasets },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            y: { grid: { color: 'rgba(255,255,255,0.1)' } },\n            x: { grid: { color: 'rgba(255,255,255,0.1)' } }\n          }\n        }\n      });\n    },\n    \n    async refreshModbusStats() {\n      this.modbusLoading = true;\n      try {\n        const [statsRes, devicesRes] = await Promise.all([\n          fetch('/api/stats/modbus'),\n          fetch('/api/stats/modbus/problematic?limit=5')\n        ]);\n        \n        const statsData = await statsRes.json();\n        const devicesData = await devicesRes.json();\n        \n        if (statsData.success) {\n          this.modbusStats = statsData.data;\n          this.$nextTick(() => this.renderModbusChart());\n        }\n        if (devicesData.success) {\n          this.problematicDevices = devicesData.data;\n        }\n      } catch (e) { console.error(e); }\n      this.modbusLoading = false;\n    },\n    \n    renderModbusChart() {\n      if (!this.modbusStats?.errorsPerHour?.length) return;\n      if (this.modbusChart) this.modbusChart.destroy();\n      \n      const ctx = this.$refs.modbusChart?.getContext('2d');\n      if (!ctx || typeof Chart === 'undefined') return;\n      \n      const data = this.modbusStats.errorsPerHour.slice(-24);\n      const labels = data.map(d => d.hour.split('T')[1] || d.hour);\n      \n      this.modbusChart = new Chart(ctx, {\n        type: 'bar',\n        data: {\n          labels,\n          datasets: [{\n            label: 'Fel',\n            data: data.map(d => d.count),\n            backgroundColor: '#F44336'\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } },\n            x: { grid: { display: false } }\n          }\n        }\n      });\n    },\n    \n    async resetModbusStats() {\n      if (!confirm('Nollst√§lla all Modbus-statistik?')) return;\n      try {\n        await fetch('/api/stats/modbus/reset', { method: 'POST' });\n        this.refreshModbusStats();\n      } catch (e) { console.error(e); }\n    },\n    \n    // Helpers\n    getCpuColor(usage) {\n      if (usage < 50) return 'success';\n      if (usage < 80) return 'warning';\n      return 'error';\n    },\n    \n    getDiskColor(usage) {\n      if (usage < 70) return 'success';\n      if (usage < 90) return 'warning';\n      return 'error';\n    },\n    \n    getTempColor(temp) {\n      if (!temp) return 'grey';\n      if (temp < 50) return 'success';\n      if (temp < 70) return 'warning';\n      return 'error';\n    },\n    \n    getTempClass(temp) {\n      if (!temp) return '';\n      if (temp < 50) return 'text-success';\n      if (temp < 70) return 'text-warning';\n      return 'text-error';\n    },\n    \n    getHealthColor(score) {\n      if (score >= 90) return 'success';\n      if (score >= 70) return 'warning';\n      return 'error';\n    },\n    \n    getHealthClass(score) {\n      if (score >= 90) return 'health-good';\n      if (score >= 70) return 'health-warn';\n      return 'health-bad';\n    },\n    \n    getTempLabel(key) {\n      const labels = {\n        roomTemp: 'Rumstemp',\n        returnTemp: 'Returtemp',\n        hotGasTemp: 'Hetgas',\n        suctionTemp: 'Sugtemp'\n      };\n      return labels[key] || key;\n    },\n    \n    formatBytes(bytes) {\n      if (!bytes) return '0 B';\n      const k = 1024;\n      const sizes = ['B', 'KB', 'MB', 'GB'];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n    },\n    \n    formatDateTime(ts) {\n      if (!ts) return '-';\n      return new Date(ts).toLocaleString('sv-SE');\n    }\n  }\n}\n</script>\n\n<style scoped>\n.stats-module {\n  padding: 16px;\n  font-family: 'Montserrat', sans-serif;\n}\n\n.tab-content {\n  padding: 20px 0;\n}\n\n.stat-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border-radius: 12px;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n}\n\n.stat-value {\n  font-size: 32px;\n  font-weight: 700;\n  color: #1BBFFF;\n  margin-bottom: 8px;\n}\n\n.stat-info {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.6);\n  margin-top: 8px;\n}\n\n.chart-container {\n  height: 300px;\n  position: relative;\n}\n\n.chart-container-small {\n  height: 200px;\n  position: relative;\n}\n\n.chart-legend {\n  display: flex;\n  gap: 16px;\n  margin-top: 12px;\n  flex-wrap: wrap;\n}\n\n.legend-item {\n  display: flex;\n  align-items: center;\n  font-size: 12px;\n}\n\n.legend-color {\n  width: 12px;\n  height: 12px;\n  border-radius: 2px;\n  margin-right: 6px;\n}\n\n.network-iface {\n  padding: 8px 0;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.network-iface:last-child {\n  border-bottom: none;\n}\n\n.network-stats {\n  display: flex;\n  gap: 16px;\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.7);\n}\n\n.temp-card {\n  background: rgba(0, 20, 40, 0.7) !important;\n  border-radius: 12px;\n  border: 1px solid rgba(27, 191, 255, 0.3);\n}\n\n.temp-label {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.6);\n  margin-bottom: 4px;\n}\n\n.temp-current {\n  font-size: 28px;\n  font-weight: 700;\n  color: #1BBFFF;\n}\n\n.temp-range {\n  font-size: 11px;\n  margin-top: 8px;\n}\n\n.temp-range .min { color: #2196F3; }\n.temp-range .max { color: #F44336; margin-left: 12px; }\n\n.temp-avg {\n  font-size: 11px;\n  color: rgba(255, 255, 255, 0.5);\n  margin-top: 4px;\n}\n\n.health-card {\n  padding: 20px;\n}\n\n.health-score {\n  font-size: 64px;\n  font-weight: 800;\n  line-height: 1;\n}\n\n.health-score.health-good { color: #4CAF50; }\n.health-score.health-warn { color: #FFC107; }\n.health-score.health-bad { color: #F44336; }\n\n.health-label {\n  font-size: 14px;\n  color: rgba(255, 255, 255, 0.7);\n  margin: 12px 0;\n}\n\n.error-count {\n  font-size: 28px;\n  font-weight: 700;\n  color: #F44336;\n}\n\n.error-label {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.6);\n}\n\n.big-stat {\n  font-size: 36px;\n  font-weight: 700;\n  color: #1BBFFF;\n}\n\n.stat-label {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.6);\n  margin-top: 4px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 300,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "alarms-stats-chartjs",
        "type": "ui-template",
        "z": "alarms-stats-flow",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "Chart.js Loader",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:head",
        "className": "",
        "x": 300,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "sidebar-update-alarms-stats",
        "type": "ui-template",
        "z": "alarms-stats-flow",
        "group": "",
        "page": "",
        "ui": "45086322eb4ebcac",
        "name": "Sidebar Update - Alarms & Stats",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<script>\n// Uppdatera sidebar f√∂r att inkludera Larm och Statistik\n(function() {\n  function updateSidebarForAlarmsStats() {\n    const drawer = document.querySelector('.v-navigation-drawer__content');\n    if (!drawer || !drawer.dataset.customSidebar) return;\n    \n    // Hitta befintliga larm/statistik-l√§nkar och uppdatera dem\n    const sidebar = drawer.querySelector('.custom-sidebar');\n    if (!sidebar) return;\n    \n    // Kolla om redan uppdaterad\n    if (sidebar.dataset.alarmsStatsUpdated) return;\n    sidebar.dataset.alarmsStatsUpdated = 'true';\n    \n    // Hitta statistik och larm items och l√§gg till onclick\n    const menuItems = sidebar.querySelectorAll('.sidebar-menu-item');\n    menuItems.forEach(item => {\n      if (item.textContent.includes('Statistik')) {\n        item.setAttribute('onclick', \"navigateTo('/statistics')\");\n      }\n      if (item.textContent.includes('Larm')) {\n        item.setAttribute('onclick', \"navigateTo('/alarms')\");\n      }\n    });\n  }\n  \n  // K√∂r efter sidebar injicerats\n  setInterval(updateSidebarForAlarmsStats, 2000);\n})();\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:head",
        "className": "",
        "x": 300,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "00451b66ce1402f4",
        "type": "function",
        "z": "alarms-stats-flow",
        "name": "Larm",
        "func": "// Enkel tidsst√§mpel som text\n// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'showAlarms';\nmsg.group = msg.group || 'Alarms';\n\n\nfunction ts(minutesAgo) {\n    const d = new Date(Date.now() - minutesAgo * 60 * 1000);\n    return d.toISOString();   // kan bytas till snyggare format i UI sen\n}\n\n// Bygg en lista med aktiva larm\nconst alarms = [\n    {\n        id: \"ALM-1\",\n        deviceId: \"akcc-03\",\n        deviceName: \"AK-CC55-03\",\n        location: \"Kylrum 3\",\n        type: \"L√•g superheat\",\n        code: \"LOW_SH\",\n        severity: \"warning\",          // warning | critical | info\n        message: \"√ñverhettning 2,8 K (b√∂r 5‚Äì7 K)\",\n        active: true,\n        timestamp: ts(2)\n    },\n    {\n        id: \"ALM-2\",\n        deviceId: \"akcc-04\",\n        deviceName: \"AK-CC55-04\",\n        location: \"Kylrum 4\",\n        type: \"L√•g superheat\",\n        code: \"LOW_SH\",\n        severity: \"warning\",\n        message: \"√ñverhettning 3,1 K (b√∂r 5‚Äì7 K)\",\n        active: true,\n        timestamp: ts(5)\n    },\n    {\n        id: \"ALM-3\",\n        deviceId: \"akcc-f02\",\n        deviceName: \"AK-CC55-F02\",\n        location: \"Frysrum 2\",\n        type: \"Regulator offline\",\n        code: \"OFFLINE\",\n        severity: \"critical\",\n        message: \"Ingen kommunikation med regulator (timeout)\",\n        active: true,\n        timestamp: ts(8)\n    },\n    {\n        id: \"ALM-4\",\n        deviceId: \"rack-1\",\n        deviceName: \"Rack 1\",\n        location: \"Maskinrum\",\n        type: \"S3 fel\",\n        code: \"S3_ERR\",\n        severity: \"critical\",\n        message: \"Kompressor S3 fel ‚Äì se detaljsida\",\n        active: true,\n        timestamp: ts(1)\n    },\n    {\n        id: \"ALM-5\",\n        deviceId: \"akcc-08\",\n        deviceName: \"AK-CC55-08\",\n        location: \"Kylrum 8\",\n        type: \"H√∂g temperatur\",\n        code: \"HIGH_TEMP\",\n        severity: \"warning\",\n        message: \"Produkt +9,1 ¬∞C (b√∂r +4,0 ¬∞C)\",\n        active: true,\n        timestamp: ts(12)\n    }\n];\n\n// Summera antal per niv√•\nconst summary = alarms.reduce((acc, a) => {\n    acc.total++;\n    if (a.severity === \"critical\") acc.critical++;\n    else if (a.severity === \"warning\") acc.warning++;\n    else acc.info++;\n    return acc;\n}, { total: 0, critical: 0, warning: 0, info: 0 });\n\n// Spara globalt s√• b√•de Larm-tab och Refboard kan l√§sa\nglobal.set(\"reflink.alarms.active\", alarms);\nglobal.set(\"reflink.alarms.summary\", summary);\n\n// Skicka ut listan om du vill mata en tabell direkt\nmsg.payload = alarms;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "inject1",
        "type": "inject",
        "z": "flowData",
        "name": "Fake freq maskin 1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "updateMachine",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Machines",
                "vt": "str"
            }
        ],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "func1"
            ]
        ]
    },
    {
        "id": "inject2",
        "type": "inject",
        "z": "flowData",
        "name": "Fake freq maskin 2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "updateMachine",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Machines",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": true,
        "onceDelay": 0.2,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "func2"
            ]
        ]
    },
    {
        "id": "inject3",
        "type": "inject",
        "z": "flowData",
        "name": "Fake freq maskin 3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "updateMachine",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Machines",
                "vt": "str"
            }
        ],
        "repeat": "4",
        "crontab": "",
        "once": true,
        "onceDelay": 0.3,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 180,
        "wires": [
            [
                "func3"
            ]
        ]
    },
    {
        "id": "func1",
        "type": "function",
        "z": "flowData",
        "name": "Bygg frekvens maskin 1 (0‚Äì100%)",
        "func": "// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'showMachines';\nmsg.group = msg.group || 'Machines';\n\nmsg.topic = \"maskin/1/frekvens\";\n// Maskin 1: typiskt 30‚Äì90%\nconst min = 54;\nconst max = 59;\nmsg.payload = min + Math.round(Math.random() * (max - min));\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 60,
        "wires": [
            [
                "linkout1",
                "3e6ffefb313607b4"
            ]
        ]
    },
    {
        "id": "func2",
        "type": "function",
        "z": "flowData",
        "name": "Bygg frekvens maskin 2 (0‚Äì100%)",
        "func": "// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'showMachines';\nmsg.group = msg.group || 'Machines';\n\nmsg.topic = \"maskin/2/frekvens\";\n// Maskin 2: typiskt 10‚Äì70%\nconst min = 50;\nconst max = 56;\nmsg.payload = min + Math.round(Math.random() * (max - min));\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 120,
        "wires": [
            [
                "linkout1",
                "6fe023fb37a76779"
            ]
        ]
    },
    {
        "id": "func3",
        "type": "function",
        "z": "flowData",
        "name": "Bygg frekvens maskin 3 (0‚Äì100%)",
        "func": "// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'showMachines';\nmsg.group = msg.group || 'Machines';\n\nmsg.topic = \"maskin/3/frekvens\";\n// Maskin 3: typiskt 50‚Äì100%\nconst min = 30;\nconst max = 34;\nmsg.payload = min + Math.round(Math.random() * (max - min));\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 180,
        "wires": [
            [
                "linkout1",
                "a18292ede54ae0e6"
            ]
        ]
    },
    {
        "id": "linkout1",
        "type": "link out",
        "z": "flowData",
        "name": "DATA: MASKINER",
        "mode": "link",
        "links": [
            "linkin1"
        ],
        "x": 775,
        "y": 100,
        "wires": []
    },
    {
        "id": "3e6ffefb313607b4",
        "type": "ui-gauge",
        "z": "flowData",
        "name": "KS-1",
        "group": "6ffbe88688135362",
        "order": 1,
        "value": "payload",
        "valueType": "msg",
        "width": 3,
        "height": "4",
        "gtype": "gauge-34",
        "gstyle": "rounded",
        "title": "Ks-1",
        "alwaysShowTitle": false,
        "floatingTitlePosition": "top-left",
        "units": "Hz",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#0058bb",
                "text": "70",
                "textType": "str"
            }
        ],
        "min": 0,
        "max": "70",
        "sizeThickness": "6",
        "sizeGap": "6",
        "sizeKeyThickness": "1",
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 710,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "6fe023fb37a76779",
        "type": "ui-gauge",
        "z": "flowData",
        "name": "KS-2",
        "group": "6ffbe88688135362",
        "order": 2,
        "value": "payload",
        "valueType": "msg",
        "width": 3,
        "height": "4",
        "gtype": "gauge-34",
        "gstyle": "rounded",
        "title": "Ks-2",
        "alwaysShowTitle": false,
        "floatingTitlePosition": "top-left",
        "units": "Hz",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#0058bb",
                "text": "70",
                "textType": "str"
            }
        ],
        "min": 0,
        "max": "70",
        "sizeThickness": "6",
        "sizeGap": "6",
        "sizeKeyThickness": "1",
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 710,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "a18292ede54ae0e6",
        "type": "ui-gauge",
        "z": "flowData",
        "name": "",
        "group": "6ffbe88688135362",
        "order": 3,
        "value": "payload",
        "valueType": "msg",
        "width": 3,
        "height": "4",
        "gtype": "gauge-34",
        "gstyle": "rounded",
        "title": "Ks-3",
        "alwaysShowTitle": false,
        "floatingTitlePosition": "top-left",
        "units": "Hz",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#0058bb",
                "text": "",
                "textType": "label"
            }
        ],
        "min": 0,
        "max": "70",
        "sizeThickness": "6",
        "sizeGap": "6",
        "sizeKeyThickness": "1",
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 710,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "linkin1",
        "type": "link in",
        "z": "flowUI",
        "name": "DATA: MASKINER",
        "links": [
            "linkout1"
        ],
        "x": 150,
        "y": 80,
        "wires": [
            [
                "debug1"
            ]
        ]
    },
    {
        "id": "debug1",
        "type": "debug",
        "z": "flowUI",
        "name": "Maskin-v√§rden (topic + payload)",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "topic & payload",
        "statusType": "auto",
        "x": 420,
        "y": 80,
        "wires": []
    },
    {
        "id": "6207f84beee3e7ca",
        "type": "link in",
        "z": "08a59fbc9776a2b2",
        "name": "link in 2",
        "links": [
            "9e784102384b3076"
        ],
        "x": 145,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "injAddDevice",
        "type": "inject",
        "z": "cfgFlow",
        "name": "Fake UI ‚Äì l√§gg till enhet",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "addItem",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Data",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"category\":\"Kylrum\",\"name\":\"Kylrum 1\",\"brand\":\"Danfoss\",\"model\":\"AK-CC55\",\"address\":5}",
        "payloadType": "json",
        "x": 190,
        "y": 100,
        "wires": [
            [
                "fnAddDevice"
            ]
        ]
    },
    {
        "id": "fnAddDevice",
        "type": "function",
        "z": "cfgFlow",
        "name": "L√§gg till enhet i global.enheter",
        "func": "// F√∂rv√§ntar sig msg.payload som t.ex.:\n// {\n//   category: \"Kylrum\",\n//   name: \"Kylrum 1\",\n//   brand: \"Danfoss\",\n//   model: \"AK-CC55\",\n//   address: 5\n// }\n\n// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'addItem';\nmsg.group = msg.group || 'Data';\n\n\nconst input = msg.payload || {};\n\n// H√§mta l√∂pnummer f√∂r ID\nlet nextId = global.get('rl_nextNodeId') || 1;\nconst id = `node-${String(nextId).padStart(3, '0')}`;\nnextId += 1;\nglobal.set('rl_nextNodeId', nextId);\n\n// Mappa category ‚Üí intern type\nlet type;\nswitch (input.category) {\n    case 'Kylsk√•p':\n    case 'Fryssk√•p':\n    case 'Kylrum':\n    case 'Frysrum':\n        type = 'Controller';\n        break;\n    case 'Aggregat':\n        type = 'Aggregat';\n        break;\n    case 'Gaslarm':\n        type = 'Gaslarm';\n        break;\n    default:\n        type = 'Misc';\n}\n\n// Bygg enhetsobjektet\nconst device = {\n    id,\n    category: input.category || 'Ok√§nd',\n    name: input.name || `Enhet ${id}`,\n    brand: input.brand || 'Unknown',\n    model: input.model || 'Unknown',\n    type,\n    address: Number(input.address) || 0,\n    status: 'inactive',       // blir 'active' n√§r Modbus f√•r svar\n    lastSeen: null\n};\n\n// H√§mta befintlig lista\nlet devices = global.get('enheter') || [];\n\n// L√§gg till\ndevices.push(device);\n\n// Spara tillbaka\nglobal.set('enheter', devices);\n\n// Skicka ut f√∂r debug/vidare fl√∂den\nmsg.payload = {\n    added: device,\n    allDevices: devices\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 100,
        "wires": [
            [
                "dbgDevices",
                "fn-after-add"
            ]
        ]
    },
    {
        "id": "dbgDevices",
        "type": "debug",
        "z": "cfgFlow",
        "name": "Alla enheter (global.enheter)",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload.added.name",
        "statusType": "msg",
        "x": 770,
        "y": 100,
        "wires": []
    },
    {
        "id": "fnGetNodes",
        "type": "function",
        "z": "cfgFlow",
        "name": "H√§mta alla noder (GetNodes)",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// H√ÑMTA ALLA NODER - Reflink Message Standard\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showNodes';\nmsg.group = msg.group || 'Nodes';\n\nconst nodes = global.get('enheter') || [];\n\n// Formatera f√∂r tabellen\nconst formattedNodes = nodes.map(node => ({\n    ...node,\n    lastSeenFormatted: node.lastSeen \n        ? new Date(node.lastSeen).toLocaleString('sv-SE')\n        : '‚Äì'\n}));\n\nmsg.nodes = formattedNodes;\nmsg.payload = formattedNodes;\nmsg.nodeCount = nodes.length;\n\nnode.status({ fill: 'green', shape: 'dot', text: `${nodes.length} noder` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 200,
        "wires": [
            [
                "dbgNodes",
                "ui-table-nodelist"
            ]
        ]
    },
    {
        "id": "dbgNodes",
        "type": "debug",
        "z": "cfgFlow",
        "name": "Debug: Nodlista",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "nodeCount",
        "statusType": "msg",
        "x": 720,
        "y": 160,
        "wires": []
    },
    {
        "id": "injGetNodes",
        "type": "inject",
        "z": "cfgFlow",
        "name": "Test: H√§mta alla noder",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "showNodes",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Nodes",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 230,
        "y": 200,
        "wires": [
            [
                "fnGetNodes"
            ]
        ]
    },
    {
        "id": "ui-template-addnode-form",
        "type": "ui-template",
        "z": "cfgFlow",
        "group": "config-group-addnode",
        "name": "Formul√§r: L√§gg till nod",
        "order": 1,
        "width": "6",
        "height": "10",
        "head": "",
        "format": "<template>\n  <v-card class=\"pa-4\" elevation=\"0\">\n    <v-form ref=\"form\" @submit.prevent=\"submitNode\">\n      \n      <v-select\n        v-model=\"formData.category\"\n        :items=\"categories\"\n        label=\"Kategori\"\n        variant=\"outlined\"\n        density=\"comfortable\"\n        class=\"mb-3\"\n        :rules=\"[v => !!v || 'Kategori kr√§vs']\"\n      ></v-select>\n      \n      <v-text-field\n        v-model=\"formData.name\"\n        label=\"Namn\"\n        variant=\"outlined\"\n        density=\"comfortable\"\n        class=\"mb-3\"\n        placeholder=\"t.ex. Kylrum 1\"\n        :rules=\"[v => !!v || 'Namn kr√§vs']\"\n      ></v-text-field>\n      \n      <v-select\n        v-model=\"formData.brand\"\n        :items=\"brands\"\n        label=\"Fabrikat\"\n        variant=\"outlined\"\n        density=\"comfortable\"\n        class=\"mb-3\"\n        :rules=\"[v => !!v || 'Fabrikat kr√§vs']\"\n      ></v-select>\n      \n      <v-combobox\n        v-model=\"formData.model\"\n        :items=\"models\"\n        label=\"Modell\"\n        variant=\"outlined\"\n        density=\"comfortable\"\n        class=\"mb-3\"\n        placeholder=\"V√§lj eller skriv in\"\n        :rules=\"[v => !!v || 'Modell kr√§vs']\"\n      ></v-combobox>\n      \n      <v-text-field\n        v-model.number=\"formData.address\"\n        label=\"Modbus-adress\"\n        variant=\"outlined\"\n        density=\"comfortable\"\n        type=\"number\"\n        min=\"1\"\n        max=\"247\"\n        class=\"mb-4\"\n        :rules=\"[\n          v => !!v || 'Adress kr√§vs',\n          v => (v >= 1 && v <= 247) || 'Adress: 1-247'\n        ]\"\n      ></v-text-field>\n      \n      <v-btn\n        type=\"submit\"\n        color=\"primary\"\n        size=\"large\"\n        block\n        :loading=\"loading\"\n      >\n        <v-icon left class=\"mr-2\">mdi-plus</v-icon>\n        L√§gg till nod\n      </v-btn>\n      \n      <v-alert\n        v-if=\"feedback.show\"\n        :type=\"feedback.type\"\n        class=\"mt-4\"\n        closable\n        @click:close=\"feedback.show = false\"\n      >\n        {{ feedback.message }}\n      </v-alert>\n      \n    </v-form>\n  </v-card>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      formData: {\n        category: null,\n        name: '',\n        brand: null,\n        model: null,\n        address: null\n      },\n      categories: ['Kylsk√•p', 'Fryssk√•p', 'Kylrum', 'Frysrum', 'Aggregat', 'Gaslarm', 'Annat'],\n      brands: ['Danfoss', 'Carel', 'Misc', 'Annat'],\n      models: ['AK-CC55', 'AK-CC 210', 'AK-PC 772', 'AK-SM 800', 'pCO5', 'IR33', 'Custom'],\n      loading: false,\n      feedback: { show: false, type: 'success', message: '' }\n    }\n  },\n  methods: {\n    async submitNode() {\n      const { valid } = await this.$refs.form.validate()\n      if (!valid) return\n      \n      this.loading = true\n      \n      this.send({\n        payload: {\n          category: this.formData.category,\n          name: this.formData.name,\n          brand: this.formData.brand,\n          model: this.formData.model,\n          address: this.formData.address\n        },\n        topic: 'node/add'\n      })\n    },\n    resetForm() {\n      this.formData = { category: null, name: '', brand: null, model: null, address: null }\n      this.$refs.form.resetValidation()\n    }\n  },\n  watch: {\n    msg(newMsg) {\n      if (newMsg && newMsg.topic === 'node/added') {\n        this.feedback = { show: true, type: 'success', message: 'Nod \"' + newMsg.payload.added.name + '\" tillagd!' }\n        this.resetForm()\n        this.loading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.v-card { background: transparent !important; }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 270,
        "y": 340,
        "wires": [
            [
                "fnAddDevice"
            ]
        ]
    },
    {
        "id": "fn-after-add",
        "type": "function",
        "z": "cfgFlow",
        "name": "Efter till√§gg",
        "func": "// Skicka bekr√§ftelse till formul√§ret\n// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'processData';\nmsg.group = msg.group || 'Data';\n\n\nconst confirmMsg = {\n    payload: msg.payload,\n    topic: 'node/added'\n};\n\n// Skicka uppdaterad lista till tabellen\nconst tableMsg = {\n    payload: msg.payload.allDevices || []\n};\n\nreturn [confirmMsg, tableMsg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 340,
        "wires": [
            [
                "ui-template-addnode-form"
            ],
            [
                "ui-table-nodelist"
            ]
        ]
    },
    {
        "id": "ui-table-nodelist",
        "type": "ui-table",
        "z": "cfgFlow",
        "group": "config-group-nodelist",
        "name": "Tabell: Nodlista",
        "label": "",
        "order": 2,
        "width": "12",
        "height": "8",
        "maxrows": 50,
        "passthru": false,
        "autocols": false,
        "showSearch": true,
        "deselect": true,
        "selectionType": "click",
        "columns": [
            {
                "title": "ID",
                "key": "id",
                "keyType": "key",
                "type": "text",
                "width": "90px",
                "align": "start"
            },
            {
                "title": "Namn",
                "key": "name",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Kategori",
                "key": "category",
                "keyType": "key",
                "type": "text",
                "width": "100px",
                "align": "start"
            },
            {
                "title": "Fabrikat",
                "key": "brand",
                "keyType": "key",
                "type": "text",
                "width": "100px",
                "align": "start"
            },
            {
                "title": "Modell",
                "key": "model",
                "keyType": "key",
                "type": "text",
                "width": "110px",
                "align": "start"
            },
            {
                "title": "Adr",
                "key": "address",
                "keyType": "key",
                "type": "text",
                "width": "60px",
                "align": "center"
            },
            {
                "title": "Status",
                "key": "status",
                "keyType": "key",
                "type": "text",
                "width": "90px",
                "align": "center"
            },
            {
                "title": "Senast sedd",
                "key": "lastSeenFormatted",
                "keyType": "key",
                "type": "text",
                "width": "140px",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 720,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "ui-btn-refresh",
        "type": "ui-button",
        "z": "cfgFlow",
        "group": "config-group-nodelist",
        "name": "Uppdatera lista",
        "label": "Uppdatera lista",
        "order": 1,
        "width": "3",
        "height": "1",
        "tooltip": "H√§mta senaste nodlistan",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "mdi-refresh",
        "iconPosition": "left",
        "payload": "{}",
        "payloadType": "json",
        "topic": "refresh",
        "textColor": "",
        "iconColor": "",
        "x": 240,
        "y": 440,
        "wires": [
            [
                "fnGetNodes"
            ]
        ]
    },
    {
        "id": "comment-config-header",
        "type": "comment",
        "z": "cfgFlow",
        "name": "=== CONFIG NODER - Reflink ===",
        "info": "Formul√§r -> fnAddDevice -> fn-after-add -> Tabell + Bekr√§ftelse\nUppdatera-knapp -> fnGetNodes -> Tabell",
        "x": 270,
        "y": 40,
        "wires": []
    },
    {
        "id": "config-page-style",
        "type": "ui-template",
        "z": "cfgFlow",
        "group": "",
        "page": "",
        "ui": "",
        "name": "Konfiguration - Bakgrund & Style",
        "order": 3,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "\nbody {\n  background:\n    radial-gradient(circle at top left, rgba(27,191,255,0.15), transparent 50%),\n    radial-gradient(circle at bottom right, rgba(0,153,204,0.15), transparent 50%),\n    linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;\n  background-size: cover !important;\n  background-attachment: fixed !important;\n}\n\n\n.body {\n  background: url('/scan-bg9.png') no-repeat center center fixed !important;\n  background-size: cover !important;\n}\n\n\n/* KORT / GRUPPER */\n.v-card {\n  background: rgba(255, 255, 255, 0.08) !important;\n  border-radius: 16px !important;\n  border: 1px solid rgba(27, 191, 255, 0.3) !important;\n  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4) !important;\n  backdrop-filter: blur(10px);\n}\n\n/* Grupprubriker */\n.nrdb-ui-group-title {\n  font-weight: 700;\n  letter-spacing: 0.05em;\n  text-transform: uppercase;\n  font-size: 14px;\n  color: #1BBFFF !important;\n}\n\n/* Tabellheader */\n.v-data-table-header {\n  background: rgba(27, 191, 255, 0.15) !important;\n}\n\n.v-data-table-header th {\n  color: #1BBFFF !important;\n  font-weight: 600 !important;\n}\n\n/* Tabellrader */\n.v-data-table tbody tr {\n  background: rgba(255, 255, 255, 0.02) !important;\n}\n\n.v-data-table tbody tr:hover {\n  background: rgba(27, 191, 255, 0.1) !important;\n}\n\n.v-data-table td {\n  color: #E5E7EB !important;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;\n}\n\n/* Knappar */\n.v-btn {\n  background: linear-gradient(135deg, #1BBFFF 0%, #0099cc 100%) !important;\n  color: white !important;\n  font-weight: 600 !important;\n}\n\n/* Formul√§rf√§lt */\n.v-field {\n  background: rgba(255, 255, 255, 0.05) !important;\n  border-radius: 8px !important;\n}\n\n.v-field__outline {\n  border-color: rgba(27, 191, 255, 0.3) !important;\n}\n\n.v-field-label {\n  color: #9CA3AF !important;\n}\n\n.v-field input,\n.v-field .v-select__selection-text {\n  color: #F9FAFB !important;\n}\n\n/* Dropdown-menyer */\n.v-list {\n  background: #1e293b !important;\n}\n\n.v-list-item {\n  color: #E5E7EB !important;\n}\n\n.v-list-item:hover {\n  background: rgba(27, 191, 255, 0.15) !important;\n}\n\n/* S√∂kf√§lt i tabell */\n.v-text-field input {\n  color: #F9FAFB !important;\n}\n\n/* Alert/Feedback */\n.v-alert {\n  border-radius: 8px !important;\n}\n",
        "storeOutMessages": false,
        "passthru": false,
        "resendOnRefresh": false,
        "templateScope": "page:style",
        "className": "config-config",
        "x": 290,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "inject-startup-load",
        "type": "inject",
        "z": "cfgFlow",
        "name": "‚ö° Startup: Ladda testdata",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "initTestData",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "System",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "2",
        "topic": "startup",
        "payload": "{}",
        "payloadType": "json",
        "x": 250,
        "y": 280,
        "wires": [
            [
                "fn-init-testdata"
            ]
        ]
    },
    {
        "id": "fn-init-testdata",
        "type": "function",
        "z": "cfgFlow",
        "name": "Initiera testdata",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// INITIERA TESTDATA - Reflink Message Standard\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'initTestData';\nmsg.group = msg.group || 'System';\n\nconst existing = global.get('enheter') || [];\n\nif (existing.length === 0) {\n    const testData = [\n        { id: \"node-001\", category: \"Kylrum\", name: \"Kylrum 1\", brand: \"Danfoss\", model: \"AK-CC55\", type: \"Controller\", address: 1, status: \"inactive\", lastSeen: null },\n        { id: \"node-002\", category: \"Kylrum\", name: \"Kylrum 2\", brand: \"Danfoss\", model: \"AK-CC55\", type: \"Controller\", address: 2, status: \"inactive\", lastSeen: null },\n        { id: \"node-003\", category: \"Frysrum\", name: \"Frysrum 1\", brand: \"Danfoss\", model: \"AK-CC 210\", type: \"Controller\", address: 3, status: \"inactive\", lastSeen: null },\n        { id: \"node-004\", category: \"Aggregat\", name: \"Kylmaskin 1\", brand: \"Danfoss\", model: \"AK-PC 772\", type: \"Aggregat\", address: 10, status: \"inactive\", lastSeen: null },\n        { id: \"node-005\", category: \"Gaslarm\", name: \"Gaslarm Maskinrum\", brand: \"Misc\", model: \"Custom\", type: \"Gaslarm\", address: 20, status: \"inactive\", lastSeen: null }\n    ];\n    \n    global.set('enheter', testData);\n    global.set('rl_nextNodeId', 6);\n    \n    node.warn('Initierade 5 testnoder i global.enheter');\n    msg.payload = testData;\n    msg.nodes = testData;\n} else {\n    node.warn('Data finns redan: ' + existing.length + ' noder');\n    msg.payload = existing;\n    msg.nodes = existing;\n}\n\nnode.status({ fill: 'green', shape: 'dot', text: `${msg.nodes.length} noder` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 280,
        "wires": [
            [
                "fnGetNodes"
            ]
        ]
    },
    {
        "id": "ce0f09c4c6053417",
        "type": "inject",
        "z": "55bd7b226cdae49a",
        "name": "L√§gg till nod",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "showNodes",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Nodes",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"category\":\"Kylrum\",\"name\":\"Kylrum 1\",\"brand\":\"Danfoss\",\"model\":\"AK-CC55\",\"address\":5}",
        "payloadType": "json",
        "x": 170,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "de8c9ce8c39ed830",
        "type": "debug",
        "z": "55bd7b226cdae49a",
        "name": "Senast tillagd nod",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload.added",
        "targetType": "msg",
        "statusVal": "payload.added.name",
        "statusType": "msg",
        "x": 780,
        "y": 80,
        "wires": []
    },
    {
        "id": "83bcb2c2dd88df51",
        "type": "inject",
        "z": "55bd7b226cdae49a",
        "name": "Visa alla noder",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "showNodes",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Nodes",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 160,
        "wires": [
            [
                "f34998d3c35cb1bc"
            ]
        ]
    },
    {
        "id": "f34998d3c35cb1bc",
        "type": "function",
        "z": "55bd7b226cdae49a",
        "name": "H√§mta global.enheter",
        "func": "// H√§mta alla noder fr√•n global context\n// üõ°Ô∏è SAFE HEADER - Reflink Message Standard\nmsg.action = msg.action || 'getData';\nmsg.group = msg.group || 'Data';\n\n\nconst nodes = global.get('enheter') || [];\n\nmsg.payload = nodes;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 160,
        "wires": [
            [
                "b54b35eb3aa93cb0"
            ]
        ]
    },
    {
        "id": "b54b35eb3aa93cb0",
        "type": "debug",
        "z": "55bd7b226cdae49a",
        "name": "Alla noder (global.enheter)",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload.length",
        "statusType": "msg",
        "x": 810,
        "y": 160,
        "wires": []
    },
    {
        "id": "inj-fake-controllers",
        "type": "inject",
        "z": "tab-reflink-test",
        "name": "Fake controllers var 5:e sekund",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "showControllers",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Controllers",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 1,
        "topic": "",
        "x": 200,
        "y": 120,
        "wires": [
            [
                "fn-build-fake-controllers"
            ]
        ]
    },
    {
        "id": "fn-build-fake-controllers",
        "type": "function",
        "z": "tab-reflink-test",
        "name": "Bygg msg.controllers (fake)",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// BYGG MSG.CONTROLLERS - Reflink Message Standard\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showControllers';\nmsg.group = msg.group || 'Controllers';\n\n// F√∂rs√∂k ladda fr√•n global context f√∂rst\nconst reflink = global.get('reflink') || {};\nlet controllers = reflink.regulators || [];\n\n// Om inga controllers finns, skapa fake data\nif (controllers.length === 0) {\n    controllers = [\n      {\n        id: \"CC-001\",\n        namn: \"Kylrum Livsmedel 1\",\n        typ: \"AK-CC 501\",\n        live: {\n          temp: -3.2,\n          status: \"Running\",\n          setpoint: 2,\n          defrostInterval: 180,\n          fanMode: 0\n        }\n      },\n      {\n        id: \"CC-002\",\n        namn: \"Kylrum Livsmedel 2\",\n        typ: \"AK-CC 501\",\n        live: {\n          temp: -1.8,\n          status: \"Running\",\n          setpoint: 3,\n          defrostInterval: 240,\n          fanMode: 1\n        }\n      },\n      {\n        id: \"FC-101\",\n        namn: \"Frysrum M√•ltidsservice\",\n        typ: \"AK-CC 550\",\n        live: {\n          temp: -22.4,\n          status: \"Alarm\",\n          setpoint: -20,\n          defrostInterval: 360,\n          fanMode: 0\n        }\n      }\n    ];\n}\n\nmsg.controllers = controllers;\nmsg.payload = controllers;\n\nnode.status({ fill: 'green', shape: 'dot', text: `${controllers.length} controllers` });\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 120,
        "wires": [
            [
                "ui-tpl-controllers",
                "dbg-controllers"
            ]
        ]
    },
    {
        "id": "dbg-controllers",
        "type": "debug",
        "z": "tab-reflink-test",
        "name": "controllers ut (f√∂r listan)",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "controllers",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 80,
        "wires": []
    },
    {
        "id": "ui-tpl-controllers",
        "type": "ui_template",
        "z": "tab-reflink-test",
        "group": "ui-group-controllers",
        "name": "Kontrollrum ‚Äì Controllers lista + popup",
        "order": 1,
        "width": 12,
        "height": 8,
        "format": "<div class=\"ctrl-list\">\n  <!-- LISTA MED CONTROLLERS -->\n  <div class=\"ctrl-row\"\n       v-for=\"c in msg.controllers\"\n       :key=\"c.id\"\n       @click=\"openQuick(c)\">\n       \n    <div class=\"ctrl-main\">\n      <div class=\"ctrl-name\">{{ c.namn || c.id }}</div>\n      <div class=\"ctrl-sub\">\n        {{ c.typ }} ‚Ä¢ \n        <span v-if=\"c.live && c.live.temp !== undefined\">\n          {{ c.live.temp }} ¬∞C\n        </span>\n        <span v-else>- ¬∞C</span>\n        ‚Ä¢ {{ (c.live && c.live.status) ? c.live.status : 'Ok√§nd' }}\n      </div>\n    </div>\n\n    <!-- TRE PRICKAR = AVANCERAT -->\n    <button class=\"ctrl-more\" @click.stop=\"openAdvanced(c)\">\n      &#8226;&#8226;&#8226;\n    </button>\n  </div>\n</div>\n\n<!-- SNABB-POPUP F√ñR PARAMETRAR -->\n<div class=\"quick-overlay\" v-if=\"showQuick\">\n  <div class=\"quick-dialog\">\n    <div class=\"qd-header\">\n      <div>\n        <div class=\"qd-title\">{{ quick.name }}</div>\n        <div class=\"qd-sub\">{{ quick.type }} ‚Ä¢ {{ quick.id }}</div>\n      </div>\n      <button class=\"qd-close\" @click=\"closeQuick\">‚úï</button>\n    </div>\n\n    <div class=\"qd-body\">\n      <!-- B√∂rv√§rde -->\n      <div class=\"qp-row\">\n        <label>B√∂rv√§rde</label>\n        <input type=\"number\"\n               v-model.number=\"quick.setpoint\" />\n        <span class=\"unit\">¬∞C</span>\n      </div>\n\n      <!-- Avfrostningsintervall -->\n      <div class=\"qp-row\">\n        <label>Avfrostningsintervall</label>\n        <input type=\"number\"\n               v-model.number=\"quick.defrostInterval\" />\n        <span class=\"unit\">min</span>\n      </div>\n\n      <!-- Fl√§ktl√§ge -->\n      <div class=\"qp-row\">\n        <label>Fl√§ktl√§ge</label>\n        <select v-model=\"quick.fanMode\">\n          <option :value=\"0\">Med kompressor</option>\n          <option :value=\"1\">Kontinuerlig</option>\n        </select>\n      </div>\n    </div>\n\n    <div class=\"qd-footer\">\n      <button class=\"btn-secondary\" @click=\"openAdvancedFromQuick\">\n        Alla parametrar‚Ä¶\n      </button>\n      <div class=\"qd-spacer\"></div>\n      <button class=\"btn-ghost\" @click=\"closeQuick\">Avbryt</button>\n      <button class=\"btn-primary\" @click=\"saveQuick\">Spara</button>\n    </div>\n  </div>\n</div>\n\n<script>\n  (function(scope) {\n    // Lokalt UI-state\n    scope.showQuick = false;\n    scope.quick = null;\n\n    // √ñppna snabb-popup (klick p√• rad)\n    scope.openQuick = function(c) {\n      scope.quick = {\n        id:   c.id,\n        name: c.namn || c.id,\n        type: c.typ,\n        // F√∂rifyll fr√•n live-data om det finns, annars standard\n        setpoint:         c.live && c.live.setpoint        !== undefined ? c.live.setpoint        : 2,\n        defrostInterval:  c.live && c.live.defrostInterval !== undefined ? c.live.defrostInterval : 180,\n        fanMode:          c.live && c.live.fanMode         !== undefined ? c.live.fanMode         : 0\n      };\n      scope.showQuick = true;\n      scope.$evalAsync(); // s√§kerst√§ll uppdatering\n    };\n\n    // St√§ng snabb-popup\n    scope.closeQuick = function() {\n      scope.showQuick = false;\n      scope.$evalAsync();\n    };\n\n    // Spara snabb-parametrar ‚Üí skicka till Node-RED\n    scope.saveQuick = function() {\n      if (!scope.quick) return;\n      scope.send({\n        topic: \"quick-save\",\n        payload: scope.quick\n      });\n      scope.showQuick = false;\n      scope.$evalAsync();\n    };\n\n    // Tre prickar p√• raden ‚Üí Avancerat\n    scope.openAdvanced = function(c) {\n      scope.send({\n        topic: \"advanced\",\n        payload: { id: c.id }\n      });\n    };\n\n    // ‚ÄúAlla parametrar‚Ä¶‚Äù inifr√•n popupen\n    scope.openAdvancedFromQuick = function() {\n      if (!scope.quick) return;\n      scope.send({\n        topic: \"advanced\",\n        payload: { id: scope.quick.id, from: \"quick-dialog\" }\n      });\n    };\n\n  })(scope);\n</script>\n\n<style>\n/* ===== LISTA ===== */\n.ctrl-list {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.ctrl-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 6px 10px;\n  border-radius: 10px;\n  cursor: pointer;\n  background: rgba(15,23,42,0.7);\n}\n.ctrl-row:hover {\n  background: rgba(15,23,42,0.9);\n}\n.ctrl-main {\n  display: flex;\n  flex-direction: column;\n}\n.ctrl-name {\n  font-weight: 600;\n}\n.ctrl-sub {\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.ctrl-more {\n  border: none;\n  background: transparent;\n  font-size: 1.2rem;\n  line-height: 1;\n  cursor: pointer;\n  padding: 2px 4px;\n  color: #e5e7eb;\n}\n\n/* ===== POPUP-OVERLAY ===== */\n.quick-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0,0,0,0.55);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n.quick-dialog {\n  background: #020617;\n  border-radius: 16px;\n  padding: 14px 16px 12px 16px;\n  min-width: 260px;\n  max-width: 360px;\n  box-shadow: 0 20px 40px rgba(0,0,0,0.6);\n  border: 1px solid rgba(148,163,184,0.4);\n}\n\n/* HEADER */\n.qd-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n.qd-title {\n  font-weight: 600;\n}\n.qd-sub {\n  font-size: 0.75rem;\n  opacity: 0.7;\n}\n.qd-close {\n  border: none;\n  background: transparent;\n  color: #9ca3af;\n  cursor: pointer;\n  font-size: 1rem;\n}\n\n/* BODY */\n.qd-body {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  margin-bottom: 10px;\n}\n.qp-row {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n.qp-row label {\n  flex: 0 0 120px;\n  font-size: 0.8rem;\n}\n.qp-row input,\n.qp-row select {\n  flex: 1 1 auto;\n  padding: 3px 6px;\n  border-radius: 6px;\n  border: 1px solid rgba(148,163,184,0.6);\n  background: #020617;\n  color: #e5e7eb;\n  font-size: 0.8rem;\n}\n.qp-row .unit {\n  flex: 0 0 30px;\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n\n/* FOOTER / KNAPPAR */\n.qd-footer {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-top: 4px;\n}\n.qd-spacer {\n  flex: 1 1 auto;\n}\n.btn-primary,\n.btn-ghost,\n.btn-secondary {\n  border-radius: 999px;\n  padding: 4px 12px;\n  font-size: 0.8rem;\n  border: 1px solid transparent;\n  cursor: pointer;\n}\n.btn-primary {\n  background: linear-gradient(135deg, #1bbfff, #0372a1);\n  color: #020617;\n  font-weight: 600;\n}\n.btn-primary:hover {\n  filter: brightness(1.1);\n}\n.btn-ghost {\n  background: transparent;\n  color: #e5e7eb;\n  border-color: rgba(148,163,184,0.5);\n}\n.btn-secondary {\n  background: transparent;\n  color: #e5e7eb;\n  border-color: rgba(148,163,184,0.3);\n  opacity: 0.85;\n}\n.btn-secondary:hover,\n.btn-ghost:hover {\n  background: rgba(15,23,42,0.9);\n}\n</style>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 740,
        "y": 120,
        "wires": [
            [
                "dbg-from-ui",
                "sw-topic"
            ]
        ]
    },
    {
        "id": "dbg-from-ui",
        "type": "debug",
        "z": "tab-reflink-test",
        "name": "Fr√•n UI (topic + payload)",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 80,
        "wires": []
    },
    {
        "id": "sw-topic",
        "type": "switch",
        "z": "tab-reflink-test",
        "name": "P√• msg.topic",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "quick",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "quick-save",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "advanced",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1010,
        "y": 140,
        "wires": [
            [
                "dbg-quick"
            ],
            [
                "dbg-quick-save"
            ],
            [
                "dbg-adv"
            ]
        ]
    },
    {
        "id": "dbg-quick",
        "type": "debug",
        "z": "tab-reflink-test",
        "name": "QUICK (rad-klick)",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 120,
        "wires": []
    },
    {
        "id": "dbg-quick-save",
        "type": "debug",
        "z": "tab-reflink-test",
        "name": "QUICK-SAVE (fr√•n popup)",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 160,
        "wires": []
    },
    {
        "id": "dbg-adv",
        "type": "debug",
        "z": "tab-reflink-test",
        "name": "ADVANCED (tre prickar / Alla parametrar‚Ä¶)",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 200,
        "wires": []
    },
    {
        "id": "reflink-examples-flow",
        "type": "tab",
        "label": "üìò Reflink Examples",
        "disabled": false,
        "info": "Best practice exempel f√∂r Reflink Message Standard v1.0"
    },
    {
        "id": "reflink-std-doc-60eec45b",
        "type": "comment",
        "z": "reflink-examples-flow",
        "name": "üìö REFLINK MESSAGE STANDARD v1.0",
        "info": "# Reflink Message Standard v1.0\n\n## Obligatoriska f√§lt\n\n| F√§lt | Typ | Beskrivning |\n|------|-----|-------------|\n| `msg.action` | string | Vad ska h√§nda? t.ex. `showControllers`, `refresh` |\n| `msg.group` | string | Vilken kategori? t.ex. `Controllers`, `Alarms` |\n\n## Giltiga actions\n\n### Controllers\n- `showControllers` - Visa alla regulatorer\n- `showKylar` - Visa endast kylar (setpoint >= 0)\n- `showFrysar` - Visa endast frysar (setpoint < 0)\n- `setSetpoint` - √Ñndra b√∂rv√§rde\n- `togglePower` - Sl√• p√•/av\n\n### Machines\n- `showMachines` - Visa alla maskiner\n- `showMachineGauges` - Visa maskin-gauges\n\n### Alarms\n- `showAlarms` - Visa aktiva larm\n- `showAlarmSummary` - Visa larmsammanfattning\n- `latestAlarms` - Visa senaste larm\n- `acknowledgeAlarm` - Kvittera larm\n\n### System\n- `refresh` - Uppdatera data\n- `navigate` - Navigera till sida\n- `exportBackup` - Exportera backup\n\n## Exempel\n\n```javascript\n// I inject-nod:\nmsg.action = 'showControllers';\nmsg.group = 'Controllers';\n\n// I function-nod (Safe Header):\nmsg.action = msg.action || 'showControllers';\nmsg.group = msg.group || 'Controllers';\n```\n\n## Best Practices\n\n1. **Alltid Safe Header** - F√∂rsta raderna i varje function-nod\n2. **Explicit action/group** - S√§tt alltid b√•da, √§ven om du tror de √§r satta\n3. **Fallback-v√§rden** - Anv√§nd `||` f√∂r s√§kra defaults\n4. **Status-uppdatering** - Visa action och group i node.status()\n",
        "x": 100,
        "y": 50,
        "wires": []
    },
    {
        "id": "safe-handler-b93b381a",
        "type": "function",
        "z": "reflink-examples-flow",
        "name": "üõ°Ô∏è Universal Safe Handler",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// UNIVERSAL SAFE HANDLER - Reflink Message Standard v1.0\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// Garanterar att msg.action och msg.group alltid √§r satta\n// Skyddar mot null/undefined och TypeError\n\n// üõ°Ô∏è VALIDATE INCOMING MESSAGE\nmsg = msg || {};\n\n// üéØ ACTION - Vad ska h√§nda? (required)\n// Giltiga v√§rden: showControllers, showMachines, showAlarms, showNodes,\n//                 showKylar, showFrysar, refresh, navigate, update, delete\nif (!msg.action || typeof msg.action !== 'string') {\n    // F√∂rs√∂k h√§rled fr√•n topic eller payload\n    if (msg.topic && typeof msg.topic === 'string') {\n        msg.action = msg.topic;\n    } else if (msg.payload && typeof msg.payload === 'object' && msg.payload.action) {\n        msg.action = msg.payload.action;\n    } else {\n        msg.action = 'unknown';\n        node.warn('‚ö†Ô∏è msg.action saknas - satt till \"unknown\"');\n    }\n}\n\n// üì¶ GROUP - Vilken kategori? (required)\n// Giltiga v√§rden: Controllers, Kylar, Frysar, Machines, Alarms, Nodes, System\nif (!msg.group || typeof msg.group !== 'string') {\n    // F√∂rs√∂k h√§rled fr√•n action eller topic\n    const actionToGroup = {\n        'showControllers': 'Controllers',\n        'showKylar': 'Kylar',\n        'showFrysar': 'Frysar',\n        'showMachines': 'Machines',\n        'showAlarms': 'Alarms',\n        'showNodes': 'Nodes',\n        'showMachineGauges': 'Machines',\n        'alarmSummary': 'Alarms',\n        'latestAlarms': 'Alarms',\n        'createAlarms': 'Alarms',\n        'refresh': 'System',\n        'navigate': 'System'\n    };\n    \n    msg.group = actionToGroup[msg.action] || 'Unknown';\n    \n    if (msg.group === 'Unknown') {\n        node.warn('‚ö†Ô∏è msg.group kunde inte h√§rledas - satt till \"Unknown\"');\n    }\n}\n\n// üìä METADATA - L√§gg till timestamp och source om saknas\nmsg._meta = msg._meta || {};\nmsg._meta.timestamp = msg._meta.timestamp || new Date().toISOString();\nmsg._meta.handler = 'UniversalSafeHandler';\nmsg._meta.version = '1.0';\n\n// üîí SANITIZE payload - Garantera att payload existerar\nif (msg.payload === null || msg.payload === undefined) {\n    msg.payload = {};\n}\n\n// Status f√∂r debugging\nnode.status({ \n    fill: 'green', \n    shape: 'dot', \n    text: `${msg.action} ‚Üí ${msg.group}` \n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 150,
        "wires": [
            []
        ]
    },
    {
        "id": "action-router-01d705d4",
        "type": "switch",
        "z": "reflink-examples-flow",
        "name": "üîÄ Action Router",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "showControllers",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "showKylar",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "showFrysar",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "showMachines",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "showAlarms",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "showNodes",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "refresh",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "navigate",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 9,
        "x": 350,
        "y": 150,
        "wires": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "id": "bp-controllers-59579b58",
        "type": "function",
        "z": "reflink-examples-flow",
        "name": "üìò Best Practice: Controllers",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// BEST PRACTICE: Controllers Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// Visar hur man anv√§nder msg.action/msg.group konsekvent\n\n// üõ°Ô∏è SAFE HEADER - Alltid f√∂rst i varje function-nod\nmsg.action = msg.action || 'showControllers';\nmsg.group = msg.group || 'Controllers';\n\n// üì¶ H√§mta data fr√•n global context (med fallback)\nconst controllers = global.get('reflink.regulators') || [];\n\n// üîÑ Filtrera baserat p√• action\nlet result = [];\nswitch (msg.action) {\n    case 'showKylar':\n        result = controllers.filter(c => {\n            const sp = parseFloat((c.setpoint || '0').toString().replace(/[^0-9.-]/g, ''));\n            return !isNaN(sp) && sp >= 0;\n        });\n        msg.group = 'Kylar';\n        break;\n        \n    case 'showFrysar':\n        result = controllers.filter(c => {\n            const sp = parseFloat((c.setpoint || '0').toString().replace(/[^0-9.-]/g, ''));\n            return !isNaN(sp) && sp < 0;\n        });\n        msg.group = 'Frysar';\n        break;\n        \n    case 'showControllers':\n    default:\n        result = controllers;\n        break;\n}\n\n// üìä Bygg response\nmsg.controllers = result;\nmsg.payload = result;\nmsg.count = result.length;\n\n// üìà Status f√∂r debugging\nnode.status({ \n    fill: result.length > 0 ? 'green' : 'yellow', \n    shape: 'dot', \n    text: `${msg.action}: ${result.length} st` \n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "bp-machines-10b712f3",
        "type": "function",
        "z": "reflink-examples-flow",
        "name": "üìò Best Practice: Machines",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// BEST PRACTICE: Machines Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showMachines';\nmsg.group = msg.group || 'Machines';\n\n// üì¶ H√§mta data\nconst maxHz = 70;\nconst machines = (global.get('reflink.machines') || []).map(m => ({\n    ...m,\n    freqHz: ((m.capacityPercent || 0) / 100 * maxHz).toFixed(1) + ' Hz',\n    status: m.capacityPercent > 80 ? 'high' : (m.capacityPercent > 50 ? 'normal' : 'low')\n}));\n\n// üìä Bygg response med konsekvent struktur\nmsg.machines = machines;\nmsg.payload = machines;\nmsg.count = machines.length;\n\n// üìà Status\nnode.status({ \n    fill: 'green', \n    shape: 'dot', \n    text: `${machines.length} maskiner` \n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "bp-alarms-e6bcd39f",
        "type": "function",
        "z": "reflink-examples-flow",
        "name": "üìò Best Practice: Alarms",
        "func": "// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// BEST PRACTICE: Alarms Handler\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// üõ°Ô∏è SAFE HEADER\nmsg.action = msg.action || 'showAlarms';\nmsg.group = msg.group || 'Alarms';\n\n// üì¶ H√§mta larm fr√•n global context\nconst reflink = global.get('reflink') || {};\nconst alarms = reflink.alarms || { \n    active: [], \n    summary: { total: 0, critical: 0, warning: 0, info: 0 },\n    history: []\n};\n\n// üîÑ Hantera olika actions\nlet result;\nswitch (msg.action) {\n    case 'showAlarmSummary':\n    case 'alarmSummary':\n        const s = alarms.summary;\n        result = s.total === 0 \n            ? '‚úÖ Inga aktiva larm'\n            : `‚ö†Ô∏è ${s.total} larm ‚Ä¢ ${s.critical} kritiska ‚Ä¢ ${s.warning} varningar`;\n        msg.payload = result;\n        break;\n        \n    case 'latestAlarms':\n        const sorted = [...alarms.active].sort((a, b) => \n            new Date(b.timestamp) - new Date(a.timestamp)\n        );\n        result = sorted.slice(0, 5);\n        msg.payload = result;\n        break;\n        \n    case 'showAlarms':\n    default:\n        result = alarms.active;\n        msg.payload = result;\n        break;\n}\n\nmsg.alarms = alarms.active;\nmsg.alarmsSummary = alarms.summary;\nmsg.count = alarms.active.length;\n\n// üìà Status baserad p√• allvarlighetsgrad\nconst fill = alarms.summary.critical > 0 ? 'red' : \n             (alarms.summary.warning > 0 ? 'yellow' : 'green');\nnode.status({ fill, shape: 'dot', text: `${alarms.active.length} larm` });\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "inject-controllers-210d864a",
        "type": "inject",
        "z": "reflink-examples-flow",
        "name": "Show Controllers",
        "props": [
            {
                "p": "action",
                "v": "showControllers",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Controllers",
                "vt": "str"
            },
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "inject-machines-06b1d29c",
        "type": "inject",
        "z": "reflink-examples-flow",
        "name": "Show Machines",
        "props": [
            {
                "p": "action",
                "v": "showMachines",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Machines",
                "vt": "str"
            },
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 550,
        "wires": [
            []
        ]
    },
    {
        "id": "inject-alarms-74e73cc5",
        "type": "inject",
        "z": "reflink-examples-flow",
        "name": "Show Alarms",
        "props": [
            {
                "p": "action",
                "v": "showAlarms",
                "vt": "str"
            },
            {
                "p": "group",
                "v": "Alarms",
                "vt": "str"
            },
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 600,
        "wires": [
            []
        ]
    }
]